@model Fast.Web.Models.LPH.LPHEditModel
@using Newtonsoft.Json;
@using Fast.Web.Resources;
@{
	ViewBag.Title = "Index";
}
@* chanif: tambah css untuk select2 *@
@section CSS_lib{
	<link href="~/Content/dashforge/lib/select2/css/select2.min.css" rel="stylesheet">
}

@section Styles{
	<style>
		.tableWrapper {
			position: relative;
			overflow: auto;
			max-height: 150px;
			transform: translateZ(0);
		}


			.tableWrapper table {
				border-collapse: collapse;
				width: 100%;
			}

			.tableWrapper thead th, .tableWrapper thead td {
				position: sticky;
				background: #066fcb;
				z-index: 100;
				border: none;
			}

			.tableWrapper table tfoot td {
				position: sticky;
				bottom: 0;
				z-index: 100;
			}

			.tableWrapper .input td {
				background: white;
			}

			.tableWrapper .summary-body td {
				font-weight: bold;
				background-color: #c5e2ff;
				color: #000;
			}

		.fa {
			padding: 5px;
		}

		.modal-body {
			position: relative;
			margin-top: 10px;
		}

			.modal-body .close {
				padding: 5px;
				position: absolute;
				top: -5px;
				right: 5px;
				font-size: 15px;
				color: black;
				z-index: 1000;
			}

		.stepper {
			position: relative;
		}

			.stepper:before {
				top: 15px;
				bottom: 0;
				position: absolute;
				content: " ";
				width: 100%;
				height: 1px;
				background: #f1f1f1;
				z-index: 0;
			}

		.stepper-step {
			text-align: center;
			position: relative;
		}

			.stepper-step.active .stepper-btn {
				background: #37b6fa;
				color: white;
				font-weight: 500;
				border: 0
			}

		.stepper-btn {
			width: 30px;
			height: 30px;
			text-align: center;
			padding: 6px 0;
			font-size: 12px;
			line-height: 1.428571429;
			border-radius: 15px;
			background: #e6e6e6;
			color: #9c9c9c;
		}

		.wizard-button {
			margin: 5px;
		}

			.wizard-button.active {
				filter: brightness(0.75);
			}

		/* chanif: tolong tambahkan css dari sini sampai bawah untuk memperbaiki tampilan select2 */
		.select2-container--default .select2-selection--single {
			height: 25px;
			min-height: 25px;
		}

		.select2-container--default .select2-selection--multiple {
			min-height: 25px;
		}

		.select2-container--default .select2-selection--single .select2-selection__arrow {
			display: none;
		}

		.select2-container--default .select2-selection--single .select2-selection__rendered {
			font-size: 13px;
			padding: 5px;
		}

		.select2-container--default .select2-selection--multiple .select2-selection__rendered {
			font-size: 13px;
			padding: 0 0 0 5px;
		}

		.select2-search--dropdown {
			padding: 1px;
		}

		.select2-container--default .select2-search--dropdown .select2-search__field {
			padding: 3px 5px;
		}

		.select2-results {
			font-size: 13px;
		}

		.select2-results__option {
			padding: 3px;
		}

		table.dataTable thead .sorting_asc, table.dataTable thead .sorting_desc {
			background-color: transparent
		}

		.select2-container--default .select2-search--inline .select2-search__field {
			margin-top: 0;
			padding: 0;
		}

		.select2-results__option[aria-selected=true] {
			display: none;
		}

		#GeneralInfo label {
			padding-right: 0;
		}
	</style>
}


<div class="content content-fixed lph-form">
	<div class="container-fluid pd-x-0 pd-lg-x-10 pd-xl-x-0">
		<div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-30">
			<div>
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb breadcrumb-style1 mg-b-10">
						<li class="breadcrumb-item"><a href="#">LPH Form</a></li>
						<li class="breadcrumb-item active" aria-current="page">Filter (KDF)</li>
					</ol>
				</nav>
				<h4 class="mg-b-0 tx-spacing--1">LPH Filter (KDF)</h4>
			</div>
			<div class="d-none d-md-block">
				<button id="goPrev" class="btn btn-sm pd-x-15 btn-white btn-uppercase mg-l-5"><i data-feather="chevron-left" class="wd-10 mg-r-5"></i> Prev</button>
				<button id="btnHistory" class="btn btn-sm pd-x-15 btn-primary btn-uppercase mg-l-5"><i data-feather="clock" class="wd-10 mg-r-5"></i> History</button>
				<button class="btn btn-sm pd-x-15 btn-white btn-uppercase" data-toggle="modal" data-target="#photo-modal"><i data-feather="camera" class="wd-10 mg-r-5"></i> Photo</button>
				<button class="btn btn-sm pd-x-15 btn-white btn-uppercase" id="btnNewLPH"><i data-feather="plus" class="wd-10 mg-r-5"></i> New</button>
				<button class="btn btn-sm pd-x-15 btn-white btn-uppercase" id="btnSaveDraft"><i data-feather="save" class="wd-10 mg-r-5"></i> Save</button>
				<button id="btnSave" class="btn btn-sm pd-x-15 btn-primary btn-uppercase"><i data-feather="save" class="wd-10 mg-r-5"></i> Submit</button>
				<button class="btn btn-sm pd-x-15 btn-uppercase btn-secondary " id="btnReset"><i data-feather="refresh-cw" class="wd-10 mg-r-5"></i> Reset</button>
				<button class="btn btn-sm pd-x-15 btn-white btn-uppercase mg-l-5" onclick="javascript:window.print()"><i data-feather="printer" class="wd-10 mg-r-5"></i> Print</button>
			</div>
		</div>
		<div class="row">
			<!-- chanif: mending langsung kopi saja keseluruhan isi div di bawah ini, karena sepertinya sama semua isinya untuk semua LPH  -->
			<div class="col-12 mg-b-20">
				<div class="card collect-component" id="GeneralInfo">
					<div class="card-header bg-primary tx-white tx-center font-weight-bold">Information</div>
					<div class="card-body d-flex">
						<div class="flex-1">
							<div class="form-group row">
								<label class="col-3 col-form-label">Date</label>
								<div class="col-5">
									<input type="text" name="DateInfo" class="form-control" disabled id="txtDateInfo" value="">
								</div>
								<label class="col-2 col-form-label tx-right pd-r-0-f">Week</label>
								<div class="col-2">
									<input type="text" name="WeekNumber" class="form-control" disabled id="txtWeekNumber" value="">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-3 col-form-label">Machine *</label>
								<div class="col-4">
									<select class="form-control select2 mandatory" name="MachInfo" id="machInfo">
										<option value="">Select Machine</option>
										@foreach (Fast.Web.Models.MachineModel machine in ViewBag.Machines)
										{
											<option value="@(machine.Code)">@(machine.Code)</option>
										}
									</select>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-3 col-form-label">Filter *</label>
								<div class="col-9">
									<select class="form-control select2 mandatory" name="BrandInfo" id="brandInfo">
										<option value="">Select Filter</option>
										@foreach (Fast.Web.Models.ReferenceDetailModel brand in ViewBag.Brand)
										{
											<option value="@(brand.Code)">[@(brand.Code)] @brand.Description</option>
										}
									</select>
								</div>
							</div>
						</div>
						<div class="divider-text divider-vertical"></div>
						<div class="flex-1">
							<div class="form-group row">
								<label class="col-3 col-form-label">Prodtech *</label>
								<div class="col-8">
									<select class="form-control select2 mandatory" name="ProdTech" id="prodTech" multiple>

										@foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Prodtechs)
										{
											<option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
										}
									</select>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-3 col-form-label">Mechanic *</label>
								<div class="col-8">
									<select class="form-control select2 mandatory" name="Mekanik" id="mekanik">
										<option value="">Select Mechanic</option>
										@foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Mechanics)
										{
											<option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
										}
									</select>
								</div>
							</div>
						</div>
						<div class="flex-1">
							<div class="form-group row">
								<label class="col-4 col-form-label">Electrician *</label>
								<div class="col-8">
									<select class="form-control select2 mandatory" name="Electrician" id="elektrik">
										<option value="">Select Electrician</option>
										@foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Electrics)
										{
											<option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
										}
									</select>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-4 col-form-label">Supervisor *</label>
								<div class="col-8">
									<select class="form-control select2 mandatory" name="TeamLeader" id="teamLeader">
										<option value="">Select Mechanic</option>
										@foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Leaders)
										{
											<option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
										}
									</select>
								</div>
							</div>
							<div class="form-group row">
								<label class="col-4 col-form-label" style="padding-right: 3px;">PO Number</label>
								<div class="col-8">
									<select class="form-control select2" name="PONumber">
										<option value="">Select PO Number</option>
										@foreach (Fast.Web.Models.WppModel wpp in ViewBag.WPP)
										{
											<option value="@(wpp.PONumber)">@(wpp.PONumber)</option>
										}
									</select>
								</div>
							</div>
						</div>
						<div class="divider-text divider-vertical"></div>
						<div class="flex-1">
							<div class="form-group row">
								<label class="col-4 col-form-label">Shift / Group *</label>
								<div class="col-3">
									<input type="text" class="form-control mandatory" name="Shift" id="shift" value="3">
								</div>
								<label class="col-1 col-form-label tx-center">/</label>
								<div class="col-3">
									<input type="text" class="form-control mandatory" name="Group" id="group" value="C">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-4 col-form-label">Start / Stop *</label>
								<div class="col-3">
									<div class="input-group">
										<input id="inputTimeStart" name="Start" class="form-control date mandatory" value="22:00">
									</div>
								</div>
								<label class="col-1 col-form-label">/</label>
								<div class="col-3">
									<div class="input-group">
										<input id="inputTimeStop" name="Stop" class="form-control date mandatory" value="06:00">
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div> <!--INFORMATION-->

			<div class="col-12 mg-b-20">
				<div class="card ">
					<div class="card-header bg-primary tx-white tx-center font-weight-bold">
						Handover Logbook
					</div>
					<div class="card-body">
						<div class="tableWrapper" style="max-height: 210px">
							<table class="table table-bordered table-hover table-striped">
								<thead class="thead-info">
									<tr class="tx-center">
										<th style="min-width:120px;">Stops and Location</th>
										<th style="min-width:100px;"># of Stops</th>
										<th style="min-width:120px;">Initial Root Cause (Describe the issue) / Action Taken &amp; Impact</th>
										<th style="min-width:120px;">Action Taken in your shift</th>
										<th width="80px">Action</th>
									</tr>
								</thead>
								<tbody id="logbook">
								</tbody>
								<tfoot>
									<tr class="input">
										<td><input type="text" class="form-control" name="StopAndLocation"></td>
										<td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="NOfStop"></td>
										<td><input type="text" class="form-control" name="InitialCause"></td>
										<td><input type="text" class="form-control" name="ActionTaken"></td>
										<td class="tx-center"><i data-target="logbook" class="fa fa-plus-circle add-to-table"></i></td>
									</tr>
								</tfoot>
							</table>
						</div>
						<div class="tableWrapper" style="max-height: 210px">
							<table class="table table-bordered table-hover table-striped">
								<thead class="thead-info">
									<tr class="tx-center">
										<th style="width:50%;">Action proposed for next shift</th>
										<th style="min-width:90px;">Owner</th>
										<th style="min-width:70px;">Start Time</th>
										<th style="min-width:70px;">End Time</th>
										<th style="min-width:60px;">Duration (Min)</th>
										<th style="min-width:100px;">Status</th>
										<th width="80px">Action</th>
									</tr>
									<tr class="summary-body">
										<td></td>
										<td></td>
										<td></td>
										<td></td>
										<td>0</td>
										<td></td>
										<td></td>
									</tr>
								</thead>
								<tbody id="action">
								</tbody>
								<tfoot>
									<tr class="input">
										<td><input type="text" class="form-control" name="NextAction"></td>
										<td><input type="text" class="form-control" name="NextOwner"></td>
										<td><input type="text" class="form-control date" name="NextStart" id="start" onblur="javascript:countDuration('start','end','duration')"></td>
										<td><input type="text" class="form-control date" name="NextEnd" id="end" onblur="javascript:countDuration('start','end','duration')"></td>
										<td><input type="text" class="form-control disabled" disabled value="0" name="NextDurasi" id="duration"></td>
										<td>
											<select class="form-control select2" name="Status">
												<option label="Choose one"></option>
												<option value="ONPROGRESS">ONPROGRESS</option>
												<option value="DONE">DONE</option>
											</select>
										</td>
										<td class="tx-center"><i data-target="action" class="fa fa-plus-circle add-to-table"></i></td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
			</div> <!-- PROBLEM MESIN -->

			<div class="col-3 mg-b-20">
				<div class="card">
					<div class="card-header bg-primary tx-white tx-center font-weight-bold">Capture by Webcam *</div>
					<div class="card-body">
						<div class="form-group row">
							<div class="col" style="padding-top: 10px">
								<center>
									<img id="image_0" data-toggle="modal" data-target="#photo-modal" data-method="add" data-target-table="cbw" src="~/Content/dashforge/assets/img/upload-img-mini.png" class="rounded mx-auto d-block" alt="insert image" width="auto">
								</center>
							</div>
						</div>
						<br />
						<div class="tableWrapper" style="max-height:200px;">
							<table class="table table-bordered table-hover table-striped">
								<thead class="thead-info">
									<tr>
										<th>Kategori</th>
										<th>Description</th>
										<th>File Name </th>
										<th style="min-width:130px;">Action</th>
									</tr>
								</thead>
								<tbody id="cbw"></tbody>
								<tfoot>
									<tr class="input" style="display:none;">
										<td><input type="text" class="form-control" name="Kategori"></td>
										<td><input type="text" class="form-control" name="Remark"></td>
										<td><input type="text" class="form-control" name="Filename"></td>
										<td class="tx-center"><i data-target="cbw" class="fa fa-plus-circle add-to-table"></i></td>
									</tr>
								</tfoot>
							</table>
						</div>
					</div>
				</div>
			</div> <!--CAPTURE BY WEBCAM-->

			<div class="col-9 mg-b-20">
				<div class="card collect-component" id="ProductInformation">
					<div class="card-header bg-primary tx-white tx-center font-weight-bold">Product Information</div>
					<div class="card-body d-flex">
						<div class="col-5">
							<div class="form-group row">
								<label class="col-5 col-form-label">Speed Machine</label>
								<div class="col-4">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="SpeedMachine" id="speedMach" class="form-control">
								</div>
								<label class="col-3 col-form-label">Sticks/min</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Result Counter KDF</label>
								<div class="col-4">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="ResultCounter" id="resultCount" class="form-control">
								</div>
								<label class="col-3 col-form-label">Stick</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Output GR Filter</label>
								<div class="col-4">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="OutputGR" id="outputGR" class="form-control">
								</div>
								<label class="col-3 col-form-label">Box</label>
							</div>
							<hr>
							<div class="form-group row">
								<label class="col-10 col-form-label font-weight-bold">Manual Feeding Resy Capricorn</label>(Stick)
							</div>
							<div class="form-group row">
								<label class="col-8 col-form-label">Initial Stock</label>
								<div class="col-1">
									<i onclick="javascript:editInitialStock()" id="iconEdit" class="fa fa-edit edit small"></i> <i onclick="javascript:disabledInitialStock()" id="iconSave" class="fa fa-save save small"></i>
								</div>
								<div class="col-3">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="InitialStock" id="initialStock" disabled class="form-control">
								</div>
							</div> <!--Initial Stock-->
							<div class="form-group row">
								<label class="col-8 col-form-label">Receive</label>
								<div class="col-4">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="Receive" id="receive" class="form-control">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-8 col-form-label">Last Stock <label class="col-form-label" style="font-size:8px;"><span>(Optional)</span></label></label>
								<div class="col-4">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" id="lastStock" class="form-control" name="ManualFeeding">
								</div>
							</div> <!--Last Stock-->
							<div class="flex-1">
								<div class="form-group row">
									<label class="col-8 col-form-label font-weight-bold">Stock Buffer Resy Capricorn</label>
									<div class="col-4">
										<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="StockBuffer" class="form-control" id="stockBuffer">
									</div>
								</div>
							</div>

							<hr>
							@* Shooter Table *@
							<div class="form-group row">
								<label class="col-10 col-form-label font-weight-bold">Data Shooter</label>
							</div>
							<div class="tableWrapper" style="max-height: 210px">
								<table class="table table-bordered table-hover table-striped">
									<thead class="thead-info">
										<tr class="tx-center">
											<th style="min-width:100px;">Machine</th>
											<th>Shooter (pcs)</th>
											<th>Shooter No.</th>
											<th width="80px">Action</th>
										</tr>
										<tr class="summary-body">
											<td></td>
											<td>0</td>
											<td></td>
											<td></td>
										</tr>
									</thead>
									<tbody id="shooter">
									</tbody>
									<tfoot>
										<tr class="input">
											<td>
												<select class="form-control select2" name="ShooterName">
													<option value="">Select Machine</option>
													@foreach (Fast.Web.Models.MachineModel machine in ViewBag.Maker)
													{
														<option value="@(machine.Code)">@(machine.Code)</option>
													}
												</select>
											</td>
											<td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="ShooterPcs"></td>
											<td>
												<select class="form-control" name="ShooterNumber">
													<option value="1">1</option>
													<option value="2">2</option>
												</select>
											</td>
											<td class="tx-center"><i data-target="shooter" class="fa fa-plus-circle add-to-table"></i></td>
										</tr>
									</tfoot>
								</table>
							</div>

						</div>
						<div class="divider-text divider-vertical"></div>
						<div class="col-7">
							<div class="form-group row tx-center">
								<label class="col-5 col-form-label"></label>
								<label class="col-3 col-form-label">DOS</label>
								<label class="col-3 col-form-label">Pallet</label>
							</div>
							<div class="form-group row">
								<label class="col-4 col-form-label">Initial Stock</label>
								<div class="col-1">
									<i onclick="javascript:editInitialStock2()" id="iconEdit2" class="fa fa-edit edit small"></i> <i onclick="javascript:disabledInitialStock2()" id="iconSave2" class="fa fa-save save small"></i>
								</div>
								<div class="col-3">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="InitialStockDOS" id="initialStockDOS" class="form-control" disabled>
								</div>
								<div class="col-3">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="InitialStockPallet" id="initialStockPallete" class="form-control" disabled>
								</div>
							</div> <!-- initial stock -->
							<div class="form-group row">
								<label class="col-5 col-form-label">Receive</label>
								<div class="col-3">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="ReceiveDOS" id="receiveDOS" class="form-control">
								</div>
								<div class="col-3">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="ReceivePallet" id="receivePallet" class="form-control">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Use Manual Feeding</label>
								<div class="col-3">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="UseManualDOS" id="useManualDOS" class="form-control">
								</div>
								<div class="col-3">
									<input type="number" onkeypress="validateNumber(event)" placeholder="0" name="UseManualPallet" id="useManualPallet" class="form-control">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Last Stock <label class="col-form-label" style="font-size:8px;"><span>(Optional)</span></label></label>
								<div class="col-3">
									<input type="number" onkeypress="validateNumber(event)" id="lastStockDOS" name="LastStockDOS" class="form-control" placeholder="0">
								</div>
								<div class="col-3">
									<input type="number" onkeypress="validateNumber(event)" id="lastStockPallet" name="LastStockPallet" class="form-control" placeholder="0">
								</div>
							</div> <!-- last stock -->

							<hr>
							@* Pengecekan kadar PZ *@
							<div class="form-group row">
								<label class="col-10 col-form-label font-weight-bold">Sampling PZ</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">&nbsp;</label>
								<label class="col-2 col-form-label">#1</label>
								<label class="col-2 col-form-label">#2</label>
								<label class="col-2 col-form-label">#3</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Berat Basah *</label>
								<div class="col-2 px-1">
									<input type="number" onkeypress="validateNumber(event)" id="pzBasah1" name="PzBasah1" class="form-control mandatory" placeholder="0">
								</div>
								<div class="col-2 px-1">
									<input type="number" onkeypress="validateNumber(event)" id="pzBasah2" name="PzBasah2" class="form-control" placeholder="0">
								</div>
								<div class="col-2 px-1">
									<input type="number" onkeypress="validateNumber(event)" id="pzBasah3" name="PzBasah3" class="form-control" placeholder="0">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Berat Kering *</label>
								<div class="col-2 px-1">
									<input type="number" onkeypress="validateNumber(event)" id="pzKering1" name="PzKering1" class="form-control mandatory" placeholder="0">
								</div>
								<div class="col-2 px-1">
									<input type="number" onkeypress="validateNumber(event)" id="pzKering2" name="PzKering2" class="form-control" placeholder="0">
								</div>
								<div class="col-2 px-1">
									<input type="number" onkeypress="validateNumber(event)" id="pzKering3" name="PzKering3" class="form-control" placeholder="0">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Content PZ %</label>
								<div class="col-2 px-1">
									<input type="number" onkeypress="validateNumber(event)" id="contentPz1" name="ContentPz1" class="form-control disabled" disabled placeholder="0">
								</div>
								<div class="col-2 px-1">
									<input type="number" onkeypress="validateNumber(event)" id="contentPz2" name="ContentPz2" class="form-control disabled" disabled placeholder="0">
								</div>
								<div class="col-2 px-1">
									<input type="number" onkeypress="validateNumber(event)" id="contentPz3" name="ContentPz3" class="form-control disabled" disabled placeholder="0">
								</div>
							</div>

						</div>

					</div>
				</div>
			</div> <!-- PRODUCT INFORMATION -->

			<div class="col-4 mg-b-20">
				<div class="card collect-component" id="WasteKDF">
					<div class="card-header bg-primary tx-white tx-center font-weight-bold">Waste KDF</div>
					<div class="card-body d-flex">
						<div class="col-12">
							<div class="form-group row">
								<label class="col col-form-label font-weight-bold">KDF</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Plugwrap</label>
								<div class="col-5">
									<input type="number" onkeypress="validateNumber(event)" name="PlugWrap" placeholder="0" id="plugWrap" class="form-control">
								</div>
								<label class="col-2 col-form-label">kg</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Filter Rod *</label>
								<div class="col-5">
									<input type="number" onkeypress="validateNumber(event)" name="FilterRod" placeholder="0" id="filterRod" class="form-control mandatory">
								</div>
								<label class="col-2 col-form-label">kg</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Endless Rod</label>
								<div class="col-5">
									<input type="number" onkeypress="validateNumber(event)" name="EndlessRod" placeholder="0" id="endlessRod" class="form-control">
								</div>
								<label class="col-2 col-form-label">kg</label>
							</div>


							<div class="form-group row">
								<label class="col col-form-label font-weight-bold">Filter Rod</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">HCF</label>
								<div class="col-5">
									<input type="number" onkeypress="validateNumber(event)" name="HFC" placeholder="0" id="hcf" class="form-control">
								</div>
								<label class="col-2 col-form-label">kg</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Magomat/Shooter</label>
								<div class="col-5">
									<input type="number" onkeypress="validateNumber(event)" name="Magomat" placeholder="0" id="magomat" class="form-control">
								</div>
								<label class="col-2 col-form-label">kg</label>
							</div>
							<div class="form-group row">
								<label class="col-5 col-form-label">Ackflush</label>
								<div class="col-5">
									<input type="number" onkeypress="validateNumber(event)" name="AckFlush" placeholder="0" id="ackflush" class="form-control">
								</div>
								<label class="col-2 col-form-label">kg</label>
							</div>
						</div>
					</div>
				</div>

			</div>

			<div class="col-8 mg-b-20">
				<div class="card collect-component" id="Usage">
					<div class="card-header bg-primary tx-white tx-center font-weight-bold">Usage</div>
					<div class="card-body d-flex">
						<div class="col-12">
							<div class="form-group row tx-center">
								<label class="col-3 col-form-label font-weight-bold"></label>
								<label class="col-2 col-form-label font-weight-bold">Initial Stock ( A )</label>
								<label class="col-2 col-form-label font-weight-bold">Received ( B )</label>
								<label class="col-2 col-form-label font-weight-bold">Last Stock ( C )</label>
								<label class="col-2 col-form-label font-weight-bold">Used ( A + B - C )</label>
							</div>
							<div class="form-group row">
								<label class="col-3 col-form-label tx-center-right">Tow (kg)</label>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsTowStockAwal" placeholder="0" id="UsTowStockAwal" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsTowPenerimaan" placeholder="0" id="UsTowPenerimaan" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsTowStockAkhir" placeholder="0" id="UsTowStockAkhir" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsTowPemakaian" placeholder="0" id="UsTowPemakaian" disabled class="form-control">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-3 col-form-label tx-center-right">Plug Wrap (pcs)</label>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsPlugWrapStockAwal" placeholder="0" id="UsPlugWrapStockAwal" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsPlugWrapPenerimaan" placeholder="0" id="UsPlugWrapPenerimaan" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsPlugWrapStockAkhir" placeholder="0" id="UsPlugWrapStockAkhir" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsPlugWrapPemakaian" placeholder="0" id="UsPlugWrapPemakaian" disabled class="form-control">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-3 col-form-label tx-center-right">Seam Glue (kg)</label>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsSeamGlueAwal" placeholder="0" id="UsSeamGlueAwal" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsSeamGluePenerimaan" placeholder="0" id="UsSeamGluePenerimaan" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsSeamGlueStockAkhir" placeholder="0" id="UsSeamGlueStockAkhir" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsSeamGluePemakaian" placeholder="0" id="UsSeamGluePemakaian" disabled class="form-control">
								</div>
							</div>
							<div class="form-group row">
								<label class="col-3 col-form-label tx-center-right">Inner Glue (kg)</label>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsInnerGlueStockAwal" placeholder="0" id="UsInnerGlueStockAwal" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsInnerGluePenerimaan" placeholder="0" id="UsInnerGluePenerimaan" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsInnerGlueStockAkhir" placeholder="0" id="UsInnerGlueStockAkhir" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsInnerGluePemakaian" placeholder="0" id="UsInnerGluePemakaian" disabled class="form-control">
								</div>
							</div>
							<form>
								<div class="form-group row">
									<label class="col-3 col-form-label tx-center-right"></label>
									<label class="radio-inline col-9"> <input type="radio" id="radioCapsule" checked> Capsule (kg)</label>
									<label class="col-3 col-form-label tx-center-right"></label>
									<label class="radio-inline col-9"> <input type="radio" id="radioTriacetine"> Triacetine</label>
								</div>
							</form>
							<div class="form-group row" id="formCapsule">
								<label class="col-3 col-form-label tx-center-right">Capsule (kg)</label>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsCapsuleStockAwal" placeholder="0" id="UsCapsuleStockAwal" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsCapsulePenerimaan" placeholder="0" id="UsCapsulePenerimaan" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsCapsuleStockAkhir" placeholder="0" id="UsCapsuleStockAkhir" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="UsCapsulePemakaian" placeholder="0" id="UsCapsulePemakaian" disabled class="form-control">
								</div>
							</div>
							<div class="form-group row d-none" id="formTriacetine">
								<label class="col-3 col-form-label tx-center-right">Triacetine</label>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="TriacetineStockAwal" placeholder="0" id="TriacetineStockAwal" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="TriacetinePenerimaan" placeholder="0" id="TriacetinePenerimaan" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="TriacetineStockAkhir" placeholder="0" id="TriacetineStockAkhir" class="form-control">
								</div>
								<div class="col-2">
									<input type="number" onkeypress="validateNumber(event)" name="TriacetinePemakaian" placeholder="0" id="TriacetinePemakaian" disabled class="form-control">
								</div>
							</div>
						</div>
					</div>
				</div>

			</div>
			<div class="col-12 mg-b-20">
				<div class="card">
					<div class="card-header bg-primary tx-white tx-center font-weight-bold">Approval</div>
					<div class="card-body">
						<table class="table table-bordered table-hover table-striped" id="dtApproval">
							<thead class="thead-info">
								<tr>
									<th>Name</th>
									<th>Role</th>
									<th>Actions</th>
									<th style="width:15%;">Date &amp; Time</th>
									<th style="width:40%;">Comment</th>
								</tr>
							</thead>

						</table>
					</div>
				</div>
			</div> <!-- APPROVAL SEGMENT-->


		</div><!-- row -->
	</div><!-- container -->
</div><!-- content -->
<!-- content -->



<div class="modal fade wizard-modal" id="photo-modal" role="dialog">
	<div class="modal-dialog" style="min-width:90%;height:auto;">
		<div class="modal-content">
			<div class="modal-body">
				<div class="close"><i data-dismiss="modal" class="fa fa-times"></i></div>
				<div id="carousel" class="carousel slide" data-pause="true">
					<div class="carousel-inner">
						<div class="carousel-item active">
							<h5>Kategori</h5>
							<hr />
							<center>
								<button onclick="javascript:wizardButtonSetSelection(this)" type="button" class="wizard-button btn btn-primary">Splicing</button>
								<button onclick="javascript:wizardButtonSetSelection(this)" type="button" class="wizard-button btn btn-primary">Garniture</button>
								<button onclick="javascript:wizardButtonSetSelection(this)" type="button" class="wizard-button btn btn-primary">Length</button>
								<button onclick="javascript:wizardButtonSetSelection(this)" type="button" class="wizard-button btn btn-primary">Filter Melted</button>
								<button onclick="javascript:wizardButtonSetSelection(this)" type="button" class="wizard-button btn btn-primary">Aplikasi Glue</button>
								<button onclick="javascript:wizardButtonSetSelection(this)" type="button" class="wizard-button btn btn-primary">Posisi Capsule(TEWS)</button>
							</center>
						</div>
						<div class="carousel-item">
							<h5><label>Take picture for Filter</label></h5>
							<hr />
							<div class="row">
								<div class="col-md-12">
									<center>
										<select id="videoSource"><option value="" selected="selected"></option></select><br />
									</center>
								</div>
							</div>
							<div class="row">
								<div class="col-md-6">
									<center>
										<video autoplay="true" width="500" height="300" id="videoElement"> </video><br />
										<button id="snapHat">Capture Image </button><br />
									</center>
								</div>
								<div class="col-md-6">
									<center>
										<canvas id="snapshot" style="max-width: 500px;max-height: 300px !important"></canvas><br />
										<p id="demo"></p>

										<button id="capture" hidden>Read PDF417</button>  @*don't remove *@
										<button id="capture3" hidden>OCR ID </button>  @*don't remove*@
										<button id="saveText" hidden>Save Text + Image </button>   @*don't remove *@
									</center>
								</div>
							</div>
						</div>

						<div class="carousel-item">
							<h5>Photo Description</h5>
							<hr />
							<center>
								<input type="text" class="form-control" id="photo-notes">
							</center>
						</div>
					</div>

					<hr>
					<div>
						@*<button type="button" onclick="javascript:wizardButtonSetSelection(this)" id="btnNextPhoto" class="btn btn-xs btn-primary next" style="float:right;">Add</button>*@
						<button onclick="javascript:wizardButtonSetSelection(this)" type="button" id="btnNextPhoto" class="btn btn-xs btn-primary next" style="float:right;">Next</button>
					</div>


				</div>
			</div>
		</div>
	</div>

</div>
<div class="modal fade wizard-modal" id="photo-preview" role="dialog">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-body">
				<div class="close"><i data-dismiss="modal" class="fa fa-times"></i></div>
				<center>
					<img id="photo-preview-image" style="width: 75%;margin-bottom: 20px;" /><br />
					<p id="photo-preview-name"></p>
				</center>
			</div>
		</div>
	</div>
</div>
<div id="jsonModel" data-json='@Html.Raw(JsonConvert.SerializeObject(Model))' />
@section Scripts{

	<script src="~/Content/dashforge/lib/cleave.js/cleave.min.js"></script>
	<script src="~/Content/dashforge/lib/select2/js/select2.min.js"></script>
	<script src="~/Content/dashforge/lib/moment/moment.js"></script>
	<script src="~/Scripts/webcam_help/main.js"></script>
	<script src="~/Scripts/webcam_help/MRZ_417_230119.js"></script>


	<script src="~/Content/dashforge/lib/datatables.net/js/jquery.dataTables.min.js"></script>
	<script src="~/Content/dashforge/lib/datatables.net-dt/js/dataTables.dataTables.min.js"></script>
	<script src="~/Content/dashforge/lib/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
	<script src="~/Content/dashforge/lib/datatables.net-responsive-dt/js/responsive.dataTables.min.js"></script>
	<script type="text/javascript">
          $('#btnHistory').on('click', function (e) {
		    location.href = '@Url.Action("Index", "History")';
          });
        $('.datepicker').datepicker({
                format: 'D,d-M-yy',
                //language: 'id-id'
        });
        $('input[type=text]').on('input', function (e) {
            var val = e.currentTarget.value;
            var myRegexp = /^[a-zA-Z0-9\s\.\,\:]*/m;
            var match = myRegexp.exec(val);
            console.log(match);
            if (match == null) {
                if (e.preventDefault) e.preventDefault(); //normal browsers
                e.returnValue = false; //IE
            } else {
                if (match.join('') != val) {
                    e.currentTarget.value = e.currentTarget.value.substring(0, e.currentTarget.value.length-1);
                     e.preventDefault(); //normal browsers
                    e.returnValue = false; //IE
                }
            }
        });
        function editInitialStock() {
            $("#iconSave").show();
            $("#iconEdit").hide();
            $('#initialStock').attr("disabled", false);
        }
        function disabledInitialStock() {
            $("#iconSave").hide();
            $("#iconEdit").show();
            $('#initialStock').attr("disabled", true);
        }
        function editInitialStock2() {
            $("#iconSave2").show();
            $("#iconEdit2").hide();
            $('#initialStockDOS').attr("disabled", false);
            $('#initialStockPallete').attr("disabled", false);
        }
        function disabledInitialStock2() {
            $("#iconSave2").hide();
            $("#iconEdit2").show();
            $('#initialStockDOS').attr("disabled", true);
            $('#initialStockPallete').attr("disabled", true);
        }
        //$("#txtDateInfo").val(moment().format("ddd, DD-MMM-YY"));
        //$("#txtWeekNumber").val(moment().week());

	</script>
	<script>
        var selected = null;
        $(document).ready(function () {

            $("#iconSave").hide();
            $("#iconSave2").hide();
            var lphID = @(Model.LPH.ID);
            $('#dtApproval').dataTable({
                "autoWidth": false,
                "processing": true,
                "serverSide": true,
                "info": false,
                "filter": false,
                "bLengthChange": false,
                "orderMulti": false,
                "pageLength": 10,
                "destroy": true,
                "order": [[3, "asc"]],
                "ajax": {
                    "url": fastApp.BaseUrl + '/Filter/GetApproverList?lphid=' + lphID,
                    "type": "POST",
                    "datatype": "json"
                },

                "columnDefs":
                    [{
                        "targets": [0],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [1],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [2],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [3],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [4],
                        "searchable": true,
                        "orderable": true
                    },
                        //{
                        //       "targets": [5],
                        //       "searchable": true,
                        //       "orderable": true
                        //   },

                    ],

                "columns": [

                    { "data": "User", "name": "User", "title": "Name", "autoWidth": false },
                    { "data": "Role", "name": "Role", "title": "Role", "autoWidth": false },
                    { "data": "Status", "name": "Status", "title": "Status", "autoWidth": false },
                    //{ "data": "Approver", "name": "Approver", "title": "Approver", "autoWidth": false },
                    {
                        "data": "ModifiedDate",
                        render: function (data, type, row) {
                            if (data)
                                return moment(data).format("DD-MMM-YY HH:mm");
                            else
                                return '';
                        }
                    },
                    { "data": "Notes", "name": "Notes", "title": "Notes", "autoWidth": false }
                ],
                "fnRowCallback": function (nRow, data, iDisplayIndex, iDisplayIndexFull) {
                    $('td', nRow).css('background-color', data['Color']);
                    $('#dtApproval_paginate')[0].style.display = "none";
                }
            });
        });
	</script>
	<script>
		/*
			 * name = id dari tbody;
			 * data = array untuk menyimpan data;
			 * countSummary = dipanggil saat menghitung summary, return object dengan property sesuai dengan name pada `tfoot tr.input`;
			 * onAdd(newData) = dipanggil sebelum menambah data, return boolean apakah harus ditambahkan atau tidak;
			 * onDelete(idOfDeletedObject) = dipanggil sebelum menghapus data, return boolean apakah harus dihapus atau tidak;
			 * onSave(idOfUpdatedObject) = dipanggil sebelum mengubah data, return boolean apakah harus diubah atau tidak;
			 * onValidate(nameOfInput, valueOfInput) = validasi nilai saat tambah dan save, return boolean apakah harus diterus atau tidak;
			 *
			 * rowConfig = config untuk generate baris tabel;
			 * - withEdit = menampilkan edit, default true;
			 * - withDelete = menampilkan delete, default true;
			 * - additionalButtons(data) = fungsi untuk yang akan mengembalikan button tambahan untuk tiap baris, return element html dalam string;
			 */

		var bandrolData = [];
		var logbookData = [];
		var shooterData = [];
		var cbwData = [];
		var actionData = [];
		const configAle = {
			cbw: {
				data: cbwData,
				onValidate(name, val) {
					if (val == "") {
						alert("Value can't be empty");
						return true;
					}
					return false;
				},
				onDelete(id) {
					for (let j = 0; j < cbwData.length; j++) {
						if (cbwData[j].id == id) {
							for (let i = 0; i < imgContent.length; i++) {
								if (imgContent[i].name == cbwData[j].Filename) {
									imgContent.splice(i, 1);
									return false;
								}
							}
						}
					}
				},
				onCollectDataSingle(data) {
					if (data.FieldName == "Filename") {
						data.ValueType = "ImageURL/" + data.Value + "/" + "Old";
						for (let i = 0; i < imgContent.length; i++) {
							if (imgContent[i].name == data.Value) {
								data.ValueType = "ImageURL/" + data.Value + "/" + "New";
								data.Value = imgContent[i].data;
								break;
							}
						}
					}
					return data;
				},
				rowConfig: {
					withEdit: false,
					additionalButtons(data) {
						return `
																										<i data-toggle="modal" data-target="#photo-preview" onclick="javascript:setPreview('${data.Filename}')" class="fa fa-image"></i>
																										<i data-toggle="modal" data-target="#photo-modal" onclick="javascript:setEditName('${data.Filename}')" class="fa fa-camera"></i>
																															`;
					}
				},
			},
			bandroltake: {
				data: bandrolData,
				countSummary: function () {
					let rowData = {};
					let weight = 0;
					for (var i = 0; i < bandrolData.length; i++) {
						weight += parseInt(bandrolData[i].weight);
					}
					rowData.weight = weight + " pcs";
					return rowData;
				},
			},
			logbook: {
				data: logbookData,
				onValidate(name, val) {
					if (val == "") {
						alert("Value can't be empty");
						return true;
					}
					return false;
				},
				onAdd: function (newData) {
					console.log(newData);
				},
			},
			shooter: {
				data: shooterData,
				onValidate(name, val) {
					if (val == "") {
						alert("Value can't be empty");
						return true;
					}
					return false;
				},
				countSummary: function () {
					let rowData = {};
					let ShooterPcs = 0;
					for (var i = 0; i < shooterData.length; i++) {
						ShooterPcs += parseInt(shooterData[i].ShooterPcs);
					}
					rowData.ShooterPcs = ShooterPcs;
					return rowData;
				},
				onAdd: function (newData) {
					console.log(newData);
				},
			},
			action: {
				data: actionData,
				onValidate(name, val) {
					if (val == "") {
						alert("Value can't be empty");
						return true;
					}
					return false;
				},
				countSummary: function () {
					let rowData = {};
					let NextDurasi = 0;
					for (var i = 0; i < actionData.length; i++) {
						NextDurasi += parseInt(actionData[i].NextDurasi);
					}
					rowData.NextDurasi = NextDurasi;
					return rowData;
				},
				onAdd: function (newData) {
					console.log(newData);
				},
			},
		}
		let isEditImage = null;
		function setEditName(name) {
			isEditImage = name;
			showhidecanvas(true);
		}
		function setPreview(name) {
			for (let i = 0; i < imgContent.length; i++) {
				if (imgContent[i].name == name) {
					$("#photo-preview-name").html("Click image to zoom");
					$("#photo-preview-image").attr("src", imgContent[i].data);
					$('#photo-preview-image').attr('onclick', `printImage('` + imgContent[i].name + `')`);
					return;
				}
			}
			for (let i = 0; i < cbwData.length; i++) {
				if (cbwData[i].Filename == name) {
					$("#photo-preview-name").html("Click image to zoom");
					$("#photo-preview-image").attr("src", fastApp.BaseUrl + "/Uploads/lph/filter/" + cbwData[i].Filename);
					$('#photo-preview-image').attr('onclick', `printImage('` + cbwData[i].Filename + `')`);
				}
			}
		}
	</script>
	<script>
		$(function () {
			'use strict'
			console.log("chanif");

			/******************** PREFILLED ******************/

			var model = JSON.parse($("#jsonModel").attr("data-json"));

			for (var i = 0; i < model.CompoVal.length; i++) {
				const tn = model.CompoVal[i].Component.ComponentName.split("-");
				const type = model.CompoVal[i].Component.ComponentType.trim();
				const parent = tn[0];
				tn.shift();
				const child = tn.join("-");
				const val = model.CompoVal[i].Value.Value;
				const node = $("#" + parent + " " + type + "[name=" + child + "]");
				var temp_val = decodeURIComponent(val ? val : "");
				$(node).val(temp_val);
				if ($(node).hasClass("select2")) {
					if (temp_val.indexOf('___') !== -1) {
						temp_val = temp_val.split('___');
						$(node).val(temp_val);
					}
					$(node).trigger('change');
				}

			}
			while (model.Extras.length > 0) {
				const lastIndex = model.Extras.length - 1;
				const table = model.Extras[lastIndex].HeaderName;
				const row = model.Extras[lastIndex].RowNumber;
				let data = {
					id: uuidv4()
				};
				for (let i = lastIndex; i >= 0; i--) {
					if (model.Extras[i].HeaderName == table && model.Extras[i].RowNumber == row) {
						const val = model.Extras[i].Value;
						data[model.Extras[i].FieldName] = decodeURIComponent(val ? val : "");
						if (model.Extras.length == 1) model.Extras = [];
						else model.Extras.splice(i, 1);
					}
				}
				configAle[table].data.push(data);
			}
			for (let prop in configAle) {
				configAle[prop].data.reverse();
				$("#" + prop).html(generateTable(configAle[prop].data, prop));
				countSummary(prop);
				ieFix();
			}
			counterSaveImage = cbwData.length + 4;
		});
		console.log("cbw");
		console.log(cbwData);
		/****************** END PREFILLED ****************/
	</script>
	<script>
		function ieFix() {
			//if (navigator.userAgent.search("Edge") >= 0) {
			//    $(".tableWrapper:has(tfoot)").each(function () {
			//        $(this).find("tfoot tr.input").css({ "position": "fixed", "bottom": "-0.5px" });
			//        $(this).find("table").css({ "margin-bottom": "32px" });
			//        $(this).css({ "overflow-y": "scroll" });
			//        const ths = $(this).find("thead tr:first-child th");
			//        $(this).find("tfoot td").each(function (i) {
			//            $(this).css({ "min-width": $($(ths)[i]).width() + 20, "position": "static" });
			//        });
			//    });
			//}
		}
		function uuidv4() {
			return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
				(c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));
		}

		function generateRow(data, targetTable) {
			let r = "";
			$(`#${targetTable} ~ tfoot tr.input td`).children("input, select").each(function () {
				const name = $(this).prop("name");
				r += `<td data-name="${name}">${data[name]}</td>`;
			});

			let useEdit = true;
			let useDelete = true;
			let additionalButtons = "";
			if (configAle[targetTable].rowConfig !== undefined) {
				if (configAle[targetTable].rowConfig.withEdit !== undefined)
					useEdit = configAle[targetTable].rowConfig.withEdit;
				if (configAle[targetTable].rowConfig.withDelete !== undefined)
					useDelete = configAle[targetTable].rowConfig.withDelete;
				if (configAle[targetTable].rowConfig.additionalButtons != undefined)
					additionalButtons = configAle[targetTable].rowConfig.additionalButtons(data);
			}
			r += `<td class="tx-center">`;
			r += additionalButtons;
			if (useEdit) r += `<i onclick="javascript:editData(this)" data-id="${data.id}" data-target-table="${targetTable}" class="fa fa-edit edit"></i>`;
			if (useDelete) r += `<span onClick="javascript:deleteData(this)" data-id="${data.id}" data-target-table="${targetTable}"><i class="fa fa-trash"></i></span>`;
			r += `</td >`;
			return r;
		}
		function generateTable(arr, targetTable) {
			if (arr.length == 0) return "";
			let rows = "";
			for (var i = arr.length - 1; i >= 0; i--) {
				rows += '<tr>';
				rows += generateRow(arr[i], targetTable);
				rows += '</tr>';
			}
			return rows;
		}
		function findInArray(id, crr) {
			for (var i = 0; i < crr.length; i++) {
				if (crr[i].id == id) {
					return i;
				}
			}
		}
		function deleteFromArray(id, crr) {
			crr.splice(findInArray(id, crr), 1);
			return crr;
		}
		function editData(button) {
			const table = $(button).parents("table");
			if (!$(table).data("edited")) {
				$(table).data("edited", true);

				const tds = $(button).parents("tr").children('td');
				const inputTr = $(table).find('tr.input');
				const inputTds = $(inputTr).children('td');
				const tdsCount = $(tds).length;

				$(tds).each(function (i, e) {
					const el = $(inputTds[i]).children()[0];
					if (i != tdsCount - 1) {
						const html = $(e).html();
						const newInput = $(el).clone();
						if ($(el).hasClass('select2'))
							$(el).val(null).trigger("change");
						else
							$(el).val("");
						if (!$(el).hasClass("disabled"))
							$(newInput).prop("disabled", false);

						$(el).prop("disabled", true);
						$(newInput).val(html);
						$(e).html(newInput);
						if ($(el).hasClass('select2')) {
							$(newInput).select2('destroy');
							$(newInput).removeAttr('data-select2-id');
							$(newInput).select2({
								allowClear: true,
								placeholder: 'Choose one',
								searchInputPlaceholder: 'Search options'
							});
						}
					} else {
						$(el).off("click");
						const edit = $(e).find(".edit");
						$(edit).attr("onclick", "javascript:normalData(this)");
						$(edit).removeClass("fa-edit");
						$(edit).addClass("fa-save");
					}
				});
			}
			$('.date').toArray().forEach(function (field) {
				new Cleave(field, {
					time: true,
					timePattern: ['h', 'm']
				});
			});
			basicFunction();
			ieFix();
		}
		function basicFunction() {
			$('.select2').select2({
				allowClear: true,
				placeholder: 'Choose one',
				searchInputPlaceholder: 'Search options'
			});
			$('#prodTech').select2('destroy');
			$('#prodTech').select2({
				placeholder: 'Choose one or more',
				searchInputPlaceholder: 'Search options'
			});

			$(document).find('.input-time').each(function () {
				var cleave = new Cleave($(this), {
					time: true,
					timePattern: ['h', 'm']
				});
			})
		}
		function releaseDisabledInput(table) {
			$(table).data("edited", false);
			const tds = $(table).find('tr.input td');
			const tdsCount = $(tds).length;
			$(tds).each(function (i, e) {
				const el = $(e).children()[0];
				if (i != tdsCount - 1) {
					if (!$(el).hasClass("disabled"))
						$(el).prop("disabled", false);
				} else {
					var ev = $._data(el, 'events');
					if (!(ev && ev.click))
						$(el).on("click", addToTable);
				}
			});
		}
		function wizardButtonSetSelection(button) {
			selected = $(button).html();
			wizardButtonNext(button);
		}
		function wizardButtonNext(button) {
			const modal = $(button).parents(".modal");
			const carousel = $(modal).find('.carousel');
			const index = $(carousel).find('.carousel-item.active').index();
			const stepper = $(modal).find('.stepper');

			var info = { shouldReturn: false, shouldHide: false };
			$(modal).trigger("next", [index, info]);
			if (info.shouldReturn) return;
			if (info.shouldHide) { $(modal).modal('hide'); return; }

			$(stepper).children('.active').removeClass("active");

			$(carousel).carousel('next');
			$(stepper).children(`.stepper-step:nth-child(${index + 2})`).toggleClass("active");
			$(modal).find(".prev").show();
		};
		function generateWizardButton(arr) {
			let r = "";
			for (var i = 0; i < arr.length; i++) {
				r += `<button type="button" class="wizard-button btn btn-primary" onclick="javascript:wizardButtonSetSelection(this)">${arr[i]}</button>`;
			}
			return r;
		}
		function startupSetup(target, data) {
			$(target).html(generateTable(data, target));
			countSummary(target);
		}
		$(document).ready(function () {

			$('.select2').select2({
				allowClear: true,
				placeholder: 'Choose one',
				searchInputPlaceholder: 'Search options'
			});
			$('#prodTech').select2('destroy');
			$('#prodTech').select2({
				placeholder: 'Choose one or more',
				searchInputPlaceholder: 'Search options'
			});
			$('.date').toArray().forEach(function (field) {
				new Cleave(field, {
					time: true,
					timePattern: ['h', 'm']
				});
			});
			$(".add-to-table").on("click", addToTable);
			$('.tableWrapper thead tr').each(function () {
				const top = $(this).position().top;
				$(this).children().css({ "top": top });
			});
			$(".wizard-modal .next").click(wizardButtonNext);
			$(".wizard-modal .prev").click(function () {
				const modal = $(this).parents(".modal");
				const carousel = $(modal).find('.carousel');
				const stepper = $(modal).find('.stepper');
				const index = $(carousel).find('.carousel-item.active').index();

				$(stepper).children('.active').removeClass("active");

				$(carousel).carousel('prev');
				$(stepper).children(`.stepper-step:nth-child(${index})`).toggleClass("active");
				if (index == 1) $(modal).find(".prev").hide();
			});
			$('.wizard-modal').on('hidden.bs.modal', function (e) {
				const carousel = $(this).find('.carousel');
				const stepper = $(this).find('.stepper');
				$(this).find('.active').removeClass("active");
				$(stepper).children(".stepper-step:first-child").toggleClass("active");
				$(carousel).find(".carousel-item:first-child").toggleClass("active");
				$(this).trigger("hide");
				$(this).find(".prev").hide();
			});
		});
		var counterSaveImage = 4; //counter autosave setiap insert 5 image
		function addToTable(button) {
			const targetTable = $(this).data("target");
			const tds = $(this).parents("tr").children("td");
			var newdata = {
				id: uuidv4()
			};
			let shouldReturn = false;
			$(tds).each(function (tdIndex, td) {
				const input = $(td).children();
				if (input.attr("name") != undefined) {
					const name = input.attr("name");
					const val = input.val();
					if (configAle[targetTable].onValidate != undefined) {
						if (configAle[targetTable].onValidate(name, val)) {
							shouldReturn = true;
							if ((input[0].nodeName.toLowerCase() === 'select')) {
								$(input[0]).siblings(".select2-container").css('border', '1px solid red');
								$(input[0]).siblings(".select2-container").css('border-radius', '0.25rem');
								$(input[0]).on('select2:select', function (e) {
									$(input[0]).siblings(".select2-container").css('border', 'none');
									$(input[0]).siblings(".select2-container").css('border-radius', '0');
								});
							} else if (input[0].value === "") {
								input[0].style.borderColor = "red";
								$(input[0]).on('click', function (e) {
									input[0].style.borderColor = "rgb(192, 204, 218)";
								});
							}
							return false;
						}
					}
					if (input[0].type.toLowerCase() == "number") {
						var myRegexp = /^00+$/g;
						var match = myRegexp.exec(val);
						if (match != null) {
							alert("Please input a valid number");
							shouldReturn = true;
							return false;
						}
					}
					newdata[name] = val;
				}
			});
			if (shouldReturn) return;
			$(tds).each(function (i, td) {
				const node = $(td).children();
				$(node).val("");
				if ($(node).hasClass("select2"))
					$(node).trigger('change');
			});

			if (configAle[targetTable].onAdd != undefined) {
				if (configAle[targetTable].onAdd(newdata)) {
					return;
				}
			}
			configAle[targetTable].data.push(newdata);
			$("#" + targetTable).html(generateTable(configAle[targetTable].data, targetTable));
			countSummary(targetTable);
			ieFix();
			if (cbwData.length >= counterSaveImage) {
				$('#loading_overlay').removeClass('d-none');
				$("#btnSaveDraft").trigger('click');
				counterSaveImage = -1;
			}
		}
		function countSummary(targetTable) {
			if (configAle[targetTable].countSummary != undefined) {
				const rowData = configAle[targetTable].countSummary();
				const summaryTds = $('#' + targetTable).parents('table').find('.summary-body').children();
				$('#' + targetTable).parents('table').find('.input td').each(function (i, td) {
					const name = $(td).children().attr("name");
					if (rowData.hasOwnProperty(name))
						$(summaryTds[i]).html(rowData[name]);
				});
			}
		}
		function deleteData(button) {
			if (confirm("Are you sure?")) {
				const id = $(button).data("id");
				const targetTable = $(button).data("target-table");
				const table = $(button).parents("table");
				releaseDisabledInput(table);
				if (configAle[targetTable].onDelete != undefined) {
					if (configAle[targetTable].onDelete(id)) {
						return;
					}
				}
				deleteFromArray(id, configAle[targetTable].data);
				$('#' + targetTable).html(generateTable(configAle[targetTable].data, targetTable));
				countSummary(targetTable);
				ieFix();
			}
		}
		function normalData(button) {
			if (confirm("Are you sure?")) {
				const id = $(button).data("id");
				const targetTable = $(button).data("target-table");
				const tds = $(button).parents("tr").children('td');
				const tdsCount = $(tds).length;
				const table = $(button).parents("table");

				if (configAle[targetTable].onSave != undefined) {
					if (configAle[targetTable].onSave(id)) {
						return;
					}
				}
				const index = findInArray(id, configAle[targetTable].data);
				let shouldReturn = false;
				var newdata = {
					id: uuidv4()
				};
				$(tds).each(function (tdIndex, e) {
					if (tdIndex != tdsCount - 1) {
						const name = $(e).data("name");
						const val = $($(e).children()[0]).val();
						if (configAle[targetTable].onValidate != undefined) {
							if (configAle[targetTable].onValidate(name, val)) {
								shouldReturn = true;
								return false;
							}
						}
						newdata[name] = val;
					} else {
						const edit = $(e).find(".edit");
						$(edit).attr("onclick", "javascript:editData(this)");
						$(edit).removeClass("fa-save");
						$(edit).addClass("fa-edit");
					}
				});
				if (shouldReturn) return;

				configAle[targetTable].data[index] = newdata;
				const row = generateRow(configAle[targetTable].data[index], targetTable);
				$(button).parents("tr").html(row);

				releaseDisabledInput(table);
				countSummary(targetTable);
				ieFix();
			}
		}
		function countDuration(start, end, duration) {
			var end = $('#' + end).val();
			var start = $('#' + start).val();

			if (start != "" && end != "") {
				end = end.split(':');
				start = start.split(':');
				var d = new Date();
				var startdate = new Date(d.getFullYear(), d.getMonth(), d.getDate(), start[0], start[1]);
				var enddate = new Date(d.getFullYear(), d.getMonth(), d.getDate(), end[0], end[1]);

				if (startdate > enddate) {
					enddate = new Date(enddate);
					enddate.setDate(enddate.getDate() + 1);
				}

				var diffTime = enddate - startdate;
				var diffMinutes = Math.ceil(diffTime / 60000);
				if (diffMinutes == NaN) {
					$('#' + duration).val(0);
				} else {
					$('#' + duration).val(diffMinutes);
				}
			}
		};

		function collectAllComponent() {
			let components = [];
			let values = [];
			$('.collect-component').each(function (i, p) {
				const id = $(p).prop("id");
				$(this).find('input, select, textarea').each(function (i2, e) {
					components.push({
						ComponentType: $(e).prop('nodeName'),
						ComponentName: id + "-" + $(e).prop('name'),
					})
					var tem_value = $(e).val();
					if (Array.isArray(tem_value)) {
						tem_value = tem_value.join('___');
					}
					values.push({
						Value: tem_value,
						ValueType: $(e).attr('type') == "number" ? "Numeric" : "NonNumeric",
					});
				});
			});
			console.log(components, values);
			return [components, values];
		}


		function collectAllData() {
			let collectorArray = [];
			let collectorImages = [];
			for (var tableId in configAle) {
				let tableColumnType = {};
				$(`#${tableId} ~ tfoot tr.input td input`).each(function () {
					tableColumnType[$(this).prop("name")] = $(this).prop("type");
				});
				const data = configAle[tableId].data;
				for (let i = 0; i < data.length; i++) {
					if (configAle[tableId].onCollectDataRow != undefined) {
						data[i] = configAle[tableId].onCollectDataRow(data[i]);
					}
					for (var prop in data[i]) {
						if (Object.prototype.hasOwnProperty.call(data[i], prop)) {
							if (prop == "id") continue;
							let newInsertData = {
								HeaderName: tableId,
								FieldName: prop,
								Value: data[i][prop],
								ValueType: tableColumnType[prop] == "number" ? "Numeric" : "NonNumeric",
								RowNumber: i
							};
							if (configAle[tableId].onCollectDataSingle != undefined) {
								newInsertData = configAle[tableId].onCollectDataSingle(newInsertData);
							}
							if (newInsertData.FieldName == "Filename") {
								collectorImages.push(newInsertData);
							} else {
								collectorArray.push(newInsertData);
							}
						}
					}
				}
			}

			console.log(collectorArray);
			return {
				extras: collectorArray,
				extrasImages: collectorImages,
			};
		}
	</script>


	<script>
		$('#goPrev').click(function () {
                $.ajax({
                  type: "POST",
                  url: "@Url.Action("CheckPrev", "Filter")",
                  data: JSON.stringify({
                      LPHID: @(Model.LPH.ID),
					  machine: $('#machInfo').val()
                  }),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  success: function (result) {
					if (result.Status) {
						//ketika data ada, munculkan dalam window baru
                        window.open("@(Url.Action("Submitted", "Filter"))?lphid="+result.LPHID+"&type=1", "window baru", "height=400,width=1300");
					}
					else {
						var notice = new PNotify({
							title: "@UIResources.ErrorMessage",
							text: "No previous submissions found",
							width: "400px",
                            type: 'error',
                            addclass: 'stack-bottomright',
							hide: false,
							buttons: {
								sticker: false
							}
						});

						notice.get().click(function () {
								notice.remove();
							});
						}
                    }
                });
            })

            var statusScroll = true;
            function checkMandatory() {
                var mandatory = $(".mandatory");
                const headerHeight = $(".navbar.navbar-header.navbar-header-fixed").outerHeight();
                var status = true;
                for (var i = 0; i < mandatory.length; i++) {
                    if (($(mandatory[i])[0].nodeName.toLowerCase() === 'select') && $(mandatory[i])[0].value === "") {
                        if (statusScroll == true) {
                            window.scrollTo(0, Math.max(0, $(mandatory[i]).offset().top - headerHeight- 100));
                            statusScroll = false;
                        }
                        $(mandatory[i]).siblings(".select2-container").css('border', '1px solid red');
                        $(mandatory[i]).siblings(".select2-container").css('border-radius', '0.25rem');
                        $(mandatory[i]).parent().prepend($('<span>', {
                            style: "color:red; display:block; float:left;",
                            id: "mandatory-error-" + i,
                            html: '!',
                            class: 'row'
                        }));
                        $(mandatory[i]).on('select2:select', function (e) {
                            $(e.target).siblings(".select2-container").css('border', 'none');
                            $(e.target).siblings(".select2-container").css('border-radius', '0');
                            $(e.target).parent().find('span.row').remove();
                        });
                        status = false;
                    } else if ($(mandatory[i])[0].value === "") {
                        if (statusScroll == true) {
                            window.scrollTo(0, Math.max(0, $(mandatory[i]).offset().top - headerHeight- 100));
                            statusScroll = false;
                        }
                        $(mandatory[i])[0].style.borderColor = "red";
                        $(mandatory[i]).parent().prepend($('<span>', {
                            style: "color:red; display:block; float:left;",
                            id: "mandatory-error-" + i,
                            html: '!',
                            class: 'row'
                        }));
                        $(mandatory[i]).on('click', function (e) {
                            e.target.style.borderColor = "rgb(192, 204, 218)";
                            $(e.target).parent().find('span.row').remove();
                        });
                        $(mandatory[i]).on('focus', function (e) {
                            e.target.style.borderColor = "rgb(192, 204, 218)";
                            $(e.target).parent().find('span.row').remove();
                        });
                        status = false;
                    }
                }
                if (cbwData.length == 0) {
                    const card = $("#cbw").closest(".card");
                    if (statusScroll == true) {
                        window.scrollTo(0, Math.max(0, $(card[i]).offset().top - headerHeight- 100));
                        statusScroll = false;
                    }
                    $(card).css("border-color", "red");
                    $(card).prepend($('<span>', {
                        style: "color: red; position: absolute; left: -10px;",
                        html: '!'
                    }));
                    $(card).find("img").on('click', function () {
                        $(this).closest(".card").css('border-color', 'rgba(72, 94, 144, 0.16)');
                        $(this).closest(".card").children("span").first().remove();
                    });
                    status = false;
                }
                return status;
            }

		function saveLPH(isSubmit) {
			var extrasArray = collectAllData(); // for LPH Extras
			var collectorArray = extrasArray.extras;
			var collectorImages = extrasArray.extrasImages;
            var collector = collectAllComponent();
            var collectorComponent = collector[0];
            var collectorValue = collector[1];

			$.ajax({
				type: "POST",
				url: "@Url.Action("Edit", "Filter")",
				data: JSON.stringify({
					id:@(Model.LPH.ID),
					isSubmit: isSubmit,
					detailExtras: collectorArray,
					detailComponent: collectorComponent,
					detailValue: collectorValue
				}),
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function (result) {
					console.log(result.Status);
					if (result.Status == 'True') {
						// upload images extras
						$.ajax({
							type: "POST",
							url: "@Url.Action("UploadExtrasImages", "Filter")",
							data: JSON.stringify({
								id:@(Model.LPH.ID),
								detailExtras: collectorImages
							}),
							contentType: "application/json; charset=utf-8",
							dataType: "json",
							success: function (result) {
								console.log(result.Status);
								if (result.Status == 'True') {
									if (isSubmit == 1) {
										var notice = new PNotify({
											title: "@UIResources.Confirmation",
											text: "@UIResources.EditSucceed",
											width: "400px",
											type: 'success',
											addclass: 'stack-bottomright'
										});

										notice.get().click(function () {
											notice.remove();
										});

										setTimeout(function () {
											location.reload();
										}, 3000);
									}
									else {
										var notice = new PNotify({
											title: "@UIResources.Confirmation",
											text: "@UIResources.EditSucceed",
											width: "400px",
											type: 'success',
											addclass: 'stack-bottomright'
										});

										setTimeout(function () {
											notice.remove();
										}, 3000);

										if (counterSaveImage == -1) {
											alert("Warning your page will be reload, to ensure your data isn't lost");
											window.location.reload(true);
										}
									}
								}
							}
						});
					}
					else {
						var notice = new PNotify({
							title: "@UIResources.ErrorMessage",
							text: "@UIResources.EditFailed",
							width: "400px",
							type: 'error',
							addclass: 'stack-bottomright',
							hide: false,
							buttons: {
								sticker: false
							}
						});

						notice.get().click(function () {
							notice.remove();
						});
					}
				},
				error: function (request, status, error) {
					window.location.reload(true);
				},
				complete: function () {
					$('#loading_overlay').addClass('d-none');
				},
			});
        }

        $(window).load(function(){
            setInterval(function () {
                $('#loading_overlay').removeClass('d-none');
                saveLPH(0);
            }, 10 * 60 * 1000);
        });

        $("#machInfo").on('select2:select', function (e) {
            getLastStock();
        });

        function getLastStock() {
            var shift = $("#shift").val();
            var machine = $("#machInfo").val();
            if (machine != "") {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("GetLastStock", "Filter")",
                    data: JSON.stringify({
                        machine: machine,
                        LPHID: @(Model.LPH.ID)
                    }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        console.log(result.Status);
                        if (result.Status == 'True') {
                            $('#initialStockDOS').val(result.DOS);
                            $('#initialStockPallete').val(result.pallet);
                            $('#initialStock').val(result.manual);
                            $('#UsTowStockAwal').val(result.tow);
                        } else {
                            $('#initialStockDOS').val(result.DOS);
                            $('#initialStockPallete').val(result.pallet);
                            $('#initialStock').val(result.manual);
                            $('#UsTowStockAwal').val(result.tow);
                        }
                    }
                });
            }
        }

        $('#btnSaveDraft').click(function (e) {
            $('#loading_overlay').removeClass('d-none');
            saveLPH(0);
        });

        $('#btnSave').click(function (e) {
            statusScroll = true;
            if (checkMandatory()) {
                $('#loading_overlay').removeClass('d-none');
                saveLPH(1);
            }else {
                    var notice = new PNotify({
						    title: "Warning",
						    text: "Submit failed, input field with red border, and photo can't be empty",
						    width: "400px",
                            type: 'error',
                            addclass: 'stack-bottomright',
						    hide: false,
						    buttons: {
							    sticker: false
						    }
                    });
                    setTimeout(function(){
                            notice.remove();
                    }, 8000);
                }
        });


        $('#btnReset').click(function () {
            var redirect = confirm("You can track unsubmitted data in menu 'LPH SP > History'");
            if (redirect) {
                window.location.href = "@(Url.Action("Index", "Filter"))/?reset=true";
                @* DeleteLPH(@(Model.LPH.ID));*@
            }
        });


            $('#btnNewLPH').click(function () {
                window.open("@(Url.Action("Index", "Filter"))/?reset=true");
            });

        function DeleteLPH(Id) {
            $('#loading_overlay').removeClass('d-none');
            $.ajax({
                url: fastApp.BaseUrl + '/History/Delete?lphid=' + Id,
                type: 'POST',
                success: function (result) {
                    if (result.Status) {
                        var notice = new PNotify({
                            title: "@UIResources.Confirmation",
                            text: 'Reset LPH Successfully',
                            width: "400px",
                            type: 'success',
                            addclass: 'stack-bottomright'
                        });

                        notice.get().click(function () {
                            notice.remove();
                        });
                    }
                    else {
                        var notice = new PNotify({
                            title: "@UIResources.ErrorMessage",
                            text: "@UIResources.DeleteFailed",
                            width: "400px",
                            type: 'error',
                            hide: false,
                            addclass: 'stack-bottomright',
                            buttons: {
                                sticker: false
                            }
                        });

                        notice.get().click(function () {
                            notice.remove();
                        });
                    }
                    $('#loading_overlay').addClass('d-none');
                },
                complete: function (data) {
                    $('#loading_overlay').addClass('d-none');
                    setTimeout(function () {
                        window.location.href = "@(Url.Action("Index", "Filter"))";
                    }, 1000);
                }
            });
        }
	</script>

	<script>
		var selected = null;

		$(document).ready(function () {
			//$("#photo-modal").on('next', function (e, index, info) {
			//	if (!newImage) {
			//		info.shouldReturn = true;
			//		return;
			//	}
			//	const tr = $('#cbw ~ tfoot tr.input');
			//	info.shouldHide = true;
			//	if (isEditImage == null) {
			//		imgContent.push(newImage);
			//		$(tr).find('input[name="Filename"]').val(newImage.name);
			//		$('.add-to-table[data-target="cbw"]').click();
			//	} else {
			//		let isOld = false;
			//		for (let i = 0; i < imgContent.length; i++) {
			//			if (imgContent[i].name == isEditImage) {
			//				imgContent[i] = newImage;
			//				isOld = true;
			//			}
			//		}
			//		if (!isOld) imgContent.push(newImage);
			//		for (let i = 0; i < cbwData.length; i++) {
			//			if (cbwData[i].Filename == isEditImage) {
			//				cbwData[i].Filename = newImage.name;
			//			}
			//		}
			//		$("#cbw").html(generateTable(configAle.cbw.data, "cbw"));
			//		ieFix();
			//		isEditImage = null;
			//	}
			//	console.log(imgContent, cbwData);
			//});
			//$('#photo-modal').on('hide', function (e) {
			//	$(this).find(".next").html("Next");
			//	$("#photo-notes").val("");
			//	newImage = null;
			//});
			$("#photo-modal").on('next', function (e, index, info) {

				if (!selected) {
					info.shouldReturn = true;
					return;
				}
				const tr = $('#cbw ~ tfoot tr.input');
				switch (index) {
					case 0:
						const tr2 = $('#cbw ~ tfoot tr.input');
						//$(this).find(".next").show();
						$(tr2).find('input[name="Kategori"]').val(selected);
						$(this).find(".next").html("Next");
						if (isEditImage != null) {
							for (let i = 0; i < cbwData.length; i++) {
								if (cbwData[i].Filename == isEditImage) {
									cbwData[i].Kategori = selected;
								}
							}
						}
						break;
					case 1:
						$(this).find(".next").html("Add");
						if (!newImage) {
							info.shouldReturn = true;
							return;
						}
						break;
					case 2:
						info.shouldHide = true;

						if (isEditImage == null) {
							imgContent.push(newImage);
							$(tr).find('input[name="Filename"]').val(newImage.name);
							$(tr).find('input[name="Remark"]').val($("#photo-notes").val());
							$('.add-to-table[data-target="cbw"]').click();
						} else {
							for (let i = 0; i < imgContent.length; i++) {
								if (imgContent[i].name == isEditImage) {
									imgContent[i] = newImage;
								}
							}
							for (let i = 0; i < cbwData.length; i++) {
								if (cbwData[i].Filename == isEditImage) {
									cbwData[i].Filename = newImage.name;
									cbwData[i].Remark = $("#photo-notes").val();
								}
							}
							$("#cbw").html(generateTable(configAle.cbw.data, "cbw"));
							ieFix();
							isEditImage = null;
						}
						break;
				}
			});
			$('#photo-modal').on('hide', function (e) {
				$(this).find(".next").html("Next");
				$("#photo-notes").val("");
				newImage = null;
			});

			$("#image_0").click(function () {
				addIndex = -1;
				showhidecanvas(true);
			});
		});</script>

	<script>
        var isUrlLink = false;
        var isImg = [];
        var imgContent = [];
        var addIndex = -1;
        var newImage = null;

        function infoId(e) {
            console.log("ID info : " + e.id);

            for (var i = 0; i < imgContent.length; i++) {
                isImg[i] = e.id == "image_" + (i + 1) + "";
            }
        }

        function renderImage(link, state) {

            if (link == null || link == "") {
                isUrlLink = false;
            }
            else {

                isUrlLink = true;
                console.log("link " + link);
                console.log("addIndex: " + addIndex);
                let fn = new Date().getTime() + "_" + (Math.floor(Math.random() * 9999999999) + 1000000000) + ".jpeg";
                newImage = {
                        name: fn,
                        data: link
                    };
                @*for (var i = 0; i < max; i++) {
                    if (state == "image_" + (i + 1) + "") {
                        imgContent[i] = link;
                        document.getElementById("image_'+(i+1)+'"_show").innerHTML = '<img class="input - img rounded mx - auto d - block" src=' + imgContent[i] + ' id="image_'+(i+1)+'" data-toggle="modal" data-target="#photo - modal" width="auto" />';
                    }
                }*@

            }
        }

	</script>

	<script>
		// Video Part
		var video = document.querySelector("#videoElement");
		var hdConstraints = { video: { mandatory: { minWidth: 160, minHeight: 120 } } };
		var hhdConstraints = { video: { mandatory: { minWidth: 160, minHeight: 120 } } };
		var vgaConstraints = {
			video: {
				mandatory: {
					maxWidth: 160,
					maxHeight: 120
				}
			}
		};
		navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;

		if (navigator.getUserMedia) {
			document.getElementById("demo").innerHTML = "";

			try {
				navigator.getUserMedia(hhdConstraints, handleVideo, videoError);
			} catch (error) {
				navigator.getUserMedia(hdConstraints, handleVideo, videoError);
			}
		}

		function handleVideo(stream) {
			try {
				this.srcObject = stream;
			} catch (error) {
				this.src = window.URL.createObjectURL(stream);
			}
		}

		function videoError(e) {
			// do something
		}</script>

	<script>
		// Capture Image Part
		var player = document.getElementById('videoElement');
		var snapshotCanvas = document.getElementById('snapshot');
		var captureButton = document.getElementById('capture');
		var captureButton3 = document.getElementById('capture3');
		var textBottom = document.getElementById('saveText');

		var canvas = document.querySelector('canvas');
		var ctx = canvas.getContext('2d');
		var txfname = "img_text";
		var XdatStr = 'date';

		textBottom.addEventListener('click', function () {
			var temp = new Date();
			var minth = 1 + temp.getMonth();
			var dateStr = temp.getFullYear() + '_' +
				minth + '_' +
				temp.getDate() + '-' +
				temp.getHours() + '_' +
				temp.getMinutes() + '_' +
				temp.getSeconds();
			XdateStr = dateStr;
			txfname = 'IMG_' + dateStr;

			saveTextAsFile(txfname);
			pcanvas2blob().then(download2X);

			document.getElementById("demo").innerHTML = "saved ";

		});

		captureButton.addEventListener('click', function () {
			document.getElementById("demo").innerHTML = "Reading PDF417.";

			var VH = 1080;
			var VW = 1920;

			VH = video.videoHeight;
			VW = video.videoWidth;

			ctx.canvas.width = VW;
			ctx.canvas.height = VH;

			ctx.drawImage(video, 0, 0);


			var imgd = ctx.getImageData(0, 0, VW, VH);
			var pix = imgd.data;

			var nDataBytes = VH * VW * 4;

			var pdf417Heap = new Uint8Array(Module.HEAPU8.buffer, 1028);

			var buf = Module._malloc(nDataBytes);
			Module.HEAPU8.set(pix, buf);

			// Draw the ImageData at the given (x,y) coordinates.
			ctx.putImageData(imgd, 0, 0);

			var b = _pdf417JS(buf, VH, VW, 1024);

			var heapBu = new Uint8Array(Module.HEAPU8.buffer, buf, 1028);
			var vanz = bin2Strung(heapBu);


			if (b <= 0) {
				vanz = "No Read.";
			}

			Module._free(buf);
			document.getElementById("demo").innerHTML = vanz;

		});

		captureButton3.addEventListener('click', function () {
			document.getElementById("demo").innerHTML = " OCRing MRZ. ";

			var VH = 1080;
			var VW = 1920;
			VH = video.videoHeight;
			VW = video.videoWidth;

			ctx.canvas.width = VW;
			ctx.canvas.height = VH;

			ctx.drawImage(video, 0, 0);

			var imgd = ctx.getImageData(0, 0, VW, VH);
			var pix = imgd.data;

			var nDataBytes = VH * VW * 4; //1280*720*4;

			var pdf417Heap = new Uint8Array(Module.HEAPU8.buffer, 1028);

			var bluf = Module._malloc(nDataBytes);
			Module.HEAPU8.set(pix, bluf);


			// Draw the ImageData at the given (x,y) coordinates.
			ctx.putImageData(imgd, 0, 0);

			var c = _DLreadJS(bluf, VH, VW, 1024);

			var heapBuc = new Uint8Array(Module.HEAPU8.buffer, bluf, 1028);
			var vanc = bin2Strung(heapBuc);

			if (c <= 0) {
				vanc = "No Read.";
			}
			Module._free(bluf);
			document.getElementById("demo").innerHTML = vanc;
		});

		snapHat.addEventListener('click', function () {
			document.getElementById("demo").innerHTML = "Image captured";

			takeASnap();
			showhidecanvas(false);
			//.then(download);
		});

		var state = "";
		function takeASnap() {

			canvas.width = 1280;//video.videoWidth; // set its size to the one of the video
			canvas.height = 720;// video.videoHeight;
			ctx.drawImage(video, 0, 0, 1280, 720); // the video

			var jpegUrl = ctx.canvas.toDataURL("image/jpeg"); // get base64 output - no longer using toBlob

			for (var i = 0; i < isImg.length; i++) {
				if (isImg[i] == true) {
					state = "image_" + (i + 1) + "";
				}
			}

			renderImage(jpegUrl, state);
		}

		function pcanvas2blob() {
			return new Promise((res, rej) => {
				canvas.toBlob(res, 'image/jpeg'); // request a Blob from the canvas
			});
		}

		function download2X(blob) {
			// uses the <a download> to download a Blob
			let a = document.createElement('a');
			a.href = URL.createObjectURL(blob);

			a.download = 'IMG_' + XdateStr + '.jpg';
			document.body.appendChild(a);
			a.click();
		}

		function download(blob) {
			// uses the <a download> to download a Blob
			let a = document.createElement('a');
			a.href = URL.createObjectURL(blob);
			var temp = new Date();
			var minth = 1 + temp.getMonth();
			var dateStr = temp.getFullYear() + '_' +
				minth + '_' +
				temp.getDate() + '-' +
				temp.getHours() + '_' +
				temp.getMinutes() + '_' +
				temp.getSeconds();

			a.download = 'IMG_' + dateStr + '.jpg';
			document.body.appendChild(a);
			a.click();
		}


		function download_png(blob) {
			// uses the <a download> to download a Blob
			let a = document.createElement('a');
			a.href = URL.createObjectURL(blob);
			var temp = new Date();
			var minth = 1 + temp.getMonth();
			var dateStr = temp.getFullYear() + '_' +
				minth + '_' +
				temp.getDate() + '-' +
				temp.getHours() + '_' +
				temp.getMinutes() + '_' +
				temp.getSeconds();
			a.download = 'IMG_' + dateStr + '.png';
			document.body.appendChild(a);
			a.click();
		}

		function canvaSnap() {
			return new Promise((res, rej) => {
				canvas.toBlob(res, 'image/png'); // request a Blob from the canvas
			});
		}

		function saveTextAsFile(txt_name) {

			var ocr_text = document.getElementById("demo").innerHTML
			var res = ocr_text.replace(/<br>/g, "\r\n");
			var res2 = res.replace(/&lt;/g, '<');

			var blab = new Blob([res2], { type: 'text/plain' });

			let a = document.createElement('a');
			a.href = URL.createObjectURL(blab);
			a.download = txt_name + '.txt';
			document.body.appendChild(a);

			a.click();
		}

		function saveImageAndText(fname) {

			var ocr_text = document.getElementById("demo").innerHTML
			var blab = new Blob([ocr_text], { type: 'text/plain' });

			let a = document.createElement('a');
			a.href = URL.createObjectURL(blab);
			a.download = txt_name + '.txt';
			document.body.appendChild(a);
			a.click();
		}</script>

	<script>
		function bin2Strung(array) {
			var result = "";
			var max = 2048;
			for (var i = 0; i < max; i++) {
				var v = String.fromCharCode(array[i]);

				if (array[i] == 10) {
					result += "<br/>";
				}
				else {
					if (array[i] == 60) {
						//result += "&#60";
						result += "&lt";
					}
					else {
						result += String.fromCharCode(array[i]);
					}
				}
				if (array[i] == 0) {
					i = max;
				}
			}
			return result;
		}

		function myFunction() {
			document.getElementById("demo").innerHTML = "Doing My Best!";
		}</script>
	<script>

		function hitungPZ() {
			var BeratBasah1 = $('#pzBasah1').val() != "" ? $('#pzBasah1').val() : 0;
			var BeratBasah2 = $('#pzBasah2').val() != "" ? $('#pzBasah2').val() : 0;
			var BeratBasah3 = $('#pzBasah3').val() != "" ? $('#pzBasah3').val() : 0;

			var BeratKering1 = $('#pzKering1').val() != "" ? $('#pzKering1').val() : 0;
			var BeratKering2 = $('#pzKering2').val() != "" ? $('#pzKering2').val() : 0;
			var BeratKering3 = $('#pzKering3').val() != "" ? $('#pzKering3').val() : 0;

			var pz1 = (((parseFloat(BeratBasah1) - parseFloat(BeratKering1)) / parseFloat(BeratKering1)) * 100);// parseFloat(BeratKering1);
			var pz2 = (((parseFloat(BeratBasah2) - parseFloat(BeratKering2)) / parseFloat(BeratKering2)) * 100);// parseFloat(BeratKering2);
			var pz3 = (((parseFloat(BeratBasah3) - parseFloat(BeratKering3)) / parseFloat(BeratKering3)) * 100);// parseFloat(BeratKering3);

			$('#contentPz1').val(pz1.toFixed(2));
			$('#contentPz2').val(pz2.toFixed(2));
			$('#contentPz3').val(pz3.toFixed(2));
		}
		$('#pzBasah1,#pzBasah2,#pzBasah3,#pzKering1,#pzKering2,#pzKering3').focusout(function () {
			hitungPZ();
		});
		function hitungD() {
			var TowStockAwal = $('#UsTowStockAwal').val() != "" ? $('#UsTowStockAwal').val() : 0;
			var TowPenerimaan = $('#UsTowPenerimaan').val() != "" ? $('#UsTowPenerimaan').val() : 0;
			var TowStockAkhir = $('#UsTowStockAkhir').val() != "" ? $('#UsTowStockAkhir').val() : 0;
			var TowPemakaian = $('#UsTowPemakaian').val() != "" ? $('#UsTowPemakaian').val() : 0;

			var PlugWrapStockAwal = $('#UsPlugWrapStockAwal').val() != "" ? $('#UsPlugWrapStockAwal').val() : 0;
			var PlugWrapPenerimaan = $('#UsPlugWrapPenerimaan').val() != "" ? $('#UsPlugWrapPenerimaan').val() : 0;
			var PlugWrapStockAkhir = $('#UsPlugWrapStockAkhir').val() != "" ? $('#UsPlugWrapStockAkhir').val() : 0;
			var PlugWrapPemakaian = $('#UsPlugWrapPemakaian').val() != "" ? $('#UsPlugWrapPemakaian').val() : 0;

			var CapsuleStockAwal = $('#UsCapsuleStockAwal').val() != "" ? $('#UsCapsuleStockAwal').val() : 0;
			var CapsulePenerimaan = $('#UsCapsulePenerimaan').val() != "" ? $('#UsCapsulePenerimaan').val() : 0;
			var CapsuleStockAkhir = $('#UsCapsuleStockAkhir').val() != "" ? $('#UsCapsuleStockAkhir').val() : 0;
			var CapsulePemakaian = $('#UsCapsulePemakaian').val() != "" ? $('#UsCapsulePemakaian').val() : 0;

			var UsSeamGlueAwal = $('#UsSeamGlueAwal').val() != "" ? $('#UsSeamGlueAwal').val() : 0;
			var UsSeamGluePenerimaan = $('#UsSeamGluePenerimaan').val() != "" ? $('#UsSeamGluePenerimaan').val() : 0;
			var UsSeamGlueStockAkhir = $('#UsSeamGlueStockAkhir').val() != "" ? $('#UsSeamGlueStockAkhir').val() : 0;
			var UsSeamGluePemakaian = $('#UsSeamGluePemakaian').val() != "" ? $('#UsSeamGluePemakaian').val() : 0;

			var UsInnerGlueStockAwal = $('#UsInnerGlueStockAwal').val() != "" ? $('#UsInnerGlueStockAwal').val() : 0;
			var UsInnerGluePenerimaan = $('#UsInnerGluePenerimaan').val() != "" ? $('#UsInnerGluePenerimaan').val() : 0;
			var UsInnerGlueStockAkhir = $('#UsInnerGlueStockAkhir').val() != "" ? $('#UsInnerGlueStockAkhir').val() : 0;
			var UsInnerGluePemakaian = $('#UsInnerGluePemakaian').val() != "" ? $('#UsInnerGluePemakaian').val() : 0;

			var TriacetineStockAwal = $('#TriacetineStockAwal').val() != "" ? $('#TriacetineStockAwal').val() : 0;
			var TriacetinePenerimaan = $('#TriacetinePenerimaan').val() != "" ? $('#TriacetinePenerimaan').val() : 0;
			var TriacetineStockAkhir = $('#TriacetineStockAkhir').val() != "" ? $('#TriacetineStockAkhir').val() : 0;
			var TriacetinePemakaian = $('#TriacetinePemakaian').val() != "" ? $('#TriacetinePemakaian').val() : 0;

			TowPemakaian = (parseFloat(TowStockAwal) + parseFloat(TowPenerimaan)) - parseFloat(TowStockAkhir);
			PlugWrapPemakaian = (parseFloat(PlugWrapStockAwal) + parseFloat(PlugWrapPenerimaan)) - parseFloat(PlugWrapStockAkhir);
			CapsulePemakaian = (parseFloat(CapsuleStockAwal) + parseFloat(CapsulePenerimaan)) - parseFloat(CapsuleStockAkhir);
			UsSeamGluePemakaian = (parseFloat(UsSeamGlueAwal) + parseFloat(UsSeamGluePenerimaan)) - parseFloat(UsSeamGlueStockAkhir);
			UsInnerGluePemakaian = (parseFloat(UsInnerGlueStockAwal) + parseFloat(UsInnerGluePenerimaan)) - parseFloat(UsInnerGlueStockAkhir);
			TriacetinePemakaian = (parseFloat(TriacetineStockAwal) + parseFloat(TriacetinePenerimaan)) - parseFloat(TriacetineStockAkhir);
			$('#UsTowPemakaian').val(TowPemakaian.toFixed(2));
			$('#UsPlugWrapPemakaian').val(PlugWrapPemakaian.toFixed(2));
			$('#UsCapsulePemakaian').val(CapsulePemakaian.toFixed(2));
			$('#UsSeamGluePemakaian').val(UsSeamGluePemakaian.toFixed(2));
			$('#UsInnerGluePemakaian').val(UsInnerGluePemakaian.toFixed(2));
			$('#TriacetinePemakaian').val(TriacetinePemakaian.toFixed(2));
		}
		$('#UsTowStockAwal').focusout(function () {
			hitungD();
		});
		$('#UsTowPenerimaan').focusout(function () {
			hitungD();
		});
		$('#UsTowStockAkhir').focusout(function () {
			hitungD();
		});
		$('#UsPlugWrapStockAwal').focusout(function () {
			hitungD();
		});
		$('#UsPlugWrapPenerimaan').focusout(function () {
			hitungD();
		});
		$('#UsPlugWrapStockAkhir').focusout(function () {
			hitungD();
		});
		$('#UsCapsuleStockAwal').focusout(function () {
			hitungD();
		});
		$('#UsCapsulePenerimaan').focusout(function () {
			hitungD();
		});
		$('#UsCapsuleStockAkhir').focusout(function () {
			hitungD();
		});
		$('#UsSeamGlueAwal').focusout(function () {
			hitungD();
		});
		$('#UsSeamGluePenerimaan').focusout(function () {
			hitungD();
		});
		$('#UsSeamGlueStockAkhir').focusout(function () {
			hitungD();
		});
		$('#UsInnerGlueStockAwal').focusout(function () {
			hitungD();
		});
		$('#UsInnerGluePenerimaan').focusout(function () {
			hitungD();
		});
		$('#UsInnerGlueStockAkhir').focusout(function () {
			hitungD();
		});
		$('#TriacetineStockAwal').focusout(function () {
			hitungD();
		});
		$('#TriacetinePenerimaan').focusout(function () {
			hitungD();
		});
		$('#TriacetineStockAkhir').focusout(function () {
			hitungD();
		});

	</script>
	<script>
		function detectBrowser() {
			var ua = navigator.userAgent, tem,
				M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
			if (/trident/i.test(M[1])) {
				tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
				return 'IE ' + (tem[1] || '');
			}
			if (M[1] === 'Chrome') {
				tem = ua.match(/\b(OPR|Edge)\/(\d+)/);
				if (tem != null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
			}
			M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
			if ((tem = ua.match(/version\/(\d+)/i)) != null) M.splice(1, 1, tem[1]);
			return M.join(' ');
		};
		if (detectBrowser().indexOf("Chrome") < 0) {
			$('input[type=number]').toArray().forEach(function (field) {
				$(field).attr("placeholder", "0");
				new Cleave(field, {
					numeral: true,
					numeralDecimalScale: 2,
					numeralThousandsGroupStyle: 'none',
					//numeralDecimalMark: ',',
					//delimiter: '.',
					numeralPositiveOnly: $(field).hasClass("number-positive"),
				});
				$(field).on("keyup", function (e) {
					if (e.keyCode == 190) {
						let val = $(this).val();
						const i = val.lastIndexOf(".");
						let a = val.length > 1 ? val.substring(i - 1, i) : "-";
						if (isNaN(a)) $(this).val(val.slice(0, i) + "0.");
					}
				});
			});
		}
	</script>
	<script>
		function printImage(name) {
			for (let i = 0; i < imgContent.length; i++) {
				if (imgContent[i].name == name) {
					let dataimage = new Image();
					dataimage.src = imgContent[i].data;

					let windowOpen = window.open("");
					windowOpen.document.write(dataimage.outerHTML);
					return;
				}
			}
			for (let i = 0; i < cbwData.length; i++) {
				if (cbwData[i].Filename == name) {
					pwin = window.open(fastApp.BaseUrl + "/Uploads/lph/filter/" + cbwData[i].Filename, "_blank");
				}
			}

		}
	</script>
	<script>
		//hide canvas waktu pertama buka webcam
		function showhidecanvas(hidecanvas) {
			if (hidecanvas == true) {
				$('canvas').hide();
				$('#demo').hide();
				$('#btnNextPhoto').hide();
				hidecanvas = false;
			} else {
				$('canvas').show();
				$('#demo').show();
				$('#btnNextPhoto').show();
				hidecanvas = true;
			}
		}
		$('#photo-modal').on('show', function () {
			$('#photo-modal').css("padding-right: 300px;");
		});
	</script>
	<script>
		$(document).ready(function () {
			if ($('#UsCapsuleStockAwal').val() == '') {
				$('#radioTriacetine').prop('checked', true);
				$('#radioCapsule').prop('checked', false);
				$('#formCapsule').addClass('d-none');
				$('#formTriacetine').removeClass('d-none');
			} else if ($('#TriacetineStockAwal').val() == '') {
				$('#radioCapsule').prop('checked', true);
				$('#radioTriacetine').prop('checked', false);
				$('#formTriacetine').addClass('d-none');
				$('#formCapsule').removeClass('d-none');
			}

		});

		$('#radioCapsule').on('click', function () {
			$('#radioTriacetine').prop('checked', false);
			$('#formTriacetine').addClass('d-none');
			$('#formCapsule').removeClass('d-none');
			$("#formTriacetine :input").each(function () {
				$(this).val('');
			});
		});
		$('#radioTriacetine').on('click', function () {
			$('#radioCapsule').prop('checked', false);
			$('#formCapsule').addClass('d-none');
			$('#formTriacetine').removeClass('d-none');
			$("#formCapsule :input").each(function () {
				$(this).val('');
			});
		});
	</script>
}