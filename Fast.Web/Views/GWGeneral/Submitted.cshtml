@model Fast.Web.Models.LPH.LPHEditModel
@using Fast.Web.Resources;
@using Newtonsoft.Json;
@{
    ViewBag.Title = "Index";
    var ponumber_class = "";
    var ponumber_label = "PO Number";
    if (ViewBag.AccountProdCenterID != 4 && ViewBag.AccountProdCenterID != 5 ) { 
        ponumber_class = "mandatory";
        ponumber_label = "PO Number*";
    }
}
@section CSS_lib{
    <link href="~/Content/dashforge/lib/select2/css/select2.min.css" rel="stylesheet">
}
@section Styles{
    <style>
        .tableWrapper {
            position: relative;
            overflow: auto;
            max-height: 150px;
            transform: translateZ(0);
        }

            .tableWrapper table {
                border-collapse: collapse;
                width: 100%;
            }

            .tableWrapper thead th, .tableWrapper thead td {
                position: sticky;
                background: #066fcb;
                z-index: 100;
                border: none;
            }

            .tableWrapper table tfoot td {
                position: sticky;
                bottom: 0;
                z-index: 100;
            }

            .tableWrapper .input td {
                background: white;
            }

            .tableWrapper .summary-body td {
                font-weight: bold;
                background-color: #d8eafe;
                color: #000;
            }

        .fa {
            padding: 5px;
        }

        .modal-body {
            position: relative;
            margin-top: 10px;
        }

            .modal-body .close {
                padding: 5px;
                position: absolute;
                top: -5px;
                right: 5px;
                font-size: 15px;
                color: black;
                z-index: 1000;
            }

        .stepper {
            position: relative;
        }

            .stepper:before {
                top: 15px;
                bottom: 0;
                position: absolute;
                content: " ";
                width: 100%;
                height: 1px;
                background: #f1f1f1;
                z-index: 0;
            }

        .stepper-step {
            text-align: center;
            position: relative;
        }

            .stepper-step.active .stepper-btn {
                background: #37b6fa;
                color: white;
                font-weight: 500;
                border: 0
            }

        .stepper-btn {
            width: 30px;
            height: 30px;
            text-align: center;
            padding: 6px 0;
            font-size: 12px;
            line-height: 1.428571429;
            border-radius: 15px;
            background: #e6e6e6;
            color: #9c9c9c;
        }

        .wizard-button {
            margin: 5px;
        }

            .wizard-button.active {
                filter: brightness(0.75);
            }

        /* chanif: tolong tambahkan css dari sini sampai bawah untuk memperbaiki tampilan select2 */
        .select2-container--default .select2-selection--single {
            height: 25px;
            min-height: 25px;
        }

        .select2-container--default .select2-selection--multiple {
            min-height: 25px;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            display: none;
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            font-size: 13px;
            padding: 5px;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__rendered {
            font-size: 13px;
            padding: 0 0 0 5px;
        }

        .select2-search--dropdown {
            padding: 1px;
        }

        .select2-container--default .select2-search--dropdown .select2-search__field {
            padding: 3px 5px;
        }

        .select2-results {
            font-size: 13px;
        }

        .select2-results__option {
            padding: 3px;
        }

        table.dataTable thead .sorting_asc, table.dataTable thead .sorting_desc {
            background-color: transparent
        }

        .select2-container--default .select2-search--inline .select2-search__field {
            margin-top: 0;
            padding: 0;
        }

        .select2-results__option[aria-selected=true] {
            display: none;
        }

        #GeneralInfo label{
            padding-right:0;
        }
    </style>
}


<div class="content content-fixed lph-form">
    <div class="container-fluid pd-x-0 pd-lg-x-10 pd-xl-x-0">
        <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-30">
            <div>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb breadcrumb-style1 mg-b-10">
                        <li class="breadcrumb-item"><a href="#">LPH Form</a></li>
                        <li class="breadcrumb-item active" aria-current="page">GW General</li>
                    </ol>
                </nav>
                <h4 class="mg-b-0 tx-spacing--1">@Html.Raw(ViewBag.PageHeader)</h4>
            </div>
            <div class="d-none d-md-block">
                <button id="goPrev" class="btn btn-sm pd-x-15 btn-white btn-uppercase mg-l-5"><i data-feather="chevron-left" class="wd-10 mg-r-5"></i> Prev</button>
                <button class="btn btn-sm pd-x-15 btn-white btn-uppercase mg-l-5" onclick="javascript:window.print()"><i data-feather="printer" class="wd-10 mg-r-5"></i> Print</button>
            </div>
        </div>
        <div class="row">
            <div class="col-12 mg-b-20">
                <div class="card collect-component" id="GeneralInfo">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Information</div>
                    <div class="card-body d-flex">
                        <div class="flex-1">
                            <div class="form-group row">
                                <label class="col-3 col-form-label">Date</label>
                                <div class="col-5">
                                    <input type="text" name="DateInfo" class="form-control" disabled id="txtDateInfo" value="">
                                </div>
                                <label class="col-2 col-form-label tx-right pd-r-0-f">Week</label>
                                <div class="col-2">
                                    <input type="text" name="WeekNumber" class="form-control" disabled id="txtWeekNumber" value="">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-3 col-form-label" style="padding-right: 3px;">@(ponumber_label)</label>
                                <div class="col-9">
                                    <select class="form-control select2 @(ponumber_class)" name="PONumber">
                                        <option value="">Select PO Number</option>
                                        @foreach (Fast.Web.Models.WppModel wpp in ViewBag.WPP)
                                        {
                                            <option value="@(wpp.PONumber)">@(wpp.PONumber)</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="divider-text divider-vertical"></div>
                        <div class="flex-1">
                            <div class="form-group row">
                                <label class="col-4 col-form-label">Gw Name*</label>
                                <div class="col-8">
                                    <select class="form-control select2 mandatory" name="GwGeneral" id="gwGeneral">
                                        <option value="">Select GW</option>
                                        @foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.GeneralWorker)
                                        {
                                            <option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-4 col-form-label">Supervisor*</label>
                                <div class="col-8">
                                    <select class="form-control select2 mandatory" name="TeamLeader" id="teamLeader">
                                        <option value="">Select Mechanic</option>
                                        @foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Leaders)
                                        {
                                            <option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="divider-text divider-vertical"></div>
                        <div class="flex-1">
                            <div class="form-group row">
                                <label class="col-4 col-form-label">Shift / Group*</label>
                                <div class="col-3">
                                    <input type="text" class="form-control" name="Shift" id="shift" value="3">
                                </div>
                                <label class="col-1 col-form-label tx-center">/</label>
                                <div class="col-3">
                                    @*<input type="text" class="form-control" name="Group" id="group" value="C">*@
                                    <select class="form-control select2 mandatory" name="Group" id="group">
                                        <option value="">Select Group</option>
                                        @foreach (Fast.Web.Models.ReferenceDetailModel detail in ViewBag.referenceGroup)
                                        {
                                            <option value="@(detail.Code)">@(detail.Code)</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-4 col-form-label">Start / Stop*</label>
                                <div class="col-3">
                                    <div class="input-group">
                                        <input id="inputTimeStart" name="Start" class="form-control input-time" value="22:00">
                                    </div>
                                </div>
                                <label class="col-1 col-form-label">/</label>
                                <div class="col-3">
                                    <div class="input-group">
                                        <input id="inputTimeStop" name="Stop" class="form-control input-time" value="06:00">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!--INFORMATION-->

            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">
                        Handover Logbook
                    </div>
                    <div class="card-body">
                        <div class="tableWrapper" style="max-height: 210px">
                            <table class="table table-bordered table-hover table-striped">
                                <thead class="thead-info">
                                    <tr class="tx-center">
                                        <th style="min-width:120px;">Stops and Location</th>
                                        <th style="min-width:100px;"># of Stops</th>
                                        <th style="min-width:120px;">Initial Root Cause (Describe the issue) / Action Taken &amp; Impact</th>
                                        <th style="min-width:120px;">Action Taken in your shift</th>
                                        <th width="80px">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="logbook">
                                </tbody>
                                <tfoot>
                                    <tr class="input">
                                        <td><input type="text" class="form-control" name="StopAndLocation"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="NOfStop"></td>
                                        <td><input type="text" class="form-control" name="InitialCause"></td>
                                        <td><input type="text" class="form-control" name="ActionTaken"></td>
                                        <td class="tx-center"><i data-target="logbook" class="fa fa-plus-circle add-to-table"></i></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="tableWrapper" style="max-height: 210px">
                            <table class="table table-bordered table-hover table-striped">
                                <thead class="thead-info">
                                    <tr class="tx-center">
                                        <th style="width:50%;">Action proposed for next shift</th>
                                        <th style="min-width:90px;">Owner</th>
                                        <th style="min-width:70px;">Start Time</th>
                                        <th style="min-width:70px;">End Time</th>
                                        <th style="min-width:60px;">Duration (Min)</th>
                                        <th style="min-width:100px;">Status</th>
                                        <th width="80px">Action</th>
                                    </tr>
                                    <tr class="summary-body">
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>0</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </thead>
                                <tbody id="action">
                                </tbody>
                                <tfoot>
                                    <tr class="input">
                                        <td><input type="text" class="form-control" name="NextAction"></td>
                                        <td><input type="text" class="form-control" name="NextOwner"></td>
                                        <td><input type="text" class="form-control date" name="NextStart" id="start" onblur="javascript:countDuration('start','end','duration')"></td>
                                        <td><input type="text" class="form-control date" name="NextEnd" id="end" onblur="javascript:countDuration('start','end','duration')"></td>
                                        <td><input type="text" class="form-control disabled" disabled value="0" name="NextDurasi" id="duration"></td>
                                        <td>
                                            <select class="form-control select2" name="Status">
                                                <option label="Choose one"></option>
                                                <option value="ONPROGRESS">ONPROGRESS</option>
                                                <option value="DONE">DONE</option>
                                            </select>
                                        </td>
                                        <td class="tx-center"><i data-target="action" class="fa fa-plus-circle add-to-table"></i></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div> <!-- PROBLEM MESIN -->

            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Cigarette Reject Rate</div>
                    <div class="card-body" style="padding:10px">
                        <div class="row" style="margin:0">
                            <div class="col-2" style="padding: 0 10px 0 0">
                                <table class="table table-bordered table-hover table-striped">
                                    <thead class="thead-info">
                                        <tr>
                                            <th class="tx-center"><label class="tx-center" style="margin:0px;"> Weight</label></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="row form-group" style="margin-left: 0; margin-right: 0;margin-top:8px;">
                                                    <div class="col-9 tx-center" style="margin-right:0px;">
                                                        <input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control  tx-center" style="font-size:24px;height:35px;" id="weightCrr">

                                                        @*<label class="tx-center font-weight-bold" style="font-size:32px;margin-right:0px;">19.55 Kg</label>*@
                                                    </div>
                                                    <div class="col-3">
                                                        <label class="tx-center font-weight-bold" style="font-size:24px;margin-left:-10px;">Kg</label>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-3 tx-center">
                                                        <label class="tx-center">&nbsp;</label>
                                                    </div>
                                                    <div class="col-6">
                                                        <button type="button" class="phase-show btn btn-sm btn-primary " style="width:100%;padding-right:5px;padding-left:5px" data-toggle="modal" data-target="#phase-modal">Add</button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="tableWrapper col-10">
                                <table class="table table-bordered table-hover table-striped " id="dtCigarette">
                                    <thead class="thead-info">
                                        <tr>
                                            <th>PO Number</th>
                                            <th>FA Code</th>
                                            <th>LU Origin</th>
                                            <th>Machine</th>
                                            <th>Machine Number</th>
                                            <th>CR Code</th>
                                            <th>Resource Cigarette</th>
                                            <th>Item</th>
                                            <th>Type CF</th>
                                            <th>Weight (Kg)</th>
                                            <th>Time</th>
                                            <th>Proceed</th>
                                            <th></th>
                                        </tr>
                                        <tr class="summary-body">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>0</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </thead>
                                    <tbody id="crr"></tbody>
                                    <tfoot>
                                        <tr class="input" style="display:none;">
                                            <td><input type="text" class="form-control" name="PO_num"></td>
                                            <td><input type="text" class="form-control" name="FACode"></td>
                                            <td><input type="text" class="form-control" name="AsalLU"></td>
                                            <td><input type="text" class="form-control" name="MachineVal"></td>
                                            <td><input type="text" class="form-control" name="MachineNumVal"></td>
                                            <td><input type="text" class="form-control" name="CRCode"></td>
                                            <td><input type="text" class="form-control" name="ResourceCigarette"></td>
                                            <td><input type="text" class="form-control" name="ItemVal"></td>
                                            <td><input type="text" class="form-control" name="TipeCF"></td>
                                            <td><input type="text" class="form-control" name="WeightVal"></td>
                                            <td><input type="text" class="form-control" name="TimeVal"></td>
                                            <td><input type="text" class="form-control" name="Proceeded" value="False"></td>
                                            <td class="tx-center"><i data-target="crr" class="fa fa-plus-circle add-to-table"></i></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!--CRR-->


            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Sapon</div>
                    <div class="card-body" style="padding:10px">
                        <div class="row" style="margin:0">
                            <div class="col-2" style="padding: 0 10px 0 0">
                                <table class="table table-bordered table-hover table-striped" style="min-height:150px;">
                                    <thead class="thead-info">
                                        <tr>
                                            <th class="tx-center"><label class="tx-center" style="margin:0px;"> Weight</label></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="row form-group" style="margin-left: 0; margin-right: 0;margin-top:8px;">
                                                    <div class="col-9 tx-center" style="margin-right:0px;">
                                                        <input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control  tx-center" style="font-size:24px;height:35px;" id="weightSapon">
                                                        @*<label class="tx-center font-weight-bold" style="font-size:32px;margin-right:0px;">19.55 Kg</label>*@
                                                    </div>
                                                    <div class="col-3">
                                                        <label class="tx-center font-weight-bold" style="font-size:24px;margin-left:-10px;">Kg</label>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-3 tx-center">
                                                        <label class="tx-center">&nbsp;</label>
                                                    </div>
                                                    <div class="col-6">
                                                        <button type="button" class="phase-show btn btn-sm btn-primary " style="width:100%;padding-right:5px;padding-left:5px" data-toggle="modal" data-target="#phase-sapon-modal">Add</button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="tableWrapper col-10">
                                <table class="table table-bordered table-hover table-striped " id="dtSapon">
                                    <thead class="thead-info">
                                        <tr>
                                            @*<th>PO Number</th>
                                        <th>FA Code</th>
                                        <th>LU Origin</th>*@
                                            <th>Machine</th>
                                            <th>Machine Number</th>
                                            @*<th>CR Code</th>
                                        <th>Resource Cigarette</th>
                                        <th>Item</th>
                                        <th>Type CF</th>*@
                                            <th>Weight (Kg)</th>
                                            <th>Time</th>
                                            @*<th>Proceed</th>*@
                                            <th></th>
                                        </tr>
                                        <tr class="summary-body">
                                            @*<td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>*@
                                            <td></td>
                                            <td></td>
                                            <td>0</td>
                                            <td></td>
                                            @*<td></td>*@
                                            <td></td>
                                        </tr>
                                    </thead>
                                    <tbody id="sapon"></tbody>
                                    <tfoot>
                                        <tr class="input" style="display:none;">
                                            @*<td><input type="text" class="form-control" name="PO_num2"></td>
                                        <td><input type="text" class="form-control" name="FACode2"></td>
                                        <td><input type="text" class="form-control" name="AsalLU2"></td>*@
                                            <td><input type="text" class="form-control" name="MachineVal2"></td>
                                            <td><input type="text" class="form-control" name="MachineNumVal2"></td>
                                            @*<td><input type="text" class="form-control" name="CRCode2"></td>
                                        <td><input type="text" class="form-control" name="ResourceCigarette2"></td>*@
                                            @*<td><input type="text" class="form-control" name="ItemVal2"></td>*@
                                            @*<td><input type="text" class="form-control" name="TipeCF2"></td>*@
                                            <td><input type="text" class="form-control" name="WeightVal2"></td>
                                            <td><input type="text" class="form-control" name="TimeVal2"></td>
                                            @*<td><input type="text" class="form-control" name="Proceeded2" value="False"></td>*@
                                            <td class="tx-center"><i data-target="sapon" class="fa fa-plus-circle add-to-table"></i></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- Sapon -->

            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Filter Waste</div>
                    <div class="card-body" style="padding:10px">
                        <div class="row" style="margin:0">
                            <div class="col-2" style="padding: 0 10px 0 0">
                                <table class="table table-bordered table-hover table-striped">
                                    <thead class="thead-info">
                                        <tr>
                                            <th class="tx-center"><label class="tx-center" style="margin:0px;"> Weight</label></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="row form-group" style="margin-left: 0; margin-right: 0;margin-top:8px;">
                                                    <div class="col-9 tx-center" style="margin-right:0px;">
                                                        <input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control  tx-center" style="font-size:24px;height:35px;" id="weightFW">

                                                        @*<label class="tx-center font-weight-bold" style="font-size:32px;margin-right:0px;">19.55 Kg</label>*@
                                                    </div>
                                                    <div class="col-3">
                                                        <label class="tx-center font-weight-bold" style="font-size:24px;margin-left:-10px;">Kg</label>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-3 tx-center">
                                                        <label class="tx-center">&nbsp;</label>
                                                    </div>
                                                    <div class="col-6">
                                                        <button type="button" class="phase-show btn btn-sm btn-primary " style="width:100%;padding-right:5px;padding-left:5px" data-toggle="modal" data-target="#phase-filter-modal">Add</button>
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="tableWrapper col-10">
                                <table class="table table-bordered table-hover table-striped " id="dtFilterWaste">
                                    <thead class="thead-info">
                                        <tr>
                                            <th>PO Number</th>
                                            <th>FA Code</th>
                                            <th>LU Origin</th>
                                            <th>Machine</th>
                                            <th>Machine Number</th>
                                            <th>FR Code</th>
                                            <th>Weight (Kg)</th>
                                            <th>Time</th>
                                            <th></th>
                                        </tr>
                                        <tr class="summary-body">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>0</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </thead>
                                    <tbody id="filterWaste"></tbody>
                                    <tfoot>
                                        <tr class="input" style="display:none;">
                                            <td><input type="text" class="form-control" name="PO_numFW"></td>
                                            <td><input type="text" class="form-control" name="FACodeFW"></td>
                                            <td><input type="text" class="form-control" name="AsalLUFW"></td>
                                            <td><input type="text" class="form-control" name="MachineValFW"></td>
                                            <td><input type="text" class="form-control" name="MachineNumValFW"></td>
                                            <td><input type="text" class="form-control" name="FRCodeFW"></td>
                                            <td><input type="text" class="form-control" name="WeightValFW"></td>
                                            <td><input type="text" class="form-control" name="TimeValFW"></td>
                                            <td class="tx-center"><i data-target="filterWaste" class="fa fa-plus-circle add-to-table"></i></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- Filter Waste -->


            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Cutfiller Incoming</div>
                    <div class="card-body">
                        <div class="row" style="margin:0">
                            <div class="col-2" style="padding: 0 10px 0 0">
                                <table class="table table-bordered table-hover table-striped">
                                    <thead class="thead-info">
                                        <tr>
                                            <th>Input</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="row form-group" style="margin:0">
                                                    <input class="form-control col-9" id="scanner-receiveWHS" style="margin-bottom:10px;" data-table="receive-f-WHS" value="" />
                                                    <div class="col-2" style="padding-top: 3px">
                                                        <i data-target="receiveWHS" class="fa fa-plus-circle"></i>
                                                    </div>
                                                    <br />
                                                    <br />
                                                    <br />
                                                    <br />
                                                    <br />
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="tableWrapper col-10">

                                <table class="table table-bordered table-hover table-striped" id="dtCutfillerIncoming">
                                    <thead class="thead-info">
                                        <tr>
                                            <th>Code</th>
                                            <th>WLS Los Number</th>
                                            <th>Batch No</th>
                                            <th>Box No</th>
                                            <th>Date</th>
                                            <th>Net Weight</th>
                                            <th>Gross Weight</th>
                                            <th></th>
                                        </tr>
                                        <tr class="summary-body">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td></td>
                                        </tr>
                                    </thead>
                                    <tbody id="receiveWHS"></tbody>
                                    <tfoot>
                                        <tr class="input" style="display:none;">
                                            <td><input type="text" class="form-control" name="Code"></td>
                                            <td><input type="text" class="form-control" name="WLSLosNumber"></td>
                                            <td><input type="text" class="form-control" name="BatchNo"></td>
                                            <td><input type="text" class="form-control" name="BoxNo"></td>
                                            <td><input type="text" class="form-control" name="Date"></td>
                                            <td><input type="text" class="form-control" name="NetWeight"></td>
                                            <td><input type="text" class="form-control" name="GrossWeight"></td>
                                            <td class="tx-center"><i data-target="receiveWHS" class="fa fa-plus-circle add-to-table"></i></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Cutfiller Usage</div>
                    <div class="card-body">
                        <div class="row" style="margin:0">
                            <div class="col-2" style="padding: 0 10px 0 0">
                                <table class="table table-bordered table-hover table-striped">
                                    <thead class="thead-info">
                                        <tr>
                                            <th>Input</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="row form-group" style="margin:0">
                                                    <input class="form-control col-9" id="scanner-pouring" style="margin-bottom:10px;" data-table="receive-f-WHS" value="" />
                                                    <div class="col-2" style="padding-top: 3px">
                                                        <i class="fa fa-plus-circle"></i>
                                                    </div>
                                                    <br />
                                                    <br />
                                                    <br />
                                                    <br />
                                                    <br />
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="tableWrapper col-10" style="max-height:210px">

                                <table class="table table-bordered table-hover table-striped" id="dtCutfillerUsage">
                                    <thead class="thead-info">
                                        <tr>
                                            <th>Code</th>
                                            <th>WLS Los Number</th>
                                            <th>Batch No</th>
                                            <th>Box No</th>
                                            <th>Date</th>
                                            <th>Net Weight</th>
                                            <th>Gross Weight</th>
                                            <th>Pouring Date</th>
                                            <th></th>
                                        </tr>
                                        <tr class="summary-body">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>0</td>
                                            <td>0</td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </thead>
                                    <tbody id="pouring"></tbody>
                                    <tfoot>
                                        <tr class="input" style="display:none;">
                                            <td><input type="text" class="form-control" name="Code"></td>
                                            <td><input type="text" class="form-control" name="WLSLosNumber"></td>
                                            <td><input type="text" class="form-control" name="BatchNo"></td>
                                            <td><input type="text" class="form-control" name="BoxNo"></td>
                                            <td><input type="text" class="form-control" name="Date"></td>
                                            <td><input type="text" class="form-control" name="NetWeight"></td>
                                            <td><input type="text" class="form-control" name="GrossWeight"></td>
                                            <td><input type="text" class="form-control" name="PouringDate"></td>
                                            <td class="tx-center"><i data-target="pouring" class="fa fa-plus-circle add-to-table"></i></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-4 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Capture by Webcam</div>
                    <div class="card-body d-flex">
                        <div class="flex-1">
                            <div class="form-group row">
                                <div class="col-12" id="image_1_hide">
                                    <center>
                                        <img src="~/Content/dashforge/assets/img/upload-img-mini.png" id="image_1" class="input-img rounded mx-auto d-block" onclick="infoId(this)" data-toggle="modal" data-target="#photo-modal" alt="insert image" width="auto">
                                    </center>
                                </div>
                                <div class="col-12" id="image_1_show">
                                </div>
                                <div class="col-12">
                                    <center>
                                        <label class="col-12 col-form-label"><i>Barcode 778</i></label>
                                    </center>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!-- CAPTURE BY WEBCAM -->

            <div class="col-8 mg-b-20">
                <div class="card collect-component" id="DataAfkir">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Data Afkir (Khusus OTP)</div>
                    <div class="card-body d-flex">
                        <div class="flex-1">
                            <div class="form-group row">
                                <label class="col-5 col-form-label">
                                    Pouch
                                </label>
                                <div class="col-4">
                                    <input type="number" onkeypress="validateNumber(event)" class="form-control" placeholder="0" id="pouch" name="Pouch" value="">
                                </div>
                                <label class="col-3 col-form-label">
                                    KG
                                </label>
                            </div>
                            <div class="form-group row">
                                <label class="col-5 col-form-label">
                                    Plastik
                                </label>
                                <div class="col-4">
                                    <input type="number" onkeypress="validateNumber(event)" class="form-control" placeholder="0" id="plastik" name="Plastik" value="">
                                </div>
                                <label class="col-3 col-form-label">
                                    KG
                                </label>
                            </div>
                            <div class="form-group row">
                                <label class="col-5 col-form-label">
                                    Dust
                                </label>
                                <div class="col-4">
                                    <input type="number" onkeypress="validateNumber(event)" class="form-control" placeholder="0" id="dust" name="Dust" value="">
                                </div>
                                <label class="col-3 col-form-label">
                                    KG
                                </label>
                            </div>
                        </div>
                        <div class="flex-1">

                            <div class="form-group row">
                                <label class="col-5 col-form-label">
                                    Sapon
                                </label>
                                <div class="col-4">
                                    <input type="number" onkeypress="validateNumber(event)" class="form-control" placeholder="0" id="saponafkir" name="Sapon" value="">
                                </div>
                                <label class="col-3 col-form-label">
                                    KG
                                </label>
                            </div>
                            <div class="form-group row">
                                <label class="col-5 col-form-label">
                                    Lain-Lain
                                </label>
                                <div class="col-4">
                                    <input type="number" onkeypress="validateNumber(event)" class="form-control" placeholder="0" id="other" name="Other" value="">
                                </div>
                                <label class="col-3 col-form-label">
                                    KG
                                </label>
                            </div>
                            <div class="form-group row">
                                <div class="col-5">
                                    <input type="text" class="form-control" name="afkirOther" value="Core">
                                </div>
                                <div class="col-4">
                                    <input type="number" onkeypress="validateNumber(event)" class="form-control" placeholder="0" id="afkirOtherValue" name="AfkirOtherValue" value="">
                                </div>
                                <label class="col-3 col-form-label">
                                    KG
                                </label>
                            </div>

                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Filter Usage</div>
                    <div class="card-body">
                        <div class="row" style="margin:0">
                            <div class="tableWrapper col-12" style="max-height:400px">

                                <table class="table table-bordered table-hover table-striped" id="dtFilterStock">
                                    <thead class="thead-info">
                                        <tr>
                                            <th>Machine Number</th>
                                            <th style="width:15%">Item Code</th>
                                            <th style="width:15%">Batch</th>
                                            <th>Total Filter</th>
                                            <th>Take Time</th>
                                            <th>Production Date</th>
                                            <th>Filter Number</th>
                                            <th style="min-width:70px"></th>
                                        </tr>
                                        <tr class="summary-body">
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td>0</td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                            <td></td>
                                        </tr>
                                    </thead>
                                    <tbody id="filter"></tbody>
                                    <tfoot>
                                        <tr class="input">
                                            <td>
                                                <select class="form-control select2" name="FilterVal">
                                                    <option value="">Select Machine</option>
                                                    @foreach (Fast.Web.Models.MachineModel machine in ViewBag.Maker)
                                                    {
                                                        <option value="@(machine.Code)">@(machine.Code)</option>
                                                    }
                                                </select>
                                            </td>
                                            <td>
                                                <select class="form-control select2" name="ItemCodeVal">
                                                    <option value="">Select Brand</option>
                                                    @foreach (Fast.Web.Models.BrandModel brand in ViewBag.BrandCode)
                                                    {
                                                        <option value="@(brand.Code)">@(brand.Code)</option>
                                                    }
                                                </select>
                                            </td>
                                            <td><input type="text" class="form-control" name="BatchVal"></td>
                                            <td><input type="number" onkeypress="validateNumber(event)" class="form-control" name="TotalFilterVal"></td>
                                            <td><input type="text" class="form-control input-time" name="TakeTimeVal"></td>
                                            <td><input type="text" class="form-control datepicker" name="ProductionDateVal"></td>
                                            <td>
                                                <select class="form-control select2" name="MachineVal">
                                                    <option value="">Select Machine</option>
                                                    @foreach (Fast.Web.Models.MachineModel machine in ViewBag.Machines)
                                                    {
                                                        <option value="@(machine.Code)">@(machine.Code)</option>
                                                    }
                                                    <option value="OTHERS">OTHERS</option>
                                                </select>
                                            </td>
                                            <td class="tx-center"><i data-target="filter" class="fa fa-plus-circle add-to-table"></i></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!--Filter Stock-->
            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Approval</div>
                    <div class="card-body">
                        <table class="table table-bordered table-hover table-striped" id="dtApproval">
                            <thead class="thead-info">
                                <tr>
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Actions</th>
                                    <th style="width:15%;">Date &amp; Time</th>
                                    <th style="width:40%;">Comment</th>
                                </tr>
                            </thead>

                        </table>
                    </div>
                </div>
            </div>

        </div><!-- row -->
    </div><!-- container -->
</div><!-- content -->

<div class="modal fade wizard-modal" id="photo-modal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="close"><i data-dismiss="modal" class="fa fa-times"></i></div>

                <div id="carousel" class="carousel slide" data-pause="true">
                    <div class="carousel-inner">

                        <div class="carousel-item active">
                            <h5><label id="next-1">Take Picture For 'Barcode 778'</label></h5>
                            <hr />
                            <div class="row">
                                <div class="col-md-6">
                                    <center>
                                        <select id="videoSource"><option value="" selected="selected"></option></select><br />
                                    </center>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <center>
                                        <video autoplay="true" width="160" height="120" id="videoElement"> </video><br />
                                        <button id="snapHat">Capture Image </button><br />
                                    </center>
                                </div>
                                <div class="col-md-6">
                                    <center>
                                        <canvas id="snapshot"></canvas><br />
                                        <p id="demo"></p>

                                        <button id="capture" hidden>Read PDF417</button>  @*don't remove *@
                                        <button id="capture3" hidden>OCR ID </button>  @*don't remove*@
                                        <button id="saveText" hidden>Save Text + Image </button>   @*don't remove *@
                                    </center>
                                </div>
                            </div>


                        </div>
                    </div>
                </div>

                <hr>
                <div>
                    <button onclick="javascript:wizardButtonSetSelection(this)" type="button" id="btnNextPhoto" class="btn btn-xs btn-primary next" style="float:right">Add</button>
                </div>

            </div>
        </div>
    </div>
</div>

<div class="modal fade wizard-modal" id="scan-modal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="close"><i data-dismiss="modal" class="fa fa-times"></i></div>

                <div id="carousel" class="carousel slide" data-pause="true">
                    <div class="carousel-inner">

                        <div class="carousel-item active">
                            <h5>Scan</h5>
                            <hr />
                            <center>
                                <div class="form-group">
                                    <input type="text" class="form-control" placeholder="focus here to add scan"><br>
                                    <table class="table table-bordered table-hover table-striped">
                                        <thead class="thead-info">
                                            <tr>
                                                <th>Scan Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>DOA1VC WLS PJ 129314300038130819130014481398</td>
                                            </tr>
                                            <tr>
                                                <td>DOA1VC WLS PJ 129311300028140819130014481398</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </center>
                        </div>
                    </div>
                </div>

                <hr>
                <div>
                    <button onclick="javascript:wizardButtonSetSelection(this)" type="button" class="btn btn-xs btn-primary next" style="float:right">Add</button>
                </div>

            </div>
        </div>
    </div>
</div>

<div id="maker" data-json='@Html.Raw(JsonConvert.SerializeObject(ViewBag.Maker))' />
<div id="packer" data-json='@Html.Raw(JsonConvert.SerializeObject(ViewBag.Packer))' />
<div id="jsonModel" data-json='@Html.Raw(JsonConvert.SerializeObject(Model))' />
@section Scripts{
    <script src="~/Content/dashforge/lib/cleave.js/cleave.min.js"></script>
    <script src="~/Content/dashforge/lib/select2/js/select2.min.js"></script>
    <script src="~/Content/dashforge/lib/moment/moment.js"></script>

    <script src="~/Content/dashforge/lib/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="~/Content/dashforge/lib/datatables.net-dt/js/dataTables.dataTables.min.js"></script>
    <script src="~/Content/dashforge/lib/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/Content/dashforge/lib/datatables.net-responsive-dt/js/responsive.dataTables.min.js"></script>

    <script>
        $('.select2').select2({
            allowClear: true,
            placeholder: 'Choose one',
            searchInputPlaceholder: 'Search options'
        });
        $('#prodTech').select2('destroy');
        $('#prodTech').select2({
            placeholder: 'Choose one or more',
            searchInputPlaceholder: 'Search options'
        });
        $('.datepicker').datepicker({
            format: 'dd-M-yy',
            language: 'id-ID'
        });
        function validateInput(e) {
            if ($('#FACode1').val() != "" && $('#AsalLU1').val() != "")
                wizardButtonSetSelection(e);
            else
                alert("Please fill the form");
        }
        function validateInput1(e) {
            if ($('#FACode2').val() != "" && $('#AsalLU2').val() != "")
                wizardButtonSetSelection(e);
            else
                alert("Please fill the form");
        }
        function validateInputFW(e) {
            if ($('#FACode3').val() != "" && $('#AsalLU3').val() != "")
                wizardButtonSetSelection(e);
            else
                alert("Please fill the form");
        }
        function tableOnScroll() {
            $(this).find("tfoot tr.input").css("transform", `translateX(-${$(this).scrollLeft()}px)`);
        }
        function ieFix() {
            //if (navigator.userAgent.search("Edge") >= 0) {
            //    $(".tableWrapper:has(tfoot)").not(".no-ie-fix").each(function () {
            //        $(this).find("tfoot tr.input").css({ "position": "fixed", "bottom": "0" });
            //        $(this).find("table").css({ "margin-bottom": "32px" });
            //        $(this).css({ "overflow-y": "scroll" });
            //        const ths = $(this).find("thead tr.summary-body").find("th, td");
            //        $(this).find("tfoot tr.input td").each(function (i, td) {
            //            $(td).css({ "min-width": Math.floor($($(ths)[i]).outerWidth()), "position": "static" });
            //        });
            //        $(this).off('scroll', tableOnScroll).on('scroll', tableOnScroll);
            //    });
            //    $('.tableWrapper thead tr').each(function () {
            //        const top = $(this).position().top;
            //        $(this).children().css({ "top": top });
            //    });
            //}
        }
        function uuidv4() {
            return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));
        }

        function generateRow(data, targetTable) {
            let r = "";
            $(`#${targetTable} ~ tfoot tr.input td`).children("input, select").each(function () {
                const name = $(this).prop("name");
                r += `<td data-name="${name}">${data[name]}</td>`;
            });

            let useEdit = true;
            let useDelete = true;
            let additionalButtons = "";
            if (configAle[targetTable].rowConfig !== undefined) {
                if (configAle[targetTable].rowConfig.withEdit !== undefined)
                    useEdit = configAle[targetTable].rowConfig.withEdit;
                if (configAle[targetTable].rowConfig.withDelete !== undefined)
                    useDelete = configAle[targetTable].rowConfig.withDelete;
                if (configAle[targetTable].rowConfig.additionalButtons != undefined)
                    additionalButtons = configAle[targetTable].rowConfig.additionalButtons(data);
            }
            r += `<td class="tx-center">`;
            r += additionalButtons;
            if (useEdit) r += `<i onclick="javascript:editData(this)" data-id="${data.id}" data-target-table="${targetTable}" class="fa fa-edit edit"></i>`;
            if (useDelete) r += `<span onClick="javascript:deleteData(this)" data-id="${data.id}" data-target-table="${targetTable}"><i class="fa fa-trash"></i></span>`;
            r += `</td >`;
            return r;
        }
        function generateTable(arr, targetTable) {
            if (arr.length == 0) return "";
            let rows = "";
            for (var i = arr.length - 1; i >= 0; i--) {
                rows += '<tr>';
                rows += generateRow(arr[i], targetTable);
                rows += '</tr>';
            }
            return rows;
        }
        function findInArray(id, crr) {
            for (var i = 0; i < crr.length; i++) {
                if (crr[i].id == id) {
                    return i;
                }
            }
        }
        function deleteFromArray(id, crr) {
            crr.splice(findInArray(id, crr), 1);
            return crr;
        }
        function editData(button) {
            const table = $(button).parents("table");
            if (!$(table).data("edited")) {
                $(table).data("edited", true);

                const tds = $(button).parents("tr").children('td');
                const inputTr = $(table).find('tr.input');
                const inputTds = $(inputTr).children('td');
                const tdsCount = $(tds).length;

                $(tds).each(function (i, e) {
                    const el = $(inputTds[i]).children()[0];
                    if (i != tdsCount - 1) {
                        const html = $(e).html();
                        const newInput = $(el).clone();
                        if (!$(el).hasClass("disabled"))
                            $(newInput).prop("disabled", false);

                        $(el).prop("disabled", true);
                        $(newInput).val(html);
                        $(e).html(newInput);
                    } else {
                        $(el).off("click");
                        const edit = $(e).find(".edit");
                        $(edit).attr("onclick", "javascript:normalData(this)");
                        $(edit).removeClass("fa-edit");
                        $(edit).addClass("fa-save");
                    }
                });
            }
            $('.datepicker').datepicker({
                format: 'dd-M-yy',
                language: 'id-ID'
            });
            $('.input-time').toArray().forEach(function (field) {
                new Cleave(field, {
                    time: true,
                    timePattern: ['h', 'm']
                });
            });
            ieFix();
        }
        function releaseDisabledInput(table) {
            $(table).data("edited", false);
            const tds = $(table).find('tr.input td');
            const tdsCount = $(tds).length;
            $(tds).each(function (i, e) {
                const el = $(e).children()[0];
                if (i != tdsCount - 1) {
                    if (!$(el).hasClass("disabled"))
                        $(el).prop("disabled", false);
                } else {
                    var ev = $._data(el, 'events');
                    if (!(ev && ev.click))
                        $(el).on("click", addToTable);
                }
            });
        }
        function wizardButtonSetSelection(button) {
            selected = $(button).html();
            wizardButtonNext(button);
        }
        function wizardButtonNext(button) {
            const modal = $(button).parents(".modal");
            const carousel = $(modal).find('.carousel');
            const index = $(carousel).find('.carousel-item.active').index();
            const stepper = $(modal).find('.stepper');

            var info = { shouldReturn: false, shouldHide: false };
            $(modal).trigger("next", [index, info]);
            if (info.shouldReturn) return;
            if (info.shouldHide) { $(modal).modal('hide'); return; }

            $(stepper).children('.active').removeClass("active");

            $(carousel).carousel('next');
            $(stepper).children(`.stepper-step:nth-child(${index + 2})`).toggleClass("active");
            $(modal).find(".prev").show();
        };
        function generateWizardButton(arr) {
            let r = "";
            for (var i = 0; i < arr.length; i++) {
                r += `<button type="button" class="wizard-button btn btn-primary" onclick="javascript:wizardButtonSetSelection(this)">${arr[i]}</button>`;
            }
            return r;
        }
        function startupSetup(target, data) {
            $(target).html(generateTable(data, target));
            countSummary(target);
        }
        $(document).ready(function () {
            $('.datepicker').datepicker({
                format: 'dd-M-yy',
                language: 'id-ID'
            });
            $('.input-time').toArray().forEach(function (field) {
                new Cleave(field, {
                    time: true,
                    timePattern: ['h', 'm']
                });
            });
            $(".add-to-table").on("click", addToTable);
            $('.tableWrapper thead tr').each(function () {
                const top = $(this).position().top;
                $(this).children().css({ "top": top });
            });
            $(".wizard-modal .next").click(wizardButtonNext);
            $(".wizard-modal .prev").click(function () {
                const modal = $(this).parents(".modal");
                const carousel = $(modal).find('.carousel');
                const stepper = $(modal).find('.stepper');
                const index = $(carousel).find('.carousel-item.active').index();

                $(stepper).children('.active').removeClass("active");

                $(carousel).carousel('prev');
                $(stepper).children(`.stepper-step:nth-child(${index})`).toggleClass("active");
                if (index == 1) $(modal).find(".prev").hide();
            });
            $('.wizard-modal').on('hidden.bs.modal', function (e) {
                const carousel = $(this).find('.carousel');
                const stepper = $(this).find('.stepper');
                $(this).find('.active').removeClass("active");
                $(stepper).children(".stepper-step:first-child").toggleClass("active");
                $(carousel).find(".carousel-item:first-child").toggleClass("active");
                $(this).trigger("hide");
                $(this).find(".prev").hide();
            });
        });
        function addToTable(button) {
            const targetTable = $(this).data("target");
            const tds = $(this).parents("tr").children("td");
            var newdata = {
                id: uuidv4()
            };
            let shouldReturn = false;
            $(tds).each(function (tdIndex, td) {
                const input = $(td).children();
                if (input.attr("name") != undefined) {
                    const name = input.attr("name");
                    const val = input.val();
                    if (configAle[targetTable].onValidate != undefined) {
                        if (configAle[targetTable].onValidate(name, val)) {
                            shouldReturn = true;
                            if ((input[0].nodeName.toLowerCase() === 'select')) {
                                $(input[0]).siblings(".select2-container").css('border', '1px solid red');
                                $(input[0]).siblings(".select2-container").css('border-radius', '0.25rem');
                                $(input[0]).on('select2:select', function (e) {
                                    $(input[0]).siblings(".select2-container").css('border', 'none');
                                    $(input[0]).siblings(".select2-container").css('border-radius', '0');
                                });
                            } else if (input[0].value === "") {
                                input[0].style.borderColor = "red";
                                $(input[0]).on('click', function (e) {
                                    input[0].style.borderColor = "rgb(192, 204, 218)";
                                });
                            }
                            return false;
                        }
                    }
                    if (input[0].type.toLowerCase() == "number") {
                        var myRegexp = /^00+$/g;
                        var match = myRegexp.exec(val);
                        if (match != null) {
                            alert("Please input a valid number");
                            shouldReturn = true;
                            return false;
                        }
                    }
                    newdata[name] = val;
                }
            });
            if (shouldReturn) return;
            $(tds).each(function (i, td) {
                const node = $(td).children();
                $(node).val("");
                if ($(node).hasClass("select2"))
                    $(node).trigger('change');
            });

            if (configAle[targetTable].onAdd != undefined) {
                if (configAle[targetTable].onAdd(newdata)) {
                    return;
                }
            }
            configAle[targetTable].data.push(newdata);
            $("#" + targetTable).html(generateTable(configAle[targetTable].data, targetTable));
            countSummary(targetTable);
            ieFix();
        }
        function countSummary(targetTable) {
            if (configAle[targetTable].countSummary != undefined) {
                const rowData = configAle[targetTable].countSummary();
                const summaryTds = $('#' + targetTable).parents('table').find('.summary-body').children();
                $('#' + targetTable).parents('table').find('.input td').each(function (i, td) {
                    const name = $(td).children().attr("name");
                    if (rowData.hasOwnProperty(name))
                        $(summaryTds[i]).html(rowData[name]);
                });
            }
        }
        function collectAllComponent() {
            let components = [];
            let values = [];
            $('.collect-component').each(function (i, p) {
                const id = $(p).prop("id");
                $(this).find('input, select, textarea').each(function (i2, e) {
                    components.push({
                        ComponentType: $(e).prop('nodeName'),
                        ComponentName: id + "-" + $(e).prop('name'),
                    })
                    var tem_value = $(e).val();
                    if (Array.isArray(tem_value)) {
                        tem_value = tem_value.join('___');
                    }
                    values.push({
                        Value: tem_value,
                        ValueType: $(e).attr('type') == "number" ? "Numeric" : "NonNumeric",
                    });
                });
            });
            return [components, values];
        }
        function collectAllData() {
            let collectorArray = [];
            for (var tableId in configAle) {
                let tableColumnType = {};
                $(`#${tableId} ~ tfoot tr.input td input`).each(function () {
                    tableColumnType[$(this).prop("name")] = $(this).prop("type");
                });
                const data = configAle[tableId].data;
                for (let i = 0; i < data.length; i++) {
                    for (var prop in data[i]) {
                        if (Object.prototype.hasOwnProperty.call(data[i], prop)) {
                            if (prop == "id") continue;
                            let val = data[i][prop];
                            if (configAle[tableId].onCollectData != undefined) {
                                val = configAle[tableId].onCollectData(prop, val);
                            }
                            console.log(prop, val);
                            collectorArray.push({
                                HeaderName: tableId,
                                FieldName: prop,
                                Value: val,
                                ValueType: tableColumnType[prop] == "number" ? "Numeric" : "NonNumeric",
                                RowNumber: i
                            });
                            console.log(collectorArray);
                        }
                    }
                }
            }
            return collectorArray;
        }
        function deleteData(button) {
            if (confirm("Are you sure?")) {
                const id = $(button).data("id");
                const targetTable = $(button).data("target-table");
                const table = $(button).parents("table");
                releaseDisabledInput(table);
                if (configAle[targetTable].onDelete != undefined) {
                    if (configAle[targetTable].onDelete(id)) {
                        return;
                    }
                }
                deleteFromArray(id, configAle[targetTable].data);
                $('#' + targetTable).html(generateTable(configAle[targetTable].data, targetTable));
                countSummary(targetTable);
                ieFix();
            }
        }
        function normalData(button) {
            if (confirm("Are you sure?")) {
                const id = $(button).data("id");
                const targetTable = $(button).data("target-table");
                const tds = $(button).parents("tr").children('td');
                const tdsCount = $(tds).length;
                const table = $(button).parents("table");

                if (configAle[targetTable].onSave != undefined) {
                    if (configAle[targetTable].onSave(id)) {
                        return;
                    }
                }
                const index = findInArray(id, configAle[targetTable].data);
                let shouldReturn = false;
                var newdata = {
                    id: uuidv4()
                };
                $(tds).each(function (tdIndex, e) {
                    if (tdIndex != tdsCount - 1) {
                        const name = $(e).data("name");
                        const val = $($(e).children()[0]).val();
                        if (configAle[targetTable].onValidate != undefined) {
                            if (configAle[targetTable].onValidate(name, val)) {
                                shouldReturn = true;
                                return false;
                            }
                        }
                        newdata[name] = val;
                    } else {
                        const edit = $(e).find(".edit");
                        $(edit).attr("onclick", "javascript:editData(this)");
                        $(edit).removeClass("fa-save");
                        $(edit).addClass("fa-edit");
                    }
                });
                if (shouldReturn) return;

                configAle[targetTable].data[index] = newdata;
                const row = generateRow(configAle[targetTable].data[index], targetTable);
                $(button).parents("tr").html(row);

                releaseDisabledInput(table);
                countSummary(targetTable);
                ieFix();
            }
        }
        function countDuration(start, end, duration) {
            var end = $('#' + end).val();
            var start = $('#' + start).val();

            if (start != "" && end != "") {
                end = end.split(':');
                start = start.split(':');
                var d = new Date();
                var startdate = new Date(d.getFullYear(), d.getMonth(), d.getDate(), start[0], start[1]);
                var enddate = new Date(d.getFullYear(), d.getMonth(), d.getDate(), end[0], end[1]);

                if (startdate > enddate) {
                    enddate = new Date(enddate);
                    enddate.setDate(enddate.getDate() + 1);
                }

                var diffTime = enddate - startdate;
                var diffMinutes = Math.ceil(diffTime / 60000);
                $('#' + duration).val(diffMinutes);
            }
        };</script>
    <script>
        /*
                    * name = id dari tbody;
                    * data = array untuk menyimpan data;
                    * countSummary = dipanggil saat menghitung summary, return object dengan property sesuai dengan name pada `tfoot tr.input`;
                    * onAdd(newData) = dipanggil sebelum menambah data, return boolean apakah harus ditambahkan atau tidak;
                    * onDelete(idOfDeletedObject) = dipanggil sebelum menghapus data, return boolean apakah harus dihapus atau tidak;
                    * onSave(idOfUpdatedObject) = dipanggil sebelum mengubah data, return boolean apakah harus diubah atau tidak;
                    * onValidate(nameOfInput, valueOfInput) = validasi nilai saat tambah dan save, return boolean apakah harus diterus atau tidak;
                    *
                    * rowConfig = config untuk generate baris tabel;
                    * - withEdit = menampilkan edit, default true;
                    * - withDelete = menampilkan delete, default true;
                    * - additionalButtons(data) = fungsi untuk yang akan mengembalikan button tambahan untuk tiap baris, return element html dalam string;
                    */</script>
    <script>
        var crrData = [];
        var receiveWHSData = [];
        var pouringData = [];
        var saponData = [];
        var filterData = [];
        var filterWasteData = [];
        var logbookData = [];
        var actionData = [];
        const configAle = {
            filter: {
                data: filterData,
                countSummary: function () {
                    let rowData = {
                        TotalFilterVal: 0,
                    };
                    for (var i = 0; i < filterData.length; i++) {
                        rowData.TotalFilterVal += parseInt(filterData[i].TotalFilterVal);
                    }
                    return rowData;
                },
                onValidate(name, val) {
                    if(name == "ProductionDateVal"){
                        if(!moment(val, 'DD-MMM-YY',true).isValid()){
                            alert("Wrong date format!");
                            return true;
                        }
                    } else if (val == "") {
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },
            },
            crr: {
                data: crrData,
                countSummary: function () {
                    let rowData = {
                        WeightVal: 0.0,
                    };
                    for (var i = 0; i < crrData.length; i++) {
                        rowData.WeightVal += Number.parseFloat(crrData[i].WeightVal);
                    }
                    return rowData;
                },
                onValidate(name, val) {
                    if (val == "") {
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },
                rowConfig:{
                    additionalButtons(data){
                        return `<i onclick="printBarcode(this)" class="fa fa-print"></i>`;
                    },
                },
            },
            sapon: {
                data: saponData,
                countSummary: function () {
                    let rowData = {
                        WeightVal2: 0.0,
                    };
                    for (var i = 0; i < saponData.length; i++) {
                        rowData.WeightVal2 += Number.parseFloat(saponData[i].WeightVal2);
                    }
                    return rowData;
                },
                onValidate(name, val) {
                    if (val == "") {
                        console.log(name);
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },

            },
            filterWaste: {
                data: filterWasteData,
                countSummary: function () {
                    let rowData = {
                        WeightValFW: 0.0,
                    };
                    for (var i = 0; i < filterWasteData.length; i++) {
                        rowData.WeightValFW += Number.parseFloat(filterWasteData[i].WeightValFW);
                    }
                    return rowData;
                },
                onValidate(name, val) {
                    if (val == "") {
                        console.log(name);
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },

            },
            pouring: {
                data: pouringData,
                countSummary: function () {
                    let rowData = {
                        GrossWeight: 0,
                        NetWeight: 0,
                    };
                    for (var i = 0; i < pouringData.length; i++) {
                        rowData.GrossWeight += parseInt(pouringData[i].GrossWeight);
                        rowData.NetWeight += parseInt(pouringData[i].NetWeight);
                    }
                    return rowData;
                },
                onValidate(name, val) {
                    if (val == "") {
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },
            },
            receiveWHS: {
                data: receiveWHSData,
                countSummary: function () {
                    let rowData = {
                        GrossWeight: 0,
                        NetWeight: 0,
                    };
                    for (var i = 0; i < receiveWHSData.length; i++) {
                        rowData.GrossWeight += parseInt(receiveWHSData[i].GrossWeight);
                        rowData.NetWeight += parseInt(receiveWHSData[i].NetWeight);
                    }
                    return rowData;
                },
            },
            logbook: {
                data: logbookData,

                onValidate(name, val) {
                    if (val == "") {
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },
                onAdd: function (newData) {
                    console.log(newData);
                },
            },
            action: {
				data: actionData,
				onValidate(name, val) {
					if (val == "") {
						alert("Value can't be empty");
						return true;
					}
					return false;
                },
                countSummary: function () {
					let rowData = {};
					let NextDurasi = 0;
					for (var i = 0; i < actionData.length; i++) {
						NextDurasi += parseInt(actionData[i].NextDurasi);
					}
					rowData.NextDurasi = NextDurasi;
					return rowData;
				},
				onAdd: function (newData) {
					console.log(newData);
				},
			},
        }

        function printBarcode(button) {
            var tr = $(button).parents('tr');
            var barcode = @(Model.LPH.ID) + '_' + tr.find('td').eq(10).text();
            var desc = "";

                $.ajax({
                    type: "POST",
                    url: "@Url.Action("GetBrand", "GWGeneral")",
                    data: JSON.stringify({
                        brand: tr.find('td').eq(1).text().trim()
                    }),
                    async: false,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        if (result.Status == true) {
                            desc = result.desc;
                            console.log(result);
                            var info = tr.find('td').eq(0).text().trim() + '_' + tr.find('td').eq(1).text().trim() + '_' + tr.find('td').eq(4).text().trim() + '_' + tr.find('td').eq(5).text().trim() + '_' + tr.find('td').eq(7).text().trim() + '_' + tr.find('td').eq(9).text().trim();
                            var mywindow = window.open('@(Url.Action("PrintBarcode","GWGeneral"))?barcode='+barcode+"&info="+info+"&desc="+desc, '_blank',"location=yes,scrollbars=yes,status=yes");
                        }
                    }
                });
        };
        $('#scanner-receiveWHS').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if (keycode == '13') {
                const val = $(this).val();
                val = val.replace(/\s+/g, " ");
                val = val.split(" ");

                var no = val[0];
                var wlslotnum = val[1];

                val = val[2];
                val = val.split("-").join("");
                var batch = val.substring(0, 9);
                var boxno = val.substring(9, 11);
                console.log(val.substring(11, 16));
                var date = parseInt(val.substring(11, 16)) - 1;
                var d = new Date(1900, 0, 0);
                d.setDate(d.getDate() + date);
                date = d;
                var netweight = val.substring(16, 21) / 100;
                var grosweight = val.substring(21, 26) / 100;

                if (isNaN(netweight) || isNaN(grosweight)) {
                    alert("Invalid barcode!");
                    return;
                }
                const tdm = moment(date, "DDMMYY");
                if(!tdm.isValid()){
                    alert("Invalid barcode!!");
                    return;
                }
                var td = tdm.format("DD-MMM-YY");
                //Code	WLS Los Number	Batch No	Box No	Date	Net Weight	Gross Weight
                $('#receiveWHS ~ tfoot tr.input input[name="Code"]').val(no);
                $('#receiveWHS ~ tfoot tr.input input[name="WLSLosNumber"]').val(wlslotnum);
                $('#receiveWHS ~ tfoot tr.input input[name="BatchNo"]').val(batch);
                $('#receiveWHS ~ tfoot tr.input input[name="BoxNo"]').val(boxno);
                $('#receiveWHS ~ tfoot tr.input input[name="Date"]').val(td);
                $('#receiveWHS ~ tfoot tr.input input[name="NetWeight"]').val(netweight);
                $('#receiveWHS ~ tfoot tr.input input[name="GrossWeight"]').val(grosweight);
                $('.add-to-table[data-target="receiveWHS"]').click();
                $(this).val("");
            }
        });
        $('#scanner-pouring').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if (keycode == '13') {
                const val = $(this).val();
                val = val.replace(/\s+/g, " ");
                val = val.split(" ");

                var no = val[0];
                var wlslotnum = val[1];

                val = val[2];
                val = val.split("-").join("");
                var batch = val.substring(0, 9);
                var boxno = val.substring(9, 11);
                console.log(val.substring(11, 16));
                var date = parseInt(val.substring(11, 16)) - 1;
                var d = new Date(1900, 0, 0);
                d.setDate(d.getDate() + date);
                date = d;
                var netweight = val.substring(16, 21) / 100;
                var grosweight = val.substring(21, 26) / 100;

                if (isNaN(netweight) || isNaN(grosweight)) {
                    alert("Invalid barcode!");
                    return;
                }
                const tdm = moment(date, "DDMMYY");
                if(!tdm.isValid()){
                    alert("Invalid barcode!");
                    return;
                }
                var td = tdm.format("DD-MMM-YY");
                var pd = moment().format('DD-MMM-YY');
                //Code	WLS Los Number	Batch No	Box No	Date	Net Weight	Gross Weight
                $('#pouring ~ tfoot tr.input input[name="Code"]').val(no);
                $('#pouring ~ tfoot tr.input input[name="WLSLosNumber"]').val(wlslotnum);
                $('#pouring ~ tfoot tr.input input[name="BatchNo"]').val(batch);
                $('#pouring ~ tfoot tr.input input[name="BoxNo"]').val(boxno);
                $('#pouring ~ tfoot tr.input input[name="Date"]').val(td);
                $('#pouring ~ tfoot tr.input input[name="NetWeight"]').val(netweight);
                $('#pouring ~ tfoot tr.input input[name="GrossWeight"]').val(grosweight);
                $('#pouring ~ tfoot tr.input input[name="PouringDate"]').val(pd);
                $('.add-to-table[data-target="pouring"]').click();
                $(this).val("");
            }
        });
        $('#scanner-filter').keypress(function (event) {
            var keycode = (event.keyCode ? event.keyCode : event.which);
            if (keycode == '13') {
                console.log("lala");
                const val = $(this).val();
                var no = val.substring(0, 6);
                var wlslotnum = val.substring(7, 10);
                var batch = val.substring(11, 20);
                var boxno = val.substring(20, 25);
                var date = val.substring(25, 31);
                var netweight = val.substring(31, 35) / 10;
                var grosweight = val.substring(35, 39) / 10;

                if (isNaN(netweight) || isNaN(grosweight)) {
                    alert("Invalid barcode!");
                    return;
                }
                const tdm = moment(date, "DDMMYY");
                if(!tdm.isValid()){
                    alert("Invalid barcode!");
                    return;
                }
                var td = tdm.format("ddd, DD-MMM-YY");
                $('#filter ~ tfoot tr.input input[name="MachineVal"]').val("-");
                $('#filter ~ tfoot tr.input input[name="TakeTimeVal"]').val("-");
                $('#filter ~ tfoot tr.input input[name="TotalFilterVal"]').val("0");
                $('#filter ~ tfoot tr.input input[name="ItemCodeVal"]').val(no);
                $('#filter ~ tfoot tr.input input[name="BoxNo"]').val(boxno);
                $('#filter ~ tfoot tr.input input[name="BatchVal"]').val(batch);
                $('#filter ~ tfoot tr.input input[name="ProductionDateVal"]').val(td);
                $('.add-to-table[data-target="filter"]').click();
                console.log("lala1");
                $(this).val("");
            }
        });</script>
    <script type="text/javascript">

        //print barcode
        $(document).ready(function () {
            $('table').on("click", ".print_barcode", function (e) {
                e.preventDefault();

                var tr = $(this).closest('tr');
                var barcode = @(Model.LPH.ID) + '_' + tr.find('td').eq(10).text();
                var desc = "";

                $.ajax({
                    type: "POST",
                    url: "@Url.Action("GetBrand", "GWGeneral")",
                    data: JSON.stringify({
                        brand: tr.find('td').eq(1).text().trim()
                    }),
                    async: false,
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (result) {
                        if (result.Status == true) {
                            desc = result.desc;
                            console.log(result);
                            var info = tr.find('td').eq(0).text().trim() + '_' + tr.find('td').eq(1).text().trim() + '_' + tr.find('td').eq(4).text().trim() + '_' + tr.find('td').eq(5).text().trim() + '_' + tr.find('td').eq(7).text().trim() + '_' + tr.find('td').eq(9).text().trim();
                            var mywindow = window.open('@(Url.Action("PrintBarcode","GWGeneral"))?barcode='+barcode+"&info="+info+"&desc="+desc, '_blank',"location=yes,scrollbars=yes,status=yes");
                        }
                    }
                });
            });
        });

        $(function () {
            'use strict';

            /******************** PREFILLED ******************/

            var model = JSON.parse($("#jsonModel").attr("data-json"));
            console.log("prefilled area");
            console.log(model);
            for (var i = 0; i < model.CompoVal.length; i++) {
                const type = model.CompoVal[i].Component.ComponentType.trim();
                let val = model.CompoVal[i].Value.Value;
                val = decodeURIComponent(val ? val : "");
                if (type == "Image") {
                    $("#image_1_hide").html('<img class="input-img rounded mx-auto d-block" id="image_1" src="'+fastApp.BaseUrl +'/Uploads/lph/gwgeneral/' + val + '" onclick="infoId(this)" data-toggle="modal" data-target="#photo-modal" width="160px" />');
                }
                //else {
                //   const tn = model.CompoVal[i].Component.ComponentName.split("-");
                //    const type = model.CompoVal[i].Component.ComponentType.trim();
                //    const parent = tn[0];
                //    tn.shift();
                //    const child = tn.join("-");
                //    var val = model.CompoVal[i].Value.Value;
                //    const node = $("#" + parent + " " + type + "[name=" + child + "]");
                //    var temp_val = decodeURIComponent(val ? val : "");
                //    $(node).val(temp_val);
                //    if ($(node).hasClass("select2")) {
	               //     if (temp_val.indexOf('___') !== -1) {
		              //      temp_val = temp_val.split('___');
		              //      $(node).val(temp_val);
	               //     }
	               //     $(node).trigger('change');
                //    }
                //}
            }
			for (var i = 0; i < model.CompoVal.length; i++) {
				const tn = model.CompoVal[i].Component.ComponentName.split("-");
				const type = model.CompoVal[i].Component.ComponentType.trim();
				const parent = tn[0];
				tn.shift();
				const child = tn.join("-");
                const val = model.CompoVal[i].Value.Value;
                let node = $("#" + parent + " " + type + "[name=" + child + "]");
				var temp_val = decodeURIComponent(val ? val : "");
                $(node).val(temp_val);
                if (child == 'Group' && type == 'INPUT' && parent == 'GeneralInfo') {
                    node = $("#" + parent + " " + "SELECT" + "[name=" + child + "]");
                    $(node).val(temp_val);
                }
                if ($(node).hasClass("select2")) {
	                if (temp_val.indexOf('___') !== -1) {
		                temp_val = temp_val.split('___');
		                $(node).val(temp_val);
	                }
	                $(node).trigger('change');
                }
			}
			while (model.Extras.length > 0) {
				const lastIndex = model.Extras.length - 1;
				const table = model.Extras[lastIndex].HeaderName;
				const row = model.Extras[lastIndex].RowNumber;
				let data = {
					id: uuidv4()
				};
				for (let i = lastIndex; i >= 0; i--) {
					if (model.Extras[i].HeaderName == table && model.Extras[i].RowNumber == row) {
						const val = model.Extras[i].Value;
						data[model.Extras[i].FieldName] = decodeURIComponent(val ? val : "");
						if (model.Extras.length == 1) model.Extras = [];
						else model.Extras.splice(i, 1);
					}
				}
				configAle[table].data.push(data);
			}
			for (let prop in configAle) {
				configAle[prop].data.reverse();
				$("#" + prop).html(generateTable(configAle[prop].data, prop));
				countSummary(prop);
				ieFix();
			}

		});


		/****************** END PREFILLED ****************/

          $('#btnHistory').on('click', function (e) {
		     location.href = '@Url.Action("Index", "History")';
          });

    </script>
    <script>
        function collectImageComponent() {
            var imageUrl1 = {};
            imageUrl1.ComponentType = "Image";
            imageUrl1.ComponentName = "Image1";

            return imageUrl1;
        }
        function collectImageValue() {
            var imageUrl1 =$('#image_1_show').find('#image_1').first().attr('src');
            var imageVal1 = {};
            imageVal1.Value = imageUrl1;
            imageVal1.ValueType = "ImageURL";
            return imageVal1;
        }

		$('#goPrev').click(function () {
                $.ajax({
                  type: "POST",
                  url: "@Url.Action("CheckPrev", "GWGeneral")",
                  data: JSON.stringify({
                      LPHID: @(Model.LPH.ID),
                  }),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  success: function (result) {
					if (result.Status) {
						//ketika data ada, munculkan dalam window baru
                        window.open("@(Url.Action("Submitted", "GWGeneral"))?lphid="+result.LPHID+"&type=1", "window baru", "height=400,width=1300");
					}
					else {
						var notice = new PNotify({
							title: "@UIResources.ErrorMessage",
							text: "No previous submissions found",
							width: "400px",
                            type: 'error',
                            addclass: 'stack-bottomright',
							hide: false,
							buttons: {
								sticker: false
							}
						});

						notice.get().click(function () {
								notice.remove();
							});
						}
                    }
                });
            })

        $('#btnApprove').click(function (e) {
            var collectorArray = collectAllData(); // for LPH Extras
            var collector = collectAllComponent();
            var collectorComponent = collector[0];
            var collectorValue = collector[1];
            var comment = $('#comment_value').val();

            collectorComponent.push(collectImageComponent());
            collectorValue.push(collectImageValue());
            console.log("Panggil :: Okey");
            //console.log(collector);
               $.ajax({
                  type: "POST",
                  url: "@Url.Action("Approval", "GWGeneral")",
                  data: JSON.stringify({
                      id: @(Model.LPH.ID),
                      detailExtras: collectorArray, detailComponent: collectorComponent,
                      detailValue: collectorValue

                  }),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  success: function (result) {
                      console.log(result.Status);
					if (result.Status == 'True') {
						var notice = new PNotify({
							title: "@UIResources.Confirmation",
							text: "@UIResources.CreateSucceed",
							width: "400px",
							type: 'success',
							addclass: 'stack-bottomright'
						});

						notice.get().click(function () {
							notice.remove();
                        });

                        setTimeout(function () {
                            location.reload();
                        }, 3000);
					}
					else {
						var notice = new PNotify({
							title: "@UIResources.ErrorMessage",
							text: "@UIResources.CreateFailed",
							width: "400px",
                            type: 'error',
                            addclass: 'stack-bottomright',
							hide: false,
							buttons: {
								sticker: false
							}
						});

						notice.get().click(function () {
								notice.remove();
							});
						}
                    }
                });
        });
         $('#btnReject').click(function (e) {

            var comment = $('#comment_value').val();


               $.ajax({
                  type: "POST",
                  url: "@Url.Action("Rejected", "GWGeneral")",
                  data: JSON.stringify({
                      id: @(Model.LPH.ID),
                      comment: comment

                  }),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  success: function (result) {
                      console.log(result.Status);
					if (result.Status == 'True') {
						var notice = new PNotify({
							title: "@UIResources.Confirmation",
							text: "@UIResources.CreateSucceed",
							width: "400px",
							type: 'success',
							addclass: 'stack-bottomright'
						});

						notice.get().click(function () {
							notice.remove();
                        });

                        setTimeout(function () {
                            location.reload();
                        }, 3000);
					}
					else {
						var notice = new PNotify({
							title: "@UIResources.ErrorMessage",
							text: "@UIResources.CreateFailed",
							width: "400px",
                            type: 'error',
                            addclass: 'stack-bottomright',
							hide: false,
							buttons: {
								sticker: false
							}
						});

						notice.get().click(function () {
								notice.remove();
							});
						}
                    }
                });
        });
    </script>
    <script>
        $(function () {
            'use strict'

            //$('.select2').click({
            //    placeholder: 'Choose one',
            //    searchInputPlaceholder: 'Search options'
            //});
        })</script>

    <script>
        var isUrlLink = false;
        var isImg = [];
        var imgContent = [];
        var imageIndex = 0;
        var max = 1;

        function defaultDisplay() {
            for (var i = 0; i < max; i++) {
                $("#image_" + (i + 1) + "_show").hide();
                $("#image_" + (i + 1) + "_hide").show();
            }
        }

        function switchDisplay() {
            for (var i = 0; i < max; i++) {
                if (isImg[i] == true) {
                    $("#image_" + (i + 1) + "_show").show();
                    $("#image_" + (i + 1) + "_hide").hide();
                }
            }
        }


        function infoId(e) {
            console.log(e.id);

            for (var i = 0; i < max; i++) {
                if (e.id == "image_" + (i + 1) + "") {
                    isImg[i] = true;
                } else {
                    isImg[i] = false;
                }
            }
        }

        function renderImage(link, state) {

            if (link == null || link == "") {
                isUrlLink = false;
            }
            else {

                isUrlLink = true;

                if (state == "image_1") {
                    img1Content = link;
                    document.getElementById("image_1_show").innerHTML = '<img class="input-img rounded mx-auto d-block" src=' + img1Content + ' id="image_1" width="160px" data-toggle="modal" data-target="#photo-modal" />';
                }

            }
        }

        $("#t_splacing").click(function () {
            isImg[0] = true;
        });

        var makerList = [
            "M51",
            "M52",
            "M53",
            "M54",
            "M55",
            "M56",
            "M57",
            "M58",
            "M59"
        ];
        var packerList = [
            "P51",
            "P52",
            "P53",
            "P54",
            "P55",
            "P56",
            "P57",
            "P58",
            "P59"
        ];

        var selected;
        function generateWizardButton(arr) {
            let r = "";
            for (var i = 0; i < arr.length; i++) {
                r += `<button type="button" class="wizard-button btn btn-primary" onclick="javascript:wizardButtonSetSelection(this)">${arr[i]}</button>`;
            }
            return r;
        }
        $(document).ready(function () {
            var lphID = @(Model.LPH.ID);
            $('#dtApproval').dataTable({
                "autoWidth": false,
                "processing": true,
                "serverSide": true,
                "info": false,
                "filter": false,
                "bLengthChange": false,
                "orderMulti": false,
                "pageLength": 10,
                "destroy": true,
				"order": [[ 3, "asc" ]],
                "ajax": {
                    "url": fastApp.BaseUrl + '/GWGeneral/GetApproverList?lphid='+ lphID,
                    "type": "POST",
                    "datatype": "json"
                },

                "columnDefs":
                    [{
                        "targets": [0],
                      "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [1],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [2],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [3],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [4],
                        "searchable": true,
                        "orderable": true
                    },

                    ],

                "columns": [

                    { "data": "User", "name": "User", "title": "Name", "autoWidth": false },
                    { "data": "Role", "name": "Role", "title": "Role", "autoWidth": false },
                    { "data": "Status", "name": "Status", "title": "Status", "autoWidth": false },
                    {
                        "data": "ModifiedDate",
                        render: function (data, type, row) {
                            if (data)
                                                                return moment(data).format("DD-MMM-YY HH:mm");
                            else
                                return '';
                        }
                    },
                    { "data": "Notes", "name": "Notes", "title": "Notes", "autoWidth": false }
                ],
                "fnRowCallback": function (nRow, data, iDisplayIndex, iDisplayIndexFull) {
                    $('td', nRow).css('background-color', data['Color']);
                    $('#dtApproval_paginate')[0].style.display = "none";
                }
            });
            defaultDisplay();
            $('#photo-modal').on('next', function (e, i, info) {
                info.shouldHide = true;
            });
            $('#photo-modal').on('hide', function (e) {
            });
            $('#scan-modal').on('next', function (e, i, info) {
                info.shouldHide = true;
            });
            $('#scan-modal').on('hide', function (e) {
            });
            $('#phase-modal').on('next', function (e, i, info) {
                if (!selected) {
                    info.shouldReturn = true;
                    return;
                }
                const tr = $('#crr ~ tfoot tr.input');
                switch (i) {
                    case 0:
                        $(tr).find('input[name="FACode"]').val($('#FACode1').val());
                        $(tr).find('input[name="AsalLU"]').val($('#AsalLU1').val());
                        break;
                    case 1:
                        $(tr).find('input[name="MachineVal"]').val(selected);
                        if (selected == "Maker") {
                            $(this).find(".machine-list").html(generateWizardButton(makerList));
                        } else {
                            $(this).find(".machine-list").html(generateWizardButton(packerList));
                        }
                        selected = null;
                        break;
                    case 2:

                        $(tr).find('input[name="MachineNumVal"]').val(selected);
                        selected = null;
                        break;
                    case 3:

                        $(tr).find('input[name="ItemVal"]').val(selected);
                        selected = null;
                        break;
                    case 4:
                        $(this).find(".next").show();
                        info.shouldHide = true;
                        $(tr).find('input[name="TipeCF"]').val(selected);
                        $(tr).find('input[name="TimeVal"]').val(moment().format("DD-MMM-YY hh:mm"));
                        $(tr).find('input[name="WeightVal"]').val($('#weightCrr').val());
                        $('#FACode1').val("");
                        $('#AsalLU1').val("");
                        $('.add-to-table[data-target="crr"]').click();
                        break;
                }
            });
            $('#phase-modal').on('hide', function (e) {
                crrNewData = {};
                selected = null;
            });
            $('#phase-sapon-modal').on('next', function (e, i, info) {
                if (!selected) {
                    info.shouldReturn = true;
                    return;
                }
                const tr = $('#sapon ~ tfoot tr.input');
                switch (i) {
                    case 0:
                        $(tr).find('input[name="FACode"]').val($('#FACode2').val());
                        $(tr).find('input[name="AsalLU"]').val($('#AsalLU2').val());
                        break;
                    case 1:
                        $(tr).find('input[name="MachineVal"]').val(selected);
                        if (selected == "Maker") {
                            $(this).find(".machine-list").html(generateWizardButton(makerList));
                        } else {
                            $(this).find(".machine-list").html(generateWizardButton(packerList));
                        }
                        selected = null;
                        break;
                    case 2:

                        $(tr).find('input[name="MachineNumVal"]').val(selected);
                        selected = null;
                        break;
                    case 3:

                        $(tr).find('input[name="ItemVal"]').val(selected);
                        selected = null;
                        break;
                    case 4:
                        $(this).find(".next").show();
                        info.shouldHide = true;
                        $(tr).find('input[name="TipeCF"]').val(selected);
                        $(tr).find('input[name="TimeVal"]').val(moment().format("DD-MMM-YY hh:mm"));
                        $(tr).find('input[name="WeightVal"]').val($('#weightCrr').val());
                        $('#FACode2').val("");
                        $('#AsalLU2').val("");
                        $('.add-to-table[data-target="sapon"]').click();
                        break;
                }
            });
            $('#phase-sapon-modal').on('hide', function (e) {
                crrNewData = {};
                selected = null;
            });
            $('#photo-modal').on('next', function (e, i, info) {
                info.shouldHide = true;
                if (isUrlLink == true) switchDisplay();
                else defaultDisplay();
            });
            $('#photo-modal').on('hide', function (e) {
            });

            //chanif: matikan semua input
            $(document).find('input,select,textarea').each(function(){
                $(this).attr('disabled', 'disabled');
            });

            //chanif: matikan semua button tambah/edit/delete. delay 1 detik nunggu load semua
            setTimeout(function (){
                $(document).find('i,span').each(function(){
                    $(this).prop("onclick", null).off("click");
                });
            }, 1000);

            //chanif: jangan munculkan modal ketika gambar di-klik
            $(document).find('img').each(function(){
                $(this).attr("data-toggle", null);
                $(this).attr("data-target", null);
            });

        });</script>

    <script>
        function bin2Strung(array) {
            var result = "";
            var max = 2048;
            for (var i = 0; i < max; i++) {
                var v = String.fromCharCode(array[i]);

                if (array[i] == 10) {
                    result += "<br/>";
                }
                else {
                    if (array[i] == 60) {
                        //result += "&#60";
                        result += "&lt";
                    }
                    else {
                        result += String.fromCharCode(array[i]);
                    }
                }
                if (array[i] == 0) {
                    i = max;
                }
            }
            return result;
        }

        function myFunction() {
            document.getElementById("demo").innerHTML = "Doing My Best!";
        }</script>
}