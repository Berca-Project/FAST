@model Fast.Web.Models.LPH.LPHEditModel
@using Newtonsoft.Json;
@using Fast.Web.Resources;
@{
    ViewBag.Title = "Edit Robot";
    var selected = "";
    var myspecial = ViewBag.Special;

}

@* chanif: tambah css untuk select2 *@
@section CSS_lib{
    <link href="~/Content/dashforge/lib/select2/css/select2.min.css" rel="stylesheet">
}
@section Styles{
    <style>
        .tableWrapper {
            position: relative;
            overflow: auto;
            max-height: 150px;
            transform: translateZ(0);
        }


            .tableWrapper table {
                border-collapse: collapse;
                width: 100%;
            }

            .tableWrapper thead th, .tableWrapper thead td {
                position: sticky;
                background: #066fcb;
                z-index: 100;
                border: none;
            }

            .tableWrapper table tfoot td {
                position: sticky;
                bottom: 0;
                z-index: 100;
            }

            .tableWrapper .input td {
                background: white;
            }

            .tableWrapper .summary-body td {
                font-weight: bold;
                background-color: #d8eafe;
                color: #000;
            }

        .fa {
            padding: 5px;
            cursor: pointer;
        }

        .fas {
            cursor: pointer;
        }
        /* chanif: tolong tambahkan css dari sini sampai bawah untuk memperbaiki tampilan select2 */
        .select2-container--default .select2-selection--single {
            height: 25px;
            min-height: 25px;
        }

        .select2-container--default .select2-selection--multiple {
            min-height: 25px;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            display: none;
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            font-size: 13px;
            padding: 5px;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__rendered {
            font-size: 13px;
            padding: 0 0 0 5px;
        }

        .select2-search--dropdown {
            padding: 1px;
        }

        .select2-container--default .select2-search--dropdown .select2-search__field {
            padding: 3px 5px;
        }

        .select2-results {
            font-size: 13px;
        }

        .select2-results__option {
            padding: 3px;
        }

        table.dataTable thead .sorting_asc, table.dataTable thead .sorting_desc {
            background-color: transparent
        }

        .select2-container--default .select2-search--inline .select2-search__field {
            margin-top: 0;
            padding: 0;
        }

        .select2-results__option[aria-selected=true] {
            display: none;
        }
        #GeneralInfo label { padding-right:0; }
    </style>
}


<div class="content content-fixed lph-form">
    <div class="container-fluid pd-x-0 pd-lg-x-10 pd-xl-x-0">
        <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-30">
            <div>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb breadcrumb-style1 mg-b-10">
                        <li class="breadcrumb-item"><a href="#">LPH Form</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Robot</li>
                    </ol>
                </nav>
                <h4 class="mg-b-0 tx-spacing--1">LPH Robot</h4>
            </div>
            <div class="d-none d-md-block">
                <button id="goPrev" class="btn btn-sm pd-x-15 btn-white btn-uppercase mg-l-5"><i data-feather="chevron-left" class="wd-10 mg-r-5"></i> Prev</button>
                <button id="btnHistory" class="btn btn-sm pd-x-15 btn-primary btn-uppercase mg-l-5"><i data-feather="clock" class="wd-10 mg-r-5"></i> History</button>
                <button class="btn btn-sm pd-x-15 btn-white btn-uppercase" id="btnSaveDraft"><i data-feather="save" class="wd-10 mg-r-5"></i> Save</button>
                <button id="btnSave" class="btn btn-sm pd-x-15 btn-primary btn-uppercase"><i data-feather="save" class="wd-10 mg-r-5"></i> Submit</button>
                <button class="btn btn-sm pd-x-15 btn-uppercase btn-secondary " id="btnReset"><i data-feather="refresh-cw" class="wd-10 mg-r-5"></i> Reset</button>
                <button class="btn btn-sm pd-x-15 btn-white btn-uppercase mg-l-5" onclick="javascript:window.print()"><i data-feather="printer" class="wd-10 mg-r-5"></i> Print</button>
            </div>
        </div>
        <div class="row">
            <div class="col-12 mg-b-20">
                <div class="card collect-component" id="GeneralInfo">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Information</div>
                    <div class="card-body d-flex">
                        <div class="flex-1">
                            <div class="form-group row">
                                <label class="col-3 col-form-label">Date</label>
                                <div class="col-5">
                                    <input name="DateInfo" id="txtDateInfo" type="text" class="form-control information-datepicker mandatory" value="">
                                </div>
                                <label class="col-2 col-form-label tx-right pd-r-0-f">Week</label>
                                <div class="col-2">
                                    <input name="WeekNumber" id="txtWeekNumber" type="text" class="form-control" disabled value="">
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-3 col-form-label">Machine *</label>
                                <div class="col-4">
                                    <select class="form-control select2 mandatory" name="MachInfo" id="machInfo">
                                        <option value="">Select Machine</option>
                                        @foreach (Fast.Web.Models.MachineModel machine in ViewBag.Machines)
                                        {
                                            <option value="@(machine.Code)">@(machine.Code)</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            @*<div class="form-group row">
                                <label class="col-3 col-form-label">Brand</label>
                                <div class="col-9">
                                    <select class="form-control select2 mandatory" name="BrandInfo" id="brandInfo">
                                        <option value="">Select Brand</option>
                                        @foreach (Fast.Web.Models.ReferenceDetailModel brand in ViewBag.Brand)
                                        {
                                            <option value="@(brand.Code)">[@(brand.Code)] @brand.Description</option>
                                        }
                                    </select>
                                </div>
                            </div>*@
                        </div>
                        <div class="divider-text divider-vertical"></div>
                        <div class="flex-1">
                            <div class="form-group row">
                                <label class="col-3 col-form-label">GW Name *</label>
                                <div class="col-8">
                                    <select class="form-control select2 mandatory" name="GWName" id="gwName">
                                        <option value="">Select GW</option>
                                        @foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.GeneralWorker)
                                        {
                                            <option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-3 col-form-label">Prodtech</label>
                                <div class="col-8">
                                    <select class="form-control select2" name="ProdTech" id="prodTech" multiple>

                                        @foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Prodtechs)
                                        {
                                            <option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-3 col-form-label">Mekanik</label>
                                <div class="col-8">
                                    <select class="form-control select2" name="Mekanik" id="mekanik">

                                        @foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Mechanics)
                                        {
                                            <option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
                                        }
                                    </select>

                                </div>
                            </div>
                            @*<div class="form-group row">
            <label class="col-3 col-form-label">Foreman</label>
            <div class="col-8">
                <select class="form-control select2 mandatory" name="Foreman" id="foreman">
                    <option value="">Select Foreman</option>
                    @foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Foremans)
                    {
                        <option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
                    }
                </select>
            </div>
        </div>*@
                        </div>
                        <div class="flex-1">
                            <div class="form-group row">
                                <label class="col-4 col-form-label">Electrician</label>
                                <div class="col-8">
                                    <select class="form-control select2" name="Electrician" id="elektrik">
                                        <option value="">Select Electrician</option>
                                        @foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Electrics)
                                        {
                                            <option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
                                        }
                                    </select>

                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-4 col-form-label">Supervisor *</label>
                                <div class="col-8">
                                    <select class="form-control select2 mandatory" name="TeamLeader" id="teamLeader">
                                        <option value="">Select Team Leader</option>
                                        @foreach (Fast.Web.Models.EmployeeModel employee in ViewBag.Leaders)
                                        {
                                            <option value="@(employee.EmployeeID)">[@(employee.EmployeeID)] @employee.FullName</option>
                                        }
                                    </select>
                                </div>

                            </div>
                            <div class="form-group row">
                                <label class="col-4 col-form-label" style="padding-right: 3px;">PO Number</label>
                                <div class="col-8">
                                    <select class="form-control select2" name="PONumber">
                                        <option value="">Select PO Number</option>
                                        @foreach (Fast.Web.Models.WppModel wpp in ViewBag.WPP)
                                        {
                                            <option value="@(wpp.PONumber)">@(wpp.PONumber)</option>
                                        }
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="divider-text divider-vertical"></div>
                        <div class="flex-1">
                            <div class="form-group row">
                                <label class="col-4 col-form-label">Shift / Group *</label>
                                <div class="col-3">
                                    <input id="shift" type="text" name="Shift" class="form-control mandatory" value="">
                                </div>
                                <label class="col-1 col-form-label tx-center">/</label>
                                <div class="col-3">
                                    @*<input id="group" type="text" name="Group" class="form-control mandatory" value="">*@
                                    <select class="form-control select2 mandatory" name="Group" id="group">
                                        <option value="">Select Group</option>
                                        @foreach (Fast.Web.Models.ReferenceDetailModel detail in ViewBag.referenceGroup)
                                        {
                                            <option value="@(detail.Code)">@(detail.Code)</option>
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <label class="col-4 col-form-label">Start / Stop *</label>
                                <div class="col-3">
                                    <div class="input-group">
                                        <input id="inputTimeStart" name="Start" class="form-control date mandatory" value="">
                                    </div>
                                </div>
                                <label class="col-1 col-form-label">/</label>
                                <div class="col-3">
                                    <div class="input-group">
                                        <input id="inputTimeStop" name="Stop" class="form-control date mandatory" value="">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div> <!--INFORMATION-->

            <div class="col-12 mg-b-20">
                <div class="card collect-component" id="HandoverLogbook">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">
                        Handover Logbook
                    </div>
                    @*<div class="card-body row">
        <div class="col-6">
            <div class="form-group row">
                <label class="col col-form-label font-weight-bold">Quality</label>
            </div>
            <div class="form-group row">
                <label class="col-6 col-form-label">
                    Quality Flags
                </label>
                <div class="col-2">
                    <input type="number" onkeypress="validateNumber(event)" placeholder="0" name="hlqualityFlags" class="form-control">*@
                    @*<select class="form-control select2" name="hlqualityFlags">
            <option value="NA">NA</option>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
        </select>*@
                    @*</div>
            <div class="col-4">
                <input type="text" name="hlqualityFlagsAction" class="form-control" placeholder="Mitigation/Immediate Correction Actions">
            </div>
        </div>
        <div class="form-group row">
            <label class="col-6 col-form-label">
                Quality Incidents
            </label>
            <div class="col-2">
                <input type="number" onkeypress="validateNumber(event)" placeholder="0" name="hlqualityIncidents" class="form-control">*@
                    @*<select class="form-control select2" name="hlqualityIncidents">
            <option value="NA">NA</option>
            <option value="YES">YES</option>
            <option value="NO">NO</option>
        </select>*@
                    @*</div>
                    <div class="col-4">
                        <input type="text" name="hlqualityIncidentsAction" class="form-control" placeholder="Mitigation/Immediate Correction Actions">
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-6 col-form-label">
                        Completition of VQI & CPQI selfinspection during the shift
                    </label>
                    <div class="col-2">
                        <select class="form-control select2" name="hlqualityCompletitionofVQI">
                            <option value="NA">NA</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <input type="text" name="hlqualityCompletitionofVQIAction" class="form-control" placeholder="Mitigation/Immediate Correction Actions">
                    </div>
                </div>
            </div>

            <div class="col-6">
                <div class="form-group row">
                    <label class="col col-form-label font-weight-bold">&nbsp;</label>
                </div>
                <div class="form-group row">
                    <label class="col-6 col-form-label">
                        SPC physical parameters out of control limits and/or trends breaking the SPC rule
                    </label>
                    <div class="col-2">
                        <select class="form-control select2" name="hlqualitySPC">
                            <option value="NA">NA</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <input type="text" name="hlqualitySPCAction" class="form-control" placeholder="Mitigation/Immediate Correction Actions">
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-6 col-form-label">
                        Incomplete documentation
                    </label>
                    <div class="col-2">
                        <select class="form-control select2" name="hlqualityIncompleteDoc">
                            <option value="NA">NA</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <input type="text" name="hlqualityIncompleteDocAction" class="form-control" placeholder="Mitigation/Immediate Correction Actions">
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-6 col-form-label">
                        Higher RR
                    </label>
                    <div class="col-2">
                        <select class="form-control select2" name="hlqualityHigherRR">
                            <option value="NA">NA</option>
                            <option value="YES">YES</option>
                            <option value="NO">NO</option>
                        </select>
                    </div>
                    <div class="col-4">
                        <input type="text" name="hlqualityHigherRRAction" class="form-control" placeholder="Mitigation/Immediate Correction Actions">
                    </div>
                </div>
            </div>
        </div>*@
                    <div class="card-body">
                        <div class="tableWrapper" style="max-height: 210px">
                            <table class="table table-bordered table-hover table-striped">
                                <thead class="thead-info">
                                    <tr class="tx-center">
                                        <th style="min-width:120px;">Stops and Location</th>
                                        <th style="min-width:100px;"># of Stops</th>
                                        <th style="min-width:120px;">Initial Root Cause (Describe the issue) / Action Taken &amp; Impact</th>
                                        <th style="min-width:120px;">Action Taken in your shift</th>
                                        <th width="80px">Action</th>
                                    </tr>
                                    <tr class="summary-body" style="visibility:hidden;">
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </thead>
                                <tbody id="logbook">
                                </tbody>
                                <tfoot>
                                    <tr class="input">
                                        <td><input type="text" class="form-control" name="StopAndLocation"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="NOfStop"></td>
                                        <td><input type="text" class="form-control" name="InitialCause"></td>
                                        <td><input type="text" class="form-control" name="ActionTaken"></td>
                                        <td class="tx-center"><i data-target="logbook" class="fa fa-plus-circle add-to-table"></i></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <div class="tableWrapper" style="max-height: 210px">
                            <table class="table table-bordered table-hover table-striped">
                                <thead class="thead-info">
                                    <tr class="tx-center">
                                        <th style="width:50%;">Action proposed for next shift</th>
                                        <th style="min-width:90px;">Owner</th>
                                        <th style="min-width:70px;">Start Time</th>
                                        <th style="min-width:70px;">End Time</th>
                                        <th style="min-width:60px;">Duration (Min)</th>
                                        <th style="min-width:100px;">Status</th>
                                        <th width="80px">Action</th>
                                    </tr>
                                    <tr class="summary-body">
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>0</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </thead>
                                <tbody id="action">
                                </tbody>
                                <tfoot>
                                    <tr class="input">
                                        <td><input type="text" class="form-control" name="NextAction"></td>
                                        <td><input type="text" class="form-control" name="NextOwner"></td>
                                        <td><input type="text" class="form-control date" name="NextStart" id="start" onblur="javascript:countDuration('start','end','duration')"></td>
                                        <td><input type="text" class="form-control date" name="NextEnd" id="end" onblur="javascript:countDuration('start','end','duration')"></td>
                                        <td><input type="text" class="form-control disabled" disabled value="0" name="NextDurasi" id="duration"></td>
                                        <td>
                                            <select class="form-control select2" name="Status">
                                                <option label="Choose one"></option>
                                                <option value="ONPROGRESS">ONPROGRESS</option>
                                                <option value="DONE">DONE</option>
                                            </select>
                                        </td>
                                        <td class="tx-center"><i data-target="action" class="fa fa-plus-circle add-to-table"></i></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div> <!-- PROBLEM MESIN -->

            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Product Information</div>
                    <div class="card-body">
                        <div class="tableWrapper" style="max-height:210px">

                            <table class="table table-bordered table-hover table-striped" id="dtProductInformation">
                                <thead class="thead-info">
                                    <tr>
                                        <th style="width:10%">Robot <br>Palletizer</th>
                                        <th>Source<br>Finish Good / Brand</th>
                                        <th>Output<br>(box)</th>
                                        <th>Palet</th>
                                        <th>Reject<br>Weight</th>
                                        <th>Reject<br>Label</th>
                                        <th>Verfikasi<br>Weight</th>
                                        <th>Verfikasi<br>Label</th>
                                        <th>Average<br>Weight</th>
                                        <th style="width: 10%"></th>
                                    </tr>
                                    <tr class="summary-body">
                                        <td></td>
                                        <td></td>
                                        <td>0</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </thead>
                                <tbody id="productinformation">
                                </tbody>
                                <tfoot>
                                    <tr class="input">
                                        <td>
                                            <select class="form-control select2" name="Robot">
                                                <option label="Choose one"></option>
                                                <option value="-">-</option>
                                                <option value="Senzani">Senzani</option>
                                                @foreach (Fast.Web.Models.MachineModel machine in ViewBag.RobotPalletizer)
                                                {
                                                    <option value="@(machine.Code)">@(machine.Code)</option>
                                                }
                                            </select>
                                        </td>
                                        <td>
                                        <select class="form-control select2" name="Source">
                                            <option value="">Select Brand</option>
                                            @foreach (Fast.Web.Models.ReferenceDetailModel brand in ViewBag.Brand)
                                            {
                                                <option value="@(brand.Code)" @selected>[@(brand.Code)] @brand.Description</option>
                                            }
                                        </select>
                                        @*<input type="text" class="form-control" name="Source">*@</td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="Output"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="Palet"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="RejectWeight"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="RejectLabel"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="VerWeight"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="VerLabel"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="Average"></td>
                                        <td class="tx-center"><i data-target="productinformation" class="fa fa-plus-circle add-to-table"></i></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div> <!-- PRODUCT INFORMATION -->

            <div class="col-4 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Reject Weight Conveyor</div>
                    <div class="card-body">
                        <div class="tableWrapper" style="max-height:210px">

                            <table class="table table-bordered table-hover table-striped" id="dtRejectWeightConveyor">
                                <thead class="thead-info">
                                    <tr>
                                        <th>Box No.</th>
                                        <th>Before</th>
                                        <th>After</th>
                                        <th style="min-width:70px;"></th>
                                    </tr>
                                    <tr class="summary-body">
                                        <td></td>
                                        <td>0</td>
                                        <td>0</td>
                                        <td></td>
                                    </tr>
                                </thead>
                                <tbody id="rwc">
                                </tbody>
                                <tfoot>
                                    <tr class="input">
                                        <td><input type="text" class="form-control" name="BoxNo"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="BeforeReject"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="AfterReject"></td>
                                        <td class="tx-center"><i data-target="rwc" class="fa fa-plus-circle add-to-table"></i></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div> <!-- RIGHT WEUGHT CONVEYOR -->

            <div class="col-8 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Sampling Box</div>
                    <div class="card-body">
                        <div class="tableWrapper" style="max-height:210px">

                            <table class="table table-bordered table-hover table-striped" id="dtSamplingBox">
                                <thead class="thead-info">
                                    <tr>
                                        <th style="width:100px;">Box No</th>
                                        <th style="width:130px;">Production Time</th>
                                        <th style="width:160px;">Weight Before Check</th>
                                        <th style="width:160px;">Weight After Check</th>
                                        <th>Remark</th>
                                        <th style="min-width:70px;">&nbsp;</th>
                                    </tr>
                                    <tr class="summary-body">
                                        <td></td>
                                        <td></td>
                                        <td>0‬</td>
                                        <td>0</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </thead>
                                <tbody id="samplingbox">
                                </tbody>
                                <tfoot>
                                    <tr class="input">
                                        <td><input type="text" class="form-control" name="BoxNo"></td>
                                        <td><input type="text" class="form-control date" name="ProductionTime"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" name="WeightBefore"></td>
                                        <td><input type="number" onkeypress="validateNumber(event)" placeholder="0" class="form-control" value="0" name="WeightAfter" id="WeightAfter"></td>
                                        <td><input type="text" class="form-control" name="RemarkVal"></td>
                                        <td class="tx-center"><i data-target="samplingbox" class="fa fa-plus-circle add-to-table"></i></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
            </div> <!-- SAMPLING BOX -->


            <div class="col-12 mg-b-20">
                <div class="card">
                    <div class="card-header bg-primary tx-white tx-center font-weight-bold">Approval</div>
                    <div class="card-body">
                        <table class="table table-bordered table-hover table-striped" id="dtApproval">
                            <thead class="thead-info">
                                <tr>
                                    <th>Name</th>
                                    <th>Role</th>
                                    <th>Actions</th>
                                    <th style="width:15%;">Date &amp; Time</th>
                                    <th style="width:40%;">Comment</th>
                                </tr>
                            </thead>
                            @*<tbody>
                                    <tr>
                                        <td id="name_0">Adi Pamungkas</td>
                                        <td>Requester</td>
                                        <td id="status_0">Submit to Supervisor</td>
                                        <td>05-Sep-19 13:15</td>
                                        <td id="comment_0">Tes Comment</td>
                                    </tr>
                                    <tr>
                                        <td id="name_1">Sugeng Raharjo</td>
                                        <td>Supervisor</td>
                                        <td id="status_1">Confirmed</td>
                                        <td>05-Sep-19 13:25</td>
                                        <td id="comment_1">Comment here</td>
                                    </tr>
                                </tbody>*@
                        </table>
                    </div>
                </div>
            </div>


        </div> <!-- row -->
    </div><!-- container -->
</div><!-- content -->

<div id="jsonModel" data-json='@Html.Raw(JsonConvert.SerializeObject(Model))' />

@section Scripts{
    <script src="~/Content/dashforge/lib/cleave.js/cleave.min.js"></script>
    <script src="~/Content/dashforge/lib/select2/js/select2.min.js"></script>
    <script src="~/Content/dashforge/lib/moment/moment.js"></script>
    <script src="~/Scripts/webcam_help/main.js"></script>
    <script src="~/Scripts/webcam_help/MRZ_417_230119.js"></script>

    <script src="~/Content/dashforge/lib/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="~/Content/dashforge/lib/datatables.net-dt/js/dataTables.dataTables.min.js"></script>
    <script src="~/Content/dashforge/lib/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/Content/dashforge/lib/datatables.net-responsive-dt/js/responsive.dataTables.min.js"></script>


    <script>
        var selected = null;
        $(document).ready(function () {
            var lphID = @(Model.LPH.ID);
            $('#dtApproval').dataTable({
                "autoWidth": false,
                "processing": true,
                "serverSide": true,
                "info": false,
                "filter": false,
                "bLengthChange": false,
                "orderMulti": false,
                "pageLength": 10,
                "destroy": true,
                "order": [[3, "asc"]],
                "ajax": {
                    "url": fastApp.BaseUrl + '/Robot/GetApproverList?lphid=' + lphID,
                    "type": "POST",
                    "datatype": "json"
                },

                "columnDefs":
                    [{
                        "targets": [0],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [1],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [2],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [3],
                        "searchable": true,
                        "orderable": true
                    },
                    {
                        "targets": [4],
                        "searchable": true,
                        "orderable": true
                    },
                        //{
                        //       "targets": [5],
                        //       "searchable": true,
                        //       "orderable": true
                        //   },

                    ],

                "columns": [

                    { "data": "User", "name": "User", "title": "Name", "autoWidth": false },
                    { "data": "Role", "name": "Role", "title": "Role", "autoWidth": false },
                    { "data": "Status", "name": "Status", "title": "Status", "autoWidth": false },
                    //{ "data": "Approver", "name": "Approver", "title": "Approver", "autoWidth": false },
                    {
                        "data": "ModifiedDate",
                        render: function (data, type, row) {
                            if (data)
                                return moment(data).format("DD-MMM-YY HH:mm");
                            else
                                return '';
                        }
                    },
                    { "data": "Notes", "name": "Notes", "title": "Notes", "autoWidth": false }
                ],
                "fnRowCallback": function (nRow, data, iDisplayIndex, iDisplayIndexFull) {
                    $('td', nRow).css('background-color', data['Color']);
                    $('#dtApproval_paginate')[0].style.display = "none";
                }
            });
        });
    </script>
    <script type="text/javascript">
          $('#btnHistory').on('click', function (e) {
		     location.href = '@Url.Action("Index", "History")';
          });
          $('.datepicker').datepicker({
                format: 'D,d-M-yy',
                //language: 'id-id'
		  });
        $('.information-datepicker').toArray().forEach(function (field) {
            $(field).datepicker({
                todayHighlight: true,
                format: 'D, dd-M-yy',
                startDate: new Date(new Date().setDate(new Date().getDate() - 2)),
                endDate: new Date(new Date().setDate(new Date().getDate() + 1)),
                //maxDate: 2,
                //minDate: -2,
            });
        });

          //$('#txtDateInfo').val(moment().format("ddd, DD-MMM-YY"));
          //$('#txtWeekNumber').val(moment().week());
    </script>

    <script>

        $(function () {
            'use strict'
            console.log("chanif");

            /******************** PREFILLED ******************/

            var model = JSON.parse($("#jsonModel").attr("data-json"));

            for (var i = 0; i < model.CompoVal.length; i++) {
                const tn = model.CompoVal[i].Component.ComponentName.split("-");
                const type = model.CompoVal[i].Component.ComponentType.trim();
                const parent = tn[0];
                tn.shift();
                const child = tn.join("-");
                const val = model.CompoVal[i].Value.Value;
                let node = $("#" + parent + " " + type + "[name=" + child + "]");
                var temp_val = decodeURIComponent(val ? val : "");
                $(node).val(temp_val);
                if (child == 'Group' && type == 'INPUT' && parent == 'GeneralInfo') {
                    node = $("#" + parent + " " + "SELECT" + "[name=" + child + "]");
                    $(node).val(temp_val);
                }
                if ($(node).hasClass("select2")) {
                    if (temp_val.indexOf('___') !== -1) {
                        temp_val = temp_val.split('___');
                        $(node).val(temp_val);
                    }
                    $(node).trigger('change');
                }
                if ($(node).data('datepicker')) {
					var date = temp_val.substr(5, 9).split("-");
					var months = moment.monthsShort();
					date[1]=months.indexOf(date[1])+1;
					if(date[1]<10){
						date[1]='0'+date[1];
					}                        
					temp_val = '20'+date[2]+'-'+date[1]+'-'+date[0];
                    $(node).datepicker('setDate', new Date(temp_val)).datepicker('fill');
                }
            }
            while (model.Extras.length > 0) {
                const lastIndex = model.Extras.length - 1;
                const table = model.Extras[lastIndex].HeaderName;
                const row = model.Extras[lastIndex].RowNumber;
                let data = {
                    id: uuidv4()
                };
                for (let i = lastIndex; i >= 0; i--) {
                    if (model.Extras[i].HeaderName == table && model.Extras[i].RowNumber == row) {
                        const val = model.Extras[i].Value;
                        data[model.Extras[i].FieldName] = decodeURIComponent(val ? val : "");
                        if (model.Extras.length == 1) model.Extras = [];
                        else model.Extras.splice(i, 1);
                    }
                }
                configAle[table].data.push(data);
            }
            for (let prop in configAle) {
                configAle[prop].data.reverse();
                $("#" + prop).html(generateTable(configAle[prop].data, prop));
                countSummary(prop);
                ieFix();
            }

        });
        /****************** END PREFILLED ****************/
        function basicFunction() {

            /*  chanif: $('.select2').start diganti jadi $('.select2').select2 */
            $('.select2').select2({
                allowClear: true,
                placeholder: 'Choose one',
                searchInputPlaceholder: 'Search options'
            });




            $(document).find('.input-time').each(function () {
                var cleave = new Cleave($(this), {
                    time: true,
                    timePattern: ['h', 'm']
                });
            })
        }
    </script>
    <script>
        function tableOnScroll() {
            $(this).find("tfoot tr.input").css("transform", `translateX(-${$(this).scrollLeft()}px)`);
        }
        function ieFix() {
            if (navigator.userAgent.search("Edge") >= 0) {
                $(".tableWrapper:has(tfoot)").not(".no-ie-fix").each(function () {
                    $(this).find("tfoot tr.input").css({ "position": "fixed", "bottom":"0" });
                    $(this).find("table").css({ "margin-bottom": "32px" });
                    $(this).css({ "overflow-y": "scroll" });
                    const ths = $(this).find("thead tr.summary-body").find("th, td");
                    $(this).find("tfoot tr.input td").each(function (i, td) {
                        $(td).css({ "min-width": Math.floor($($(ths)[i]).outerWidth()), "position": "static" });
                    });
                    $(this).off('scroll', tableOnScroll).on('scroll', tableOnScroll);
                });
                $('.tableWrapper thead tr').each(function () {
                    const top = $(this).position().top;
                    $(this).children().css({ "top": top });
                });
            }
        }
        function uuidv4() {
            return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>
                (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16));
        }

        function generateRow(data, targetTable) {
            let r = "";
            $(`#${targetTable} ~ tfoot tr.input td`).children("input, select").each(function () {
                const name = $(this).prop("name");
                r += `<td data-name="${name}">${data[name]}</td>`;
            });


            let useEdit = true;
            let useDelete = true;
            let additionalButtons = "";
            if (configAle[targetTable].rowConfig !== undefined) {
                if (configAle[targetTable].rowConfig.withEdit !== undefined)
                    useEdit = configAle[targetTable].rowConfig.withEdit;
                if (configAle[targetTable].rowConfig.withDelete !== undefined)
                    useDelete = configAle[targetTable].rowConfig.withDelete;
                if (configAle[targetTable].rowConfig.additionalButtons != undefined)
                    additionalButtons = configAle[targetTable].rowConfig.additionalButtons(data);
            }
            r += `<td class="tx-center">`;
            r += additionalButtons;
            if (useEdit) r += `<i onclick="javascript:editData(this)" data-id="${data.id}" data-target-table="${targetTable}" class="fa fa-edit edit"></i>`;
            if (useDelete) r += `<span onClick="javascript:deleteData(this)" data-id="${data.id}" data-target-table="${targetTable}"><i class="fa fa-trash"></i></span>`;
            r += `</td >`;
            return r;
        }
        function generateTable(arr, targetTable) {
            if (arr.length == 0) return "";
            let rows = "";
            for (var i = arr.length - 1; i >= 0; i--) {
                rows += '<tr>';
                rows += generateRow(arr[i], targetTable);
                rows += '</tr>';
            }
            return rows;
        }
        function findInArray(id, crr) {
            for (var i = 0; i < crr.length; i++) {
                if (crr[i].id == id) {
                    return i;
                }
            }
        }
        function deleteFromArray(id, crr) {
            crr.splice(findInArray(id, crr), 1);
            return crr;
        }
        function editData(button) {
            const table = $(button).parents("table");
            if (!$(table).data("edited")) {
                $(table).data("edited", true);

                const tds = $(button).parents("tr").children('td');
                const inputTr = $(table).find('tr.input');
                const inputTds = $(inputTr).children('td');
                const tdsCount = $(tds).length;

                $(tds).each(function (i, e) {
                    const el = $(inputTds[i]).children()[0];
                    if (i != tdsCount - 1) {
                        const html = $(e).html();
                        const newInput = $(el).clone();
                        if ($(el).hasClass('select2'))
                            $(el).val(null).trigger("change");
                        else
                            $(el).val("");
                        if (!$(el).hasClass("disabled"))
                            $(newInput).prop("disabled", false);

                        $(el).prop("disabled", true);
                        $(newInput).val(html);
                        $(e).html(newInput);
                        if ($(el).hasClass('select2')) {
                            console.log("1");
                            console.log(newInput);
                            $(newInput).select2('destroy');
                            console.log("2");
                            console.log(newInput);
                            $(newInput).removeAttr('data-select2-id');
                            console.log("3");
                            console.log(newInput);
                            $(newInput).select2({
		                        allowClear: true,
                                placeholder: 'Choose one',
                                searchInputPlaceholder: 'Search options'
                            });
                        }
                    } else {
                        $(el).off("click");
                        const edit = $(e).find(".edit");
                        $(edit).attr("onclick", "javascript:normalData(this)");
                        $(edit).removeClass("fa-edit");
                        $(edit).addClass("fa-save");
                    }
                });
            }
            $('.date').toArray().forEach(function (field) {
                new Cleave(field, {
                    time: true,
                    timePattern: ['h', 'm']
                });
            });
            basicFunction();
            ieFix();
        }
        function releaseDisabledInput(table) {
            $(table).data("edited", false);
            const tds = $(table).find('tr.input td');
            const tdsCount = $(tds).length;
            $(tds).each(function (i, e) {
                const el = $(e).children()[0];
                if (i != tdsCount - 1) {
                    if (!$(el).hasClass("disabled"))
                        $(el).prop("disabled", false);
                } else {
                    var ev = $._data(el, 'events');
                    if (!(ev && ev.click))
                        $(el).on("click", addToTable);
                }
            });
        }
        function wizardButtonSetSelection(button) {
            selected = $(button).html();
            wizardButtonNext(button);
        }
        function wizardButtonNext(button) {
            const modal = $(button).parents(".modal");
            const carousel = $(modal).find('.carousel');
            const index = $(carousel).find('.carousel-item.active').index();
            const stepper = $(modal).find('.stepper');

            var info = { shouldReturn: false, shouldHide: false };
            $(modal).trigger("next", [index, info]);
            if (info.shouldReturn) return;
            if (info.shouldHide) { $(modal).modal('hide'); return; }

            $(stepper).children('.active').removeClass("active");

            $(carousel).carousel('next');
            $(stepper).children(`.stepper-step:nth-child(${index + 2})`).toggleClass("active");
            $(modal).find(".prev").show();
        };
        function generateWizardButton(arr) {
            let r = "";
            for (var i = 0; i < arr.length; i++) {
                r += `<button type="button" class="wizard-button btn btn-primary" onclick="javascript:wizardButtonSetSelection(this)">${arr[i]}</button>`;
            }
            return r;
        }
        function startupSetup(target, data) {
            $(target).html(generateTable(data, target));
            countSummary(target);
        }
        $(document).ready(function () {
            $('.select2').select2({
                allowClear: true,
                placeholder: 'Choose one',
                searchInputPlaceholder: 'Search options'
            });
            $('#prodTech').select2('destroy');
            $('#prodTech').select2({
                placeholder: 'Choose one or more',
                searchInputPlaceholder: 'Search options'
            });
            $('.date').toArray().forEach(function (field) {
                new Cleave(field, {
                    time: true,
                    timePattern: ['h', 'm']
                });
            });
            $(".add-to-table").on("click", addToTable);
            $('.tableWrapper thead tr').each(function () {
                const top = $(this).position().top;
                $(this).children().css({ "top": top });
            });
            $(".wizard-modal .next").click(wizardButtonNext);
            $(".wizard-modal .prev").click(function () {
                const modal = $(this).parents(".modal");
                const carousel = $(modal).find('.carousel');
                const stepper = $(modal).find('.stepper');
                const index = $(carousel).find('.carousel-item.active').index();

                $(stepper).children('.active').removeClass("active");

                $(carousel).carousel('prev');
                $(stepper).children(`.stepper-step:nth-child(${index})`).toggleClass("active");
                if (index == 1) $(modal).find(".prev").hide();
            });
            $('.wizard-modal').on('hidden.bs.modal', function (e) {
                const carousel = $(this).find('.carousel');
                const stepper = $(this).find('.stepper');
                $(this).find('.active').removeClass("active");
                $(stepper).children(".stepper-step:first-child").toggleClass("active");
                $(carousel).find(".carousel-item:first-child").toggleClass("active");
                $(this).trigger("hide");
                $(this).find(".prev").hide();
            });
        });
        function addToTable(button) {
            const targetTable = $(this).data("target");
            const tds = $(this).parents("tr").children("td");
            var newdata = {
                id: uuidv4()
            };
            let shouldReturn = false;
            $(tds).each(function (tdIndex, td) {
                const input = $(td).children();
                if (input.attr("name") != undefined) {
                    const name = input.attr("name");
                    const val = input.val();
                    if (configAle[targetTable].onValidate != undefined) {
                        if (configAle[targetTable].onValidate(name, val)) {
                            shouldReturn = true;
                            if ((input[0].nodeName.toLowerCase() === 'select')) {
                                $(input[0]).siblings(".select2-container").css('border', '1px solid red');
                                $(input[0]).siblings(".select2-container").css('border-radius', '0.25rem');
                                $(input[0]).on('select2:select', function (e) {
                                    $(input[0]).siblings(".select2-container").css('border', 'none');
                                    $(input[0]).siblings(".select2-container").css('border-radius', '0');
                                });
                            } else if (input[0].value === "") {
                                input[0].style.borderColor = "red";
                                $(input[0]).on('click', function (e) {
                                    input[0].style.borderColor = "rgb(192, 204, 218)";
                                });
                            }
                            return false;
                        }
                    }
                    if (input[0].type.toLowerCase() == "number") {
                        var myRegexp = /^00+$/g;
                        var match = myRegexp.exec(val);
                        if (match != null) {
                            alert("Please input a valid number");
                            shouldReturn = true;
                            return false;
                        }
                    }
                    newdata[name] = val;
                }
            });
            if (shouldReturn) return;
            $(tds).each(function (i, td) {
                const node = $(td).children();
                $(node).val("");
                if ($(node).hasClass("select2"))
                    $(node).trigger('change');
            });

            if (configAle[targetTable].onAdd != undefined) {
                if (configAle[targetTable].onAdd(newdata)) {
                    return;
                }
            }
            configAle[targetTable].data.push(newdata);
            $("#" + targetTable).html(generateTable(configAle[targetTable].data, targetTable));
            countSummary(targetTable);
            ieFix();
        }
        function countSummary(targetTable) {
            if (configAle[targetTable].countSummary != undefined) {
                const rowData = configAle[targetTable].countSummary();
                const summaryTds = $('#' + targetTable).parents('table').find('.summary-body').children();
                $('#' + targetTable).parents('table').find('.input td').each(function (i, td) {
                    const name = $(td).children().attr("name");
                    if (rowData.hasOwnProperty(name))
                        $(summaryTds[i]).html(rowData[name]);
                });
            }
        }
        function deleteData(button) {
            if (confirm("Are you sure?")) {
                const id = $(button).data("id");
                const targetTable = $(button).data("target-table");
                const table = $(button).parents("table");
                releaseDisabledInput(table);
                if (configAle[targetTable].onDelete != undefined) {
                    if (configAle[targetTable].onDelete(id)) {
                        return;
                    }
                }
                deleteFromArray(id, configAle[targetTable].data);
                $('#' + targetTable).html(generateTable(configAle[targetTable].data, targetTable));
                countSummary(targetTable);
                ieFix();
            }
        }
        function normalData(button) {
            if (confirm("Are you sure?")) {
                const id = $(button).data("id");
                const targetTable = $(button).data("target-table");
                const tds = $(button).parents("tr").children('td');
                const tdsCount = $(tds).length;
                const table = $(button).parents("table");

                if (configAle[targetTable].onSave != undefined) {
                    if (configAle[targetTable].onSave(id)) {
                        return;
                    }
                }
                const index = findInArray(id, configAle[targetTable].data);
                let shouldReturn = false;
                var newdata = {
                    id: uuidv4()
                };
                $(tds).each(function (tdIndex, e) {
                    if (tdIndex != tdsCount - 1) {
                        const name = $(e).data("name");
                        const val = $($(e).children()[0]).val();
                        if (configAle[targetTable].onValidate != undefined) {
                            if (configAle[targetTable].onValidate(name, val)) {
                                shouldReturn = true;
                                return false;
                            }
                        }
                        newdata[name] = val;
                    } else {
                        const edit = $(e).find(".edit");
                        $(edit).attr("onclick", "javascript:editData(this)");
                        $(edit).removeClass("fa-save");
                        $(edit).addClass("fa-edit");
                    }
                });
                if (shouldReturn) return;

                configAle[targetTable].data[index] = newdata;
                const row = generateRow(configAle[targetTable].data[index], targetTable);
                $(button).parents("tr").html(row);

                releaseDisabledInput(table);
                countSummary(targetTable);
                ieFix();
            }
        }
        function countDuration(start, end, duration) {
            var end = $('#' + end).val();
            var start = $('#' + start).val();

            if (start != "" && end != "") {
                end = end.split(':');
                start = start.split(':');
                var d = new Date();
                var startdate = new Date(d.getFullYear(), d.getMonth(), d.getDate(), start[0], start[1]);
                var enddate = new Date(d.getFullYear(), d.getMonth(), d.getDate(), end[0], end[1]);

                if (startdate > enddate) {
                    enddate = new Date(enddate);
                    enddate.setDate(enddate.getDate() + 1);
                }

                var diffTime = enddate - startdate;
                var diffMinutes = Math.ceil(diffTime / 60000);
                if (diffMinutes == NaN) {
                    $('#' + duration).val(0);
                } else {
                    $('#' + duration).val(diffMinutes);
                }
            }
        };
        function collectAllComponent() {
            let components = [];
            let values = [];
            $('.collect-component').each(function (i, p) {
                const id = $(p).prop("id");
                $(this).find('input, select, textarea').each(function (i2, e) {
                    components.push({
                        ComponentType: $(e).prop('nodeName'),
                        ComponentName: id + "-" + $(e).prop('name'),
                    })
                    var tem_value = $(e).val();
                    if (Array.isArray(tem_value)) {
                        tem_value = tem_value.join('___');
                    }
                    values.push({
                        Value: tem_value,
                        ValueType: $(e).attr('type') == "number" ? "Numeric" : "NonNumeric",
                    });
                });
            });
            return [components, values];
        }

        function collectAllData() {
            let collectorArray = [];
            for (var tableId in configAle) {
                let tableColumnType = {};
                $(`#${tableId} ~ tfoot tr.input td input`).each(function () {
                    tableColumnType[$(this).prop("name")] = $(this).prop("type");
                });
                const data = configAle[tableId].data;
                for (let i = 0; i < data.length; i++) {
                    if (configAle[tableId].onCollectDataRow != undefined) {
                        data[i] = configAle[tableId].onCollectDataRow(data[i]);
                    }
                    for (var prop in data[i]) {
                        if (Object.prototype.hasOwnProperty.call(data[i], prop)) {
                            if (prop == "id") continue;
                            let newInsertData = {
                                HeaderName: tableId,
                                FieldName: prop,
                                Value: data[i][prop],
                                ValueType: tableColumnType[prop] == "number" ? "Numeric" : "NonNumeric",
                                RowNumber: i
                            };
                            if (configAle[tableId].onCollectDataSingle != undefined) {
                                newInsertData = configAle[tableId].onCollectDataSingle(newInsertData);
                            }
                            collectorArray.push(newInsertData);
                        }
                    }
                }
            }
            console.log(collectorArray);
            return collectorArray;
        }
    </script>
    <script>

        /*
             * data = array untuk menyimpan data;
             * countSummary = dipanggil saat menghitung summary, return object dengan property sesuai dengan name pada `tfoot tr.input`;
             * onAdd(newData) = dipanggil sebelum menambah data, return boolean apakah harus ditambahkan atau tidak;
             * onDelete(idOfDeletedObject) = dipanggil sebelum menghapus data, return boolean apakah harus dihapus atau tidak;
             * onSave(idOfUpdatedObject) = dipanggil sebelum mengubah data, return boolean apakah harus diubah atau tidak;
             * onValidate(nameOfInput, valueOfInput) = validasi nilai saat tambah dan save, return boolean apakah harus diterus atau tidak;
             *
             * rowConfig = config untuk generate baris tabel;
             * - withEdit = menampilkan edit, default true;
             * - withDelete = menampilkan delete, default true;
             * - additionalButtons(data) = fungsi untuk yang akan mengembalikan button tambahan untuk tiap baris, return element html dalam string;
             */

        var logbookData = [];
        var produkData = [];
        var rejectData = [];
        var samplingData = [];
        var actionData = [];
        const configAle = {
            logbook: {
                data: logbookData,
                onValidate(name, val) {
                    if (val == "") {
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },
                onAdd: function (newData) {
                    console.log(newData);
                },
            },
            action: {
                data: actionData,
                onValidate(name, val) {
                    if (val == "") {
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },
                countSummary: function () {
                    let rowData = {};
                    let NextDurasi = 0;
                    for (var i = 0; i < actionData.length; i++) {
                        NextDurasi += parseInt(actionData[i].NextDurasi);
                    }
                    rowData.NextDurasi = NextDurasi;
                    return rowData;
                },
                onAdd: function (newData) {
                    console.log(newData);
                },
            },
            productinformation: {
                data: produkData,
                countSummary: function () {
                    let rowData = {};
                    let Output = 0;
                    for (var i = 0; i < produkData.length; i++) {
                        Output += parseInt(produkData[i].Output);
                    }
                    rowData.Output = Output;
                    return rowData;
                },
                onValidate(name, val) {
                    if (val == "") {
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },
            },
            rwc: {
                data: rejectData,
                countSummary: function () {
                    let rowData = {};
                    let BeforeReject = 0;
                    let AfterReject = 0;
                    for (var i = 0; i < rejectData.length; i++) {
                        BeforeReject += parseInt(rejectData[i].BeforeReject);
                        AfterReject += parseInt(rejectData[i].AfterReject);
                    }
                    rowData.BeforeReject = BeforeReject;
                    rowData.AfterReject = AfterReject;
                    return rowData;
                },
                onValidate(name, val) {
                    if (val == "") {
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },
            },
            samplingbox: {
                data: samplingData,
                countSummary: function () {
                    let rowData = {};
                    let WeightBefore = 0;
                    let WeightAfter = 0;
                    for (var i = 0; i < samplingData.length; i++) {
                        WeightBefore += parseInt(samplingData[i].WeightBefore);
                        WeightAfter += parseInt(samplingData[i].WeightAfter);
                    }
                    rowData.WeightBefore = WeightBefore;
                    rowData.WeightAfter = WeightAfter;
                    return rowData;
                },
                onValidate(name, val) {
                    if (val == "") {
                        alert("Value can't be empty");
                        return true;
                    }
                    return false;
                },
                onAdd: function (newData) {
                    $('#WeightAfter').val(0);
                    console.log(newData);
                },
            },
        }
    </script>

    <script>
             // ----- Collect Data (Component, Value, Approval, Extras) & Save Process

            var collectorComponent = [];
            var collectorValue = [];


            function collectHandoverComponent() {
                 var dataNonNumericComponent = [
                "hlsafetyTrigger",
                "hlsafetyComment",
                "hlquality",
                "hlqualityComment",
                "hlqualityFlags",
                "hlqualityFlagsAction",
                "hlqualityIncidents",
                "hlqualityIncidentsAction",
                "hlqualityCompletitionofVQI",
                "hlqualityCompletitionofVQIAction",
                "hlqualitySPC",
                "hlqualitySPCAction",
                "hlqualityIncompleteDoc",
                "hlqualityIncompleteDocAction",
                "hlqualityHigherRR",
                "hlqualityHigherRRAction"
                ];
                var dataNumericComponent =[
                "hlnoofstops",
                "hlmtbf",
                "hlcenterlineschecked",
                "hlcenterlinesofl",
                "hlensureCLDeviation",
                "hlcilCompletion",
                "hlplannedDuration",
                "hlactualDuration",
                "hlnumofDefectsFound",
                "hlnumofDefectsFixed",
                "hlensureReportedDHL",
                "hlnumofBreakdown",
                "hltotBreakdown",
                "hlensurePMCard"];
                dataNonNumericComponent.forEach(function (entry) {
                    var componentInfo = {};
                    componentInfo.ComponentType="textfield";
                    componentInfo.ComponentName = entry;
                    collectorComponent.push(componentInfo);
                });
                dataNumericComponent.forEach(function (entry) {
                    var componentInfo = {};
                    componentInfo.ComponentType="textfield";
                    componentInfo.ComponentName = entry;
                    collectorComponent.push(componentInfo);
                });
            }

            function collectHandoverValue() {
                var dataNonNumericValue = [
                "hlsafetyTrigger",
                "hlsafetyComment",
                "hlquality",
                "hlqualityComment",
                "hlqualityFlags",
                "hlqualityFlagsAction",
                "hlqualityIncidents",
                "hlqualityIncidentsAction",
                "hlqualityCompletitionofVQI",
                "hlqualityCompletitionofVQIAction",
                "hlqualitySPC",
                "hlqualitySPCAction",
                "hlqualityIncompleteDoc",
                "hlqualityIncompleteDocAction",
                "hlqualityHigherRR",
                "hlqualityHigherRRAction"
                ];
                var dataNumericValue =[
                "hlnoofstops",
                "hlmtbf",
                "hlcenterlineschecked",
                "hlcenterlinesofl",
                "hlensureCLDeviation",
                "hlcilCompletion",
                "hlplannedDuration",
                "hlactualDuration",
                "hlnumofDefectsFound",
                "hlnumofDefectsFixed",
                "hlensureReportedDHL",
                "hlnumofBreakdown",
                "hltotBreakdown",
                "hlensurePMCard"];
                dataNonNumericValue.forEach(function (entry) {
                    var dataValue = {};
                    dataValue.Value = $('#' + entry).val();
                    dataValue.ValueType = "NonNumeric";
                    collectorValue.push(dataValue);
                });
                dataNumericValue.forEach(function (entry) {
                    var dataValue = {};
                    dataValue.Value = $('#' + entry).val();
                    dataValue.ValueType = "Numeric";
                    collectorValue.push(dataValue);
                });
            }

            function collectInformationComponent() {
            var dateInfo = {};
            dateInfo.ComponentType="textfield";
            dateInfo.ComponentName = "Date";
            collectorComponent.push(dateInfo);
            var weekInfo = {};
            weekInfo.ComponentType="textfield";
            weekInfo.ComponentName = "Week";
            collectorComponent.push(weekInfo);
            var machineInfo = {};
            machineInfo.ComponentType="textfield";
            machineInfo.ComponentName = "Machine";
            collectorComponent.push(machineInfo);
            var brandInfo = {};
            brandInfo.ComponentType="textfield";
            brandInfo.ComponentName = "Brand";
            collectorComponent.push(brandInfo);

             var gwInfo = {};
            gwInfo.ComponentType="textfield";
            gwInfo.ComponentName = "GWName";
            collectorComponent.push(gwInfo);
             var prodtechInfo = {};
            prodtechInfo.ComponentType="textfield";
            prodtechInfo.ComponentName = "Prodtech";
            collectorComponent.push(prodtechInfo);

             var foremanInfo = {};
            foremanInfo.ComponentType="textfield";
            foremanInfo.ComponentName = "Foreman";
            collectorComponent.push(foremanInfo);
            var mekanikInfo = {};
            mekanikInfo.ComponentType="textfield";
            mekanikInfo.ComponentName = "Mekanik";
            collectorComponent.push(mekanikInfo);
            var elektrikInfo = {};
            elektrikInfo.ComponentType="textfield";
            elektrikInfo.ComponentName = "Elektrik";
            collectorComponent.push(elektrikInfo);
            var teamLeaderInfo = {};
            teamLeaderInfo.ComponentType="textfield";
            teamLeaderInfo.ComponentName = "TeamLeader";
            collectorComponent.push(teamLeaderInfo);

            var shiftInfo = {};
            shiftInfo.ComponentType="textfield";
            shiftInfo.ComponentName = "Shift";
            collectorComponent.push(shiftInfo);
               var groupInfo = {};
            groupInfo.ComponentType="textfield";
            groupInfo.ComponentName = "Group";
            collectorComponent.push(groupInfo);
            var startInfo = {};
            startInfo.ComponentType="textfield";
            startInfo.ComponentName = "Start";
            collectorComponent.push(startInfo);
            var stopInfo = {};
            stopInfo.ComponentType="textfield";
            stopInfo.ComponentName = "Stop";
            collectorComponent.push(stopInfo);
            var machineTypeInfo = {};
            machineTypeInfo.ComponentType="textfield";
            machineTypeInfo.ComponentName = "MachineType";
            collectorComponent.push(machineTypeInfo);


            }
            function collectInformationValue() {
            var dateInfoValue = {};
            dateInfoValue.Value= $('#txtDateInfo').val();
            dateInfoValue.ValueType = "NonNumeric";
            collectorValue.push(dateInfoValue);
            var weekInfoValue = {};
            weekInfoValue.Value= $('#txtWeekNumber').val();
            weekInfoValue.ValueType = "Numeric";
            collectorValue.push(weekInfoValue);
            var machineInfoValue = {};
            machineInfoValue.Value= $('#machInfo').val();
            machineInfoValue.ValueType = "NonNumeric";
            collectorValue.push(machineInfoValue);
            var brandInfoValue = {};
            brandInfoValue.Value= $('#brandInfo').val();
            brandInfoValue.ValueType = "NonNumeric";
            collectorValue.push(brandInfoValue);

            var gwInfoValue = {};
            gwInfoValue.Value= $('#gwName').val();
            gwInfoValue.ValueType = "NonNumeric";
            collectorValue.push(gwInfoValue);
            var prodTechInfoValue = {};
            prodTechInfoValue.Value= $('#prodTech').val();
            prodTechInfoValue.ValueType = "NonNumeric";
            collectorValue.push(prodTechInfoValue);

            var foremanInfoValue = {};
            foremanInfoValue.Value= $('#foreman').val();
            foremanInfoValue.ValueType = "NonNumeric";
            collectorValue.push(foremanInfoValue);
            var mekanikInfoValue = {};
            mekanikInfoValue.Value= $('#mekanik').val();
            mekanikInfoValue.ValueType = "NonNumeric";
            collectorValue.push(mekanikInfoValue);
            var elektrikInfoValue = {};
            elektrikInfoValue.Value= $('#elektrik').val();
            elektrikInfoValue.ValueType = "NonNumeric";
            collectorValue.push(elektrikInfoValue);
            var teamLeaderInfoValue = {};
            teamLeaderInfoValue.Value= $('#teamLeader').val();
            teamLeaderInfoValue.ValueType = "NonNumeric";
            collectorValue.push(teamLeaderInfoValue);
            var shiftInfoValue = {};
            shiftInfoValue.Value= $('#shift').val();
            shiftInfoValue.ValueType = "NonNumeric";
            collectorValue.push(shiftInfoValue);
            var groupInfoValue = {};
            groupInfoValue.Value= $('#group').val();
            groupInfoValue.ValueType = "NonNumeric";
            collectorValue.push(groupInfoValue);
            var startInfoValue = {};
            startInfoValue.Value= $('#inputTimeStart').val();
            startInfoValue.ValueType = "Numeric";
            collectorValue.push(startInfoValue);
            var stopInfoValue = {};
            stopInfoValue.Value= $('#inputTimeStop').val();
            stopInfoValue.ValueType = "Numeric";
            collectorValue.push(stopInfoValue);
            var machTypeInfoValue = {};
            machTypeInfoValue.Value= $('#machType').val();
            machTypeInfoValue.ValueType = "Numeric";
            collectorValue.push(machTypeInfoValue);
            }

			$('#goPrev').click(function () {
                $.ajax({
                  type: "POST",
                  url: "@Url.Action("CheckPrev", "Robot")",
                  data: JSON.stringify({
                      LPHID: @(Model.LPH.ID),
                      machine: $('#machInfo').val()
                  }),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  success: function (result) {
					if (result.Status) {
						//ketika data ada, munculkan dalam window baru
                        window.open("@(Url.Action("Submitted", "Robot"))?lphid="+result.LPHID+"&type=1", "window baru", "height=400,width=1300");
					}
					else {
						var notice = new PNotify({
							title: "@UIResources.ErrorMessage",
							text: "No previous submissions found",
							width: "400px",
                            type: 'error',
                            addclass: 'stack-bottomright',
							hide: false,
							buttons: {
								sticker: false
							}
						});

						notice.get().click(function () {
								notice.remove();
							});
						}
                    }
                });
            })

            function checkMandatory() {
                var mandatory = $(".mandatory");
                const headerHeight = $(".navbar.navbar-header.navbar-header-fixed").outerHeight();
                var status = true;
                for (var i = 0; i < mandatory.length; i++) {
                    if (($(mandatory[i])[0].nodeName.toLowerCase() === 'select') && $(mandatory[i])[0].value === "") {
                        window.scrollTo(0, Math.max(0, $(mandatory[i]).offset().top - headerHeight- 100));
                        $(mandatory[i]).siblings(".select2-container").css('border', '1px solid red');
                        $(mandatory[i]).siblings(".select2-container").css('border-radius', '0.25rem');
                        $(mandatory[i]).parent().prepend($('<span>', {
                            style: "color:red; display:block; float:left;",
                            id: "mandatory-error-" + i,
                            html: '!',
                            class: 'row'
                        }));
                        $(mandatory[i]).on('select2:select', function (e) {
                            $(e.target).siblings(".select2-container").css('border', 'none');
                            $(e.target).siblings(".select2-container").css('border-radius', '0');
                            $(e.target).parent().find('span.row').remove();
                        });
                        status = false;
                    } else if ($(mandatory[i])[0].value === "") {
                        window.scrollTo(0, Math.max(0, $(mandatory[i]).offset().top - headerHeight- 100));
                        $(mandatory[i])[0].style.borderColor = "red";
                        $(mandatory[i]).parent().prepend($('<span>', {
                            style: "color:red; display:block; float:left;",
                            id: "mandatory-error-" + i,
                            html: '!',
                            class: 'row'
                        }));
                        $(mandatory[i]).on('click', function (e) {
                            e.target.style.borderColor = "rgb(192, 204, 218)";
                            $(e.target).parent().find('span.row').remove();
                        });
                        $(mandatory[i]).on('focus', function (e) {
                            e.target.style.borderColor = "rgb(192, 204, 218)";
                            $(e.target).parent().find('span.row').remove();
                        });
                        status = false;
                    }
                }
                return status;
            }


        function saveLPH(isSubmit, Special) {
            var timeStart = $('#inputTimeStart').val();
                var timeStop = $('#inputTimeStop').val();


                var detailSubmission = {};
                detailSubmission.StartTime = timeStart;
                detailSubmission.EndTime = timeStop;
                detailSubmission.Shift = $('#shift').val();

                var collectorArray = collectAllData(); // for LPH Extras
                var collector = collectAllComponent();
                var collectorComponent = collector[0];
                var collectorValue = collector[1];
                var collectorApproval = [];


                  $.ajax({
                  type: "POST",
                  url: "@Url.Action("Edit", "Robot")",
                  data: JSON.stringify({
                      id: @(Model.LPH.ID),
                      isSubmit: isSubmit,
                      Special: Special,
                      detailExtras: collectorArray, detailSubmission: detailSubmission, detailComponent: collectorComponent,
                      detailValue: collectorValue

                  }),
                  contentType: "application/json; charset=utf-8",
                  dataType: "json",
                  success: function (result) {
                      console.log(result.Status);
                      if (result.Status == 'True') {
                          if (isSubmit == 1) {
                              var notice = new PNotify({
							    title: "@UIResources.Confirmation",
							    text: "@UIResources.EditSucceed",
							    width: "400px",
							    type: 'success',
							    addclass: 'stack-bottomright'
						    });

						    notice.get().click(function () {
							    notice.remove();
                            });

                            setTimeout(function () {
                                location.reload();
                            }, 3000);
                          }
                          else {
                            var notice = new PNotify({
							    title: "@UIResources.Confirmation",
							    text: "@UIResources.EditSucceed",
							    width: "400px",
							    type: 'success',
							    addclass: 'stack-bottomright'
						    });

                            setTimeout(function(){
                                notice.remove();
                            }, 3000);
                          }

					}
                      else {
                          if (result.Msg == 'Invalid')
                              alert("Tab is expired, another tab with same LPHID has been opened. You cannot save until you reload page first to continue");
						var notice = new PNotify({
							title: "@UIResources.ErrorMessage",
							text: "@UIResources.EditFailed",
							width: "400px",
                            type: 'error',
                            addclass: 'stack-bottomright',
							hide: false,
							buttons: {
								sticker: false
							}
						});

						notice.get().click(function () {
								notice.remove();
							});
						}
                    },
                      error: function (request, status, error) {
                            window.location.reload(true);
                      },
                        complete: function() {
                            $('#loading_overlay').addClass('d-none');
                        },
                });
        }

        $(window).load(function(){
            setInterval(function () {
                $('#loading_overlay').removeClass('d-none');
                saveLPH(0,@myspecial);
            }, 10 * 60 * 1000);
        });

        $('#btnSaveDraft').click(function (e) {
            $('#loading_overlay').removeClass('d-none');
            saveLPH(0,@myspecial);
        });

        $('#btnSave').click(function (e) {
            if (checkMandatory()) {
                $('#loading_overlay').removeClass('d-none');
                saveLPH(1,@myspecial);
            }else {
                var notice = new PNotify({
						title: "Warning",
						text: "Submit failed, input field with red border, and photo can't be empty",
						width: "400px",
                        type: 'error',
                        addclass: 'stack-bottomright',
						hide: false,
						buttons: {
							sticker: false
						}
                });
                setTimeout(function(){
                        notice.remove();
                }, 8000);
            }
        });


           $('#btnReset').click(function () {
                var redirect = confirm("All unsubmitted changes will be lost. Do you really want to reset?");
                if (redirect) {
                    @*window.location.href = "@(Url.Action("Index", "Robot"))/?reset=true";*@
                DeleteLPH(@(Model.LPH.ID));
            }
        });


        function DeleteLPH(Id) {
            $('#loading_overlay').removeClass('d-none');
            $.ajax({
                url: fastApp.BaseUrl + '/History/Delete?lphid=' + Id,
                type: 'POST',
                success: function (result) {
                    if (result.Status) {
                        var notice = new PNotify({
                            title: "@UIResources.Confirmation",
                            text: 'Reset LPH Successfully',
                            width: "400px",
                            type: 'success',
                            addclass: 'stack-bottomright'
                        });

                        notice.get().click(function () {
                            notice.remove();
                        });
                    }
                    else {
                        var notice = new PNotify({
                            title: "@UIResources.ErrorMessage",
                            text: "@UIResources.DeleteFailed",
                            width: "400px",
                            type: 'error',
                            hide: false,
                            addclass: 'stack-bottomright',
                            buttons: {
                                sticker: false
                            }
                        });

                        notice.get().click(function () {
                            notice.remove();
                        });
                    }
                    $('#loading_overlay').addClass('d-none');
                },
                complete: function (data) {
                    $('#loading_overlay').addClass('d-none');
                    setTimeout(function () {
                        window.location.href = "@(Url.Action("Index", "Robot"))";
                    }, 1000);
                }
            });
        }
    </script>
    <script>

        $(document).ready(function () {
            $('.tableWrapper thead tr').each(function () {
                const top = $(this).position().top;
                $(this).children().css({ "top": top });
            });
        });</script>
    <script>
        function detectBrowser() {
            var ua= navigator.userAgent, tem, 
            M= ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
            if(/trident/i.test(M[1])){
                tem=  /\brv[ :]+(\d+)/g.exec(ua) || [];
                return 'IE '+(tem[1] || '');
            }
            if(M[1]=== 'Chrome'){
                tem= ua.match(/\b(OPR|Edge)\/(\d+)/);
                if(tem!= null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
            }
            M= M[2]? [M[1], M[2]]: [navigator.appName, navigator.appVersion, '-?'];
            if((tem= ua.match(/version\/(\d+)/i))!= null) M.splice(1, 1, tem[1]);
            return M.join(' ');
        };
        if (detectBrowser().indexOf("Chrome") < 0) {
            $('input[type=number]').toArray().forEach(function (field) {
                $(field).attr("placeholder", "0");
                new Cleave(field, {
                    numeral: true,
                    numeralDecimalScale: 2,
                    numeralThousandsGroupStyle: 'none',
                    //numeralDecimalMark: ',',
                    //delimiter: '.',
                    numeralPositiveOnly: $(field).hasClass("number-positive"),
                });
                $(field).on("keyup", function (e) {
                    if (e.keyCode == 190) {
                        let val = $(this).val();
                        const i = val.lastIndexOf(".");
                        let a = val.length > 1 ? val.substring(i - 1, i) : "-";
                        if (isNaN(a)) $(this).val(val.slice(0, i) + "0.");
                    }
                });
            });
        }
    </script>
}
