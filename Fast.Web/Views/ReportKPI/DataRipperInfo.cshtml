@model Fast.Web.Models.Report.DataKPIRipperInfoModel
@using Fast.Web.Resources;

<link href="~/Content/dashforge/lib/fontawesome-free/css/all.min.css" rel="stylesheet">
<!-- Specific Page Vendor CSS -->
<style>
    .dataTables_scrollHead table, .dataTables_scrollBody table {
        width: 1900px !important;
    }
</style>

<div class="card-header">
    <div class="row pd-r-10-f">
        <div class="col-sm-2 form-group">
            <label class="d-block">Production Center</label>
            <select class="form-control select2" id="PC" name="PC">
                <option value="">All Production Center</option>
                <option value="PB" @(ViewBag.PC == "PB" ? "selected" : "")>PB - SIS Sukorejo</option>
                <option value="PJ" @(ViewBag.PC == "PJ" ? "selected" : "")>PJ - Sampoerna Sukorejo</option>
                <option value="PK" @(ViewBag.PC == "PK" ? "selected" : "")>PK - Sampoerna Karawang</option>
                <option value="PI" @(ViewBag.PC == "PI" ? "selected" : "")>PI - PMID Karawang</option>
            </select>
        </div>
        <div class="col-sm-2 form-group">
            <label class="d-block">Year</label>
            <input class="form-control text-right" id="year" type="number" value="@ViewBag.Year">
        </div>
        <div class="col-sm-2 form-group">
            <label class="d-block">Week</label>
            <input class="form-control text-right" id="week" type="number" value="@ViewBag.Week" placeholder="Empty = All Week">
        </div>

        <div class="col-sm-6">
            <div class="row">
                <div class="col-sm-3 mg-t-30"><button onclick="refresh()" class="btn pd-x-15 btn-primary btn-uppercase btn-block"><i class="fa fa-search mg-r-10"></i> Search</button></div>
                <div class="col-sm-3 mg-t-30"><button onclick="downloadData('RipperInfo')" class="btn pd-x-15 btn-primary btn-uppercase btn-block"><i class="fa fa-download mg-r-10"></i> Download</button></div>
                <div class="col-sm-3 mg-t-30"><button onclick="modalUploadData('RipperInfo')" class="btn pd-x-15 btn-primary btn-uppercase btn-block"><i class="fa fa-upload mg-r-10"></i> Upload Data</button></div>
                <div class="col-sm-3 mg-t-30"><button onclick="modalAddData()" class="btn pd-x-15 btn-primary btn-uppercase btn-block"><i class="fa fa-plus mg-r-10"></i> Add Data</button></div>
            </div>
        </div>
    </div>
</div>
<div class="card-body">
    <table class="table table-bordered dodatatable">
        <thead class="thead-primary font-weight-bold">
            <tr>
                <td>Production Center</td>
                <th>Year</th>
                <th>Week</th>
                <td>Material</td>
                <td>Order</td>
                <td>Actual Start Date</td>
                <td>Description</td>
                <td>Qty Iss</td>
                <td>Qty Rec</td>
                <td>Yield</td>
                <td>Val Issued</td>
                <td>Val Receiv</td>
                <td>Val Differ</td>
                <th>Inserted By</th>
                <th>Inserted Date</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var data in Model.Data)
            {
                <tr>
                    <td>@data.ProductionCenter</td>
                    <td>@data.Year</td>
                    <td>@data.Week</td>
                    <td>@data.Material</td>
                    <td>@data.OrderNum</td>
                    <td>@(((DateTime)data.ActualStartDate).ToString("dd-MMM-yy"))</td>
                    <td>@data.Description</td>
                    <td>@data.QtyIss</td>
                    <td>@data.QtyRec</td>
                    <td>@data.Yield</td>
                    <td>@data.ValIssued</td>
                    <td>@data.ValReceiv</td>
                    <td>@data.ValDiffer</td>
                    <td>@data.ModifiedBy</td>
                    <td>@(((DateTime)data.ModifiedDate).ToString("dd-MMM-yy HH:mm"))</td>
                    <td class="text-center">
                        <a class="btn-default tx-black" title="Edit Data" href="#" onclick="editdata(this, @(data.ID))"><i class="fa fa-edit"></i></a>
                        <a class="btn-default tx-black" title="Delete Data" href="#" onclick="deletedata(@(data.ID))"><i class="fa fa-trash"></i></a>
                    </td>
                </tr>
            }

        </tbody>
    </table>
</div>

<div class="modal fade" id="modalEditData" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document" style="max-width:500px;">
        <div class="modal-content" id="FormEdit">
            <form action="@Url.Action("EditRipperInfo", "ReportKPI")" class="form-horizontal" method="post">
                <div class="modal-header pd-20">
                    <h4 class="tx-18 tx-sm-20 mg-b-2" id="ModalTitle"></h4>
                </div><!-- modal-header -->
                <div class="modal-body pd-sm-t-20 pd-sm-b-20 pd-sm-x-30">
                    <div class="">
                        <input name="ID" type="hidden" value="">

                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">Production Center</label>
                            <div class="col-sm-8">
                                <select class="form-control select2" name="ProductionCenter">
                                    <option value="PB">PB - SIS Sukorejo</option>
                                    <option value="PJ">PJ - Sampoerna Sukorejo</option>
                                    <option value="PK">PK - Sampoerna Karawang</option>
                                    <option value="PI">PI - PMID Karawang</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">Year</label>
                            <div class="col-sm-8">
                                <input type="number" class="form-control" name="Year" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">Week</label>
                            <div class="col-sm-8">
                                <input type="number" class="form-control" name="Week" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">Material</label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" name="Material" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">OrderNum</label>
                            <div class="col-sm-8">
                                <input type="number" step="any" class="form-control" name="OrderNum" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">ActualStartDate</label>
                            <div class="col-sm-8">
                                <input type="text" step="any" class="form-control hasDatepicker" name="ActualStartDate" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">Description</label>
                            <div class="col-sm-8">
                                <input type="text" step="any" class="form-control" name="Description" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">QtyIss</label>
                            <div class="col-sm-8">
                                <input type="number" step="any" class="form-control" name="QtyIss" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">QtyRec</label>
                            <div class="col-sm-8">
                                <input type="number" step="any" class="form-control" name="QtyRec" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">Yield</label>
                            <div class="col-sm-8">
                                <input type="number" step="any" class="form-control" name="Yield" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">ValIssued</label>
                            <div class="col-sm-8">
                                <input type="number" step="any" class="form-control" name="ValIssued" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">ValReceiv</label>
                            <div class="col-sm-8">
                                <input type="number" step="any" class="form-control" name="ValReceiv" required>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-4 col-form-label">ValDiffer</label>
                            <div class="col-sm-8">
                                <input type="number" step="any" class="form-control" name="ValDiffer" required>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer pd-x-20 pd-y-15">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>


        </div><!-- modal-content -->
    </div><!-- modal-dialog -->
</div><!-- modal -->

<script type="text/javascript">
    function modalAddData() {
        $("#ModalTitle").text("Add Ripper Information");
        $('input[name ="ID"]').val(0);
        
        $('input[name ="ProductionCenter"]').val("");
        $('input[name ="Year"]').val(new Date().getFullYear());
        $('input[name ="Week"]').val(moment().format('W'));
        $('input[name ="Material"]').val("");
        $('input[name ="OrderNum"]').val("");
        $('input[name ="ActualStartDate"]').val(moment().format('DD-MMM-YY'));
        $('input[name ="Description"]').val("");
        $('input[name ="QtyIss"]').val(0);
        $('input[name ="QtyRec"]').val(0);
        $('input[name ="Yield"]').val(0);
        $('input[name ="ValIssued"]').val(0);
        $('input[name ="ValReceiv"]').val(0);
        $('input[name ="ValDiffer"]').val(0);

        $("#modalEditData").modal();
    };

    function editdata(e, id) {
        $tr = $(e).closest('tr');
        console.log($tr.find("td:eq(1)").text());
        $("#ModalTitle").text("Edit Ripper Information");
        $('input[name ="ID"]').val(id);
        $('input[name ="ProductionCenter"]').val($tr.find("td:eq(0)").text());
        $('input[name ="Year"]').val($tr.find("td:eq(1)").text());
        $('input[name ="Week"]').val($tr.find("td:eq(2)").text());
        $('input[name ="Material"]').val($tr.find("td:eq(3)").text());
        $('input[name ="OrderNum"]').val($tr.find("td:eq(4)").text());
        $('input[name ="ActualStartDate"]').val($tr.find("td:eq(5)").text());
        $('input[name ="Description"]').val($tr.find("td:eq(6)").text());
        $('input[name ="QtyIss"]').val($tr.find("td:eq(7)").text());
        $('input[name ="QtyRec"]').val($tr.find("td:eq(8)").text());
        $('input[name ="Yield"]').val($tr.find("td:eq(9)").text());
        $('input[name ="ValIssued"]').val($tr.find("td:eq(10)").text());
        $('input[name ="ValReceiv"]').val($tr.find("td:eq(11)").text());
        $('input[name ="ValDiffer"]').val($tr.find("td:eq(12)").text());

        $("#modalEditData").modal();
    }

    $('.hasDatepicker').datepicker({
        format: 'd-M-yy'
    });

    function refresh() {
        $('#loading_overlay').removeClass('d-none');
        $("#main_container").load(fastApp.BaseUrl + "/ReportKPI/DataRipperInfo?year=" + $('#year').val() + "&week=" + $('#week').val() + "&PC=" + $('#PC').val(), function () {
            $('#loading_overlay').addClass('d-none');
        });
    }

    function deletedata(id) {
        if (confirm("Do you really want to delete this data?")) {
            $.get(fastApp.BaseUrl + "/ReportKPI/DeleteRipperInfo/" + id, function (data) {
                refresh();
            });
        }
    }

    function downloadData(data) {
        window.open(fastApp.BaseUrl + "/ReportKPI/DownloadXls?data=" + data + "&year=" + $('#year').val() + "&week=" + $('#week').val() + "&PC=" + $('#PC').val(), '_blank');
    }

    $('.dodatatable').DataTable({
        scrollX: true,
        order: [],
        //responsive: true,
        language: {
            searchPlaceholder: 'Search...',
            sSearch: '',
            lengthMenu: '_MENU_ items/page',
        }
    });
    $('.dataTables_length select').select2({ minimumResultsForSearch: Infinity });

</script>